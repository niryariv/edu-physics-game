<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×—×•×§×™ × ×™×•×˜×•×Ÿ - ×”×¨×¤×ª×§×ª ×¤×™×–×™×§×”!</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #1A1A2E;
    --card: #0F3460;
    --law1: #00C9FF;
    --law2: #FF6B35;
    --law3: #7B2FBE;
    --energy: #22c55e;
    --gravity: #e11d48;
    --gold: #FFD700;
    --success: #4CAF50;
    --danger: #F44336;
    --text: #E0E0E0;
    --text-dim: #A0A0B0;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: Arial, Tahoma, sans-serif;
    font-size: 17px;
    min-height: 100vh;
    overflow-x: hidden;
    direction: rtl;
    text-align: right;
  }

  /* HEADER */
  #header {
    background: var(--card);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    direction: rtl;
  }

  #header-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--gold);
    white-space: nowrap;
  }

  #score-display {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  #score-text {
    font-size: 17px;
    font-weight: 700;
    color: var(--gold);
  }

  #progress-dots {
    display: flex;
    gap: 8px;
  }

  .dot {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #333;
    border: 2px solid #555;
    transition: background 0.4s, border-color 0.4s;
  }

  .dot.done {
    background: var(--gold);
    border-color: var(--gold);
    box-shadow: 0 0 8px var(--gold);
  }

  #stars-display {
    font-size: 20px;
    letter-spacing: 2px;
  }

  #progress-bar-wrap {
    width: 100%;
    height: 6px;
    background: #333;
    border-radius: 3px;
    margin-top: 4px;
  }

  #progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--law1), var(--law2), var(--law3), var(--gold));
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 0%;
  }

  /* NAV TABS */
  #nav-tabs {
    display: flex;
    background: rgba(0,0,0,0.3);
    padding: 8px 12px;
    gap: 6px;
    overflow-x: auto;
    scrollbar-width: none;
    direction: rtl;
  }
  #nav-tabs::-webkit-scrollbar { display: none; }

  .tab-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 24px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    white-space: nowrap;
    transition: all 0.2s;
    background: var(--card);
    color: var(--text-dim);
    font-family: Arial, Tahoma, sans-serif;
  }

  .tab-btn:hover {
    filter: brightness(1.3);
    transform: translateY(-1px);
  }

  .tab-btn.active { color: #fff; box-shadow: 0 3px 10px rgba(0,0,0,0.4); }
  .tab-btn[data-tab="home"].active  { background: var(--success); }
  .tab-btn[data-tab="law1"].active  { background: linear-gradient(135deg, #0070a0, var(--law1)); }
  .tab-btn[data-tab="law2"].active  { background: linear-gradient(135deg, #a03000, var(--law2)); }
  .tab-btn[data-tab="law3"].active  { background: linear-gradient(135deg, #4a0a7e, var(--law3)); }
  .tab-btn[data-tab="quiz"].active  { background: linear-gradient(135deg, #a08000, var(--gold)); color: #1A1A2E; }
  .tab-btn[data-tab="energy"].active { background: linear-gradient(135deg, #166534, var(--energy)); }
  .tab-btn[data-tab="gravity"].active { background: linear-gradient(135deg, #881337, var(--gravity)); }

  /* ENERGY & GRAVITY SECTION COMPONENTS */
  .section-header { border-radius: 16px; padding: 22px; margin-bottom: 20px; }
  .section-tagline { margin: 0; opacity: 0.9; font-size: 16px; }
  .law-explanation { background: var(--card); border-radius: 16px; padding: 22px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.3); }
  .real-world-box { background: var(--card); border-radius: 16px; padding: 22px; margin-bottom: 20px; border: 2px solid; box-shadow: 0 4px 16px rgba(0,0,0,0.3); }
  .real-world-box h4 { margin-bottom: 10px; }
  .real-world-box ul { padding-right: 16px; }
  .real-world-box li { padding: 4px 0; font-size: 15px; }
  .experiment-card { background: var(--card); border-radius: 16px; padding: 22px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.3); }
  .info-box { background: var(--card); border-radius: 16px; padding: 22px; margin-bottom: 20px; border: 2px solid; box-shadow: 0 4px 16px rgba(0,0,0,0.3); }
  .btn-dim { background: #444; color: #ddd; }

  /* MAIN */
  #main {
    max-width: 860px;
    margin: 0 auto;
    padding: 20px 16px 60px;
  }

  .section { display: none; }
  .section.active { display: block; }

  /* CARDS */
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 22px;
    margin-bottom: 20px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  }

  .card-law1  { border-right: 5px solid var(--law1); border-left: none; }
  .card-law2  { border-right: 5px solid var(--law2); border-left: none; }
  .card-law3  { border-right: 5px solid var(--law3); border-left: none; }
  .card-quiz  { border-right: 5px solid var(--gold); border-left: none; }
  .card-home  { border-right: 5px solid var(--success); border-left: none; }

  h1 { font-size: 28px; margin-bottom: 12px; }
  h2 { font-size: 22px; margin-bottom: 10px; }
  h3 { font-size: 19px; margin-bottom: 8px; }
  p  { line-height: 1.65; margin-bottom: 10px; font-size: 16px; }

  .highlight-box {
    border-radius: 12px;
    padding: 16px;
    margin: 14px 0;
    font-size: 17px;
    font-weight: 600;
    line-height: 1.5;
  }

  .hl-law1 { background: rgba(0,201,255,0.12);   border: 2px solid rgba(0,201,255,0.4);   color: #cff5ff; }
  .hl-law2 { background: rgba(255,107,53,0.12);  border: 2px solid rgba(255,107,53,0.4);  color: #ffe5d8; }
  .hl-law3 { background: rgba(123,47,190,0.12);  border: 2px solid rgba(123,47,190,0.4);  color: #e8d4ff; }
  .hl-gold { background: rgba(255,215,0,0.12);   border: 2px solid rgba(255,215,0,0.4);   color: #fff5c0; }

  .examples-list { list-style: none; padding: 0; margin: 10px 0; }
  .examples-list li {
    padding: 8px 32px 8px 12px;
    position: relative;
    font-size: 16px;
    line-height: 1.5;
  }
  .examples-list li::before { content: '\25C0'; position: absolute; right: 8px; opacity: 0.7; }

  /* BUTTONS */
  .btn {
    display: inline-block;
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    transition: all 0.2s;
    text-align: center;
    line-height: 1.2;
    font-family: Arial, Tahoma, sans-serif;
  }
  .btn:hover   { filter: brightness(1.15); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
  .btn:active  { transform: translateY(0); }

  .btn-law1    { background: var(--law1);    color: #002030; }
  .btn-law2    { background: var(--law2);    color: #fff; }
  .btn-law3    { background: var(--law3);    color: #fff; }
  .btn-gold    { background: var(--gold);    color: #1A1A2E; }
  .btn-success { background: var(--success); color: #fff; }
  .btn-danger  { background: var(--danger);  color: #fff; }
  .btn-gray    { background: #444;           color: #ddd; }

  .btn-sm { padding: 8px 16px;   font-size: 14px; }
  .btn-lg { padding: 14px 32px;  font-size: 18px; }

  .btn-row { display: flex; flex-wrap: wrap; gap: 10px; margin: 12px 0; align-items: center; }

  /* CANVAS */
  canvas {
    display: block;
    border-radius: 10px;
    background: #0a0a1a;
    width: 100%;
    height: auto;
    max-width: 100%;
  }

  .canvas-wrap {
    position: relative;
    margin: 14px 0;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid rgba(255,255,255,0.1);
  }

  /* SLIDERS */
  .slider-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 10px 0;
    flex-wrap: wrap;
    flex-direction: row-reverse;
  }
  .slider-label { min-width: 120px; font-size: 15px; font-weight: 600; text-align: right; }

  input[type=range] {
    flex: 1;
    min-width: 120px;
    height: 8px;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background: #333;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px; height: 22px;
    border-radius: 50%;
    cursor: pointer;
  }
  .slider-law1 { accent-color: var(--law1); }
  .slider-law1::-webkit-slider-thumb { background: var(--law1); }
  .slider-law2 { accent-color: var(--law2); }
  .slider-law2::-webkit-slider-thumb { background: var(--law2); }
  .slider-law3 { accent-color: var(--law3); }
  .slider-law3::-webkit-slider-thumb { background: var(--law3); }

  .slider-val { min-width: 64px; font-size: 16px; font-weight: 700; text-align: left; }

  /* STATS */
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin: 14px 0;
  }
  .stat-box  { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 14px; text-align: center; }
  .stat-label { font-size: 13px; color: var(--text-dim); margin-bottom: 4px; }
  .stat-value { font-size: 22px; font-weight: 700; }

  /* SURFACE BUTTONS */
  .surface-btn {
    padding: 10px 16px;
    border-radius: 8px;
    border: 2px solid transparent;
    background: #1a2040;
    color: #ccc;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    font-family: Arial, Tahoma, sans-serif;
  }
  .surface-btn:hover { filter: brightness(1.3); }
  .surface-btn.selected { border-color: var(--law1); background: rgba(0,201,255,0.2); color: #fff; }

  /* QUIZ */
  .quiz-question {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 16px;
  }
  .q-text { font-size: 17px; font-weight: 600; margin-bottom: 12px; line-height: 1.5; }
  .q-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  @media (max-width: 480px) { .q-options { grid-template-columns: 1fr; } }

  .q-opt {
    padding: 12px 16px;
    border-radius: 9px;
    border: 2px solid #444;
    background: #1a2040;
    color: #ddd;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    text-align: right;
    transition: all 0.2s;
    line-height: 1.4;
    font-family: Arial, Tahoma, sans-serif;
  }
  .q-opt:hover    { border-color: var(--gold); color: #fff; background: rgba(255,215,0,0.1); }
  .q-opt.correct  { background: rgba(76,175,80,0.25);  border-color: var(--success); color: #a0ffb0; }
  .q-opt.wrong    { background: rgba(244,67,54,0.25);  border-color: var(--danger);  color: #ffb0b0; }
  .q-opt.disabled { cursor: not-allowed; opacity: 0.7; }

  .q-explanation { margin-top: 10px; padding: 10px 14px; border-radius: 8px; font-size: 15px; line-height: 1.5; display: none; }
  .q-explanation.show         { display: block; }
  .q-explanation.correct-exp  { background: rgba(76,175,80,0.15);  color: #a0ffb0; border: 1px solid rgba(76,175,80,0.4); }
  .q-explanation.wrong-exp    { background: rgba(244,67,54,0.15);  color: #ffb0b0; border: 1px solid rgba(244,67,54,0.4); }

  /* COMPLETION */
  #completion-screen  { text-align: center; padding: 30px 20px; }
  .trophy-heading     { font-size: 32px; color: var(--gold); margin-bottom: 16px; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
  .final-score        { font-size: 52px; font-weight: 900; color: var(--gold); margin: 16px 0; }
  .stars-big          { font-size: 40px; letter-spacing: 6px; margin: 14px 0; }

  .law-summaries {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 14px;
    margin: 24px 0;
    text-align: right;
  }
  .law-summary-card { border-radius: 12px; padding: 16px; font-size: 15px; line-height: 1.5; }

  /* NOTIFICATION */
  #notif {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--success);
    color: #fff;
    padding: 14px 28px;
    border-radius: 30px;
    font-size: 17px;
    font-weight: 700;
    z-index: 9999;
    transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    white-space: nowrap;
  }
  #notif.show { transform: translateX(-50%) translateY(0); }

  /* HOME */
  .home-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }
  .home-law-card {
    border-radius: 14px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.25s;
    text-align: center;
  }
  .home-law-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
  .home-law-card h3 { font-size: 20px; margin-bottom: 8px; }
  .home-law-card p  { font-size: 14px; opacity: 0.85; margin: 0; }

  .home-card-1    { background: linear-gradient(135deg, #003050, #004870); border: 2px solid var(--law1); }
  .home-card-2    { background: linear-gradient(135deg, #3a1400, #5a2000); border: 2px solid var(--law2); }
  .home-card-3    { background: linear-gradient(135deg, #250a40, #3d1060); border: 2px solid var(--law3); }
  .home-card-quiz { background: linear-gradient(135deg, #302000, #504000); border: 2px solid var(--gold); }

  .done-badge {
    display: inline-block;
    background: var(--success);
    color: #fff;
    border-radius: 12px;
    padding: 3px 10px;
    font-size: 13px;
    font-weight: 700;
    margin-top: 8px;
  }

  /* TOGGLE */
  .toggle-wrap { display: flex; align-items: center; gap: 10px; margin: 10px 0; flex-direction: row-reverse; justify-content: flex-end; }
  .toggle-switch { position: relative; width: 52px; height: 28px; display: inline-block; }
  .toggle-switch input { display: none; }
  .toggle-slider {
    position: absolute; inset: 0;
    background: #444;
    border-radius: 14px;
    cursor: pointer;
    transition: 0.3s;
  }
  .toggle-slider:before {
    content: '';
    position: absolute;
    width: 22px; height: 22px;
    left: 3px; top: 3px;
    border-radius: 50%;
    background: #aaa;
    transition: 0.3s;
  }
  .toggle-switch input:checked + .toggle-slider { background: var(--law1); }
  .toggle-switch input:checked + .toggle-slider:before { background: #fff; transform: translateX(24px); }
  .atmosphere-status { font-size: 16px; font-weight: 700; }

  /* ALTITUDE BAR */
  .altitude-wrap { display: flex; align-items: flex-end; gap: 10px; height: 200px; margin: 12px 0; }
  .altitude-bar-outer {
    width: 40px; height: 100%;
    background: rgba(0,0,0,0.4);
    border-radius: 8px;
    border: 2px solid #444;
    position: relative;
    overflow: hidden;
  }
  .altitude-bar-inner {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: linear-gradient(to top, var(--law3), #ff80ff);
    transition: height 0.1s;
    border-radius: 6px;
  }
  .altitude-label { font-size: 13px; color: var(--text-dim); writing-mode: vertical-rl; transform: rotate(180deg); }

  @media (max-width: 600px) {
    h1 { font-size: 22px; }
    h2 { font-size: 18px; }
    .btn-lg { font-size: 16px; padding: 12px 24px; }
    #header-title { font-size: 15px; }
    .tab-btn { padding: 8px 12px; font-size: 13px; }
  }
.lang-switch { color: var(--gold); border: 1px solid var(--gold); border-radius: 20px; padding: 4px 12px; font-size: 14px; text-decoration: none; white-space: nowrap; transition: background 0.2s; }
.lang-switch:hover { background: rgba(255,215,0,0.15); }
</style>
</head>
<body>

<!-- HEADER -->
<div id="header">
  <div id="header-title">×—×•×§×™ × ×™×•×˜×•×Ÿ: ×”×¨×¤×ª×§×ª ×¤×™×–×™×§×”! ğŸš€</div>
  <div id="score-display">
    <div id="stars-display">&#9734;&#9734;&#9734;&#9734;&#9734;</div>
    <div id="score-text">× ×™×§×•×“: 0 / 1200</div>
    <div id="progress-dots">
      <div class="dot" id="dot-law1" title="×—×•×§ 1: ××™× ×¨×¦×™×”"></div>
      <div class="dot" id="dot-law2" title="×—×•×§ 2: ×›×•×—=××¡×”Ã—×ª××•×¦×”"></div>
      <div class="dot" id="dot-law3" title="×—×•×§ 3: ×¤×¢×•×œ×”/×ª×’×•×‘×”"></div>
      <div class="dot" id="dot-energy" title="×× ×¨×’×™×”"></div>
      <div class="dot" id="dot-gravity" title="×›×‘×™×“×” ×•×ª× ×•×¢×ª ×§×œ×™×¢×™×"></div>
      <div class="dot" id="dot-quiz" title="×—×™×“×•×Ÿ"></div>
    </div>
  </div>
  <div id="progress-bar-wrap" style="flex-basis:100%"><div id="progress-bar"></div></div>
  <a href="index.en.html" class="lang-switch">ğŸ‡ºğŸ‡¸ English</a>
</div>

<!-- NAV TABS -->
<div id="nav-tabs">
  <button class="tab-btn active" data-tab="home">&#127968; ×‘×™×ª</button>
  <button class="tab-btn" data-tab="law1">&#128309; ×—×•×§ 1</button>
  <button class="tab-btn" data-tab="law2">&#128992; ×—×•×§ 2</button>
  <button class="tab-btn" data-tab="law3">&#128995; ×—×•×§ 3</button>
  <button class="tab-btn" data-tab="energy">âš¡ ×× ×¨×’×™×”</button>
  <button class="tab-btn" data-tab="gravity">ğŸŒ ×›×‘×™×“×”</button>
  <button class="tab-btn" data-tab="quiz">&#10067; ×—×™×“×•×Ÿ</button>
</div>

<div id="main">

  <!-- ======== HOME ======== -->
  <div class="section active" id="sec-home">
    <div class="card card-home">
      <h1>×‘×¨×•×›×™× ×”×‘××™× ×œ×¢×•×œ× ×”×¤×™×–×™×§×”! ğŸ‰</h1>
      <p>×’×œ×• ××ª ×—×•×§×™ × ×™×•×˜×•×Ÿ - ×©×œ×•×©×” ×—×•×§×™× ×©××¡×‘×™×¨×™× ×›×™×¦×“ ×”×›×œ × ×¢ ×‘×™×§×•×!</p>
      <p>×™×¦×—×§ × ×™×•×˜×•×Ÿ ×’×™×œ×” ×©×œ×•×©×” ×›×œ×œ×™× ××“×”×™××™× ×©××¡×‘×™×¨×™× ×›×™×¦×“ ×”×›×œ ×‘×™×§×•× × ×¢ â€” ××“×™×¡×§×™ ×”×•×§×™ ×•×¢×“ ×¨×§×˜×•×ª ×•×¢×“ ×—×’×•×¨×•×ª ×‘×˜×™×—×•×ª. ×”×—×•×§×™× ×”××œ×” × ××¦××™× ×‘×›×œ ××§×•×!</p>
      <p>×—×§×¨×• ×›×œ ×—×•×§, ×‘×¦×¢×• × ×™×¡×•×™×™×, ×•×”×•×›×™×—×• ×©××ª× ××œ×•×¤×™ ×¤×™×–×™×§×” ×¢×œ ×™×“×™ ×¤×ª×¨×•×Ÿ ×”×—×™×“×•×Ÿ!</p>
    </div>

    <div class="home-grid">
      <div class="home-law-card home-card-1" onclick="switchTab('law1')">
        <h3>&#128309; ×—×•×§ 1</h3>
        <h3>××™× ×¨×¦×™×”</h3>
        <p>×’×•×£ ×©× ×¢ ×××©×™×š ×œ× ×•×¢. ×’×•×£ ×‘×× ×•×—×” × ×©××¨ ×‘×× ×•×—×”!</p>
        <div id="home-done-1" style="display:none"><span class="done-badge">&#10003; ×”×•×©×œ×!</span></div>
      </div>
      <div class="home-law-card home-card-2" onclick="switchTab('law2')">
        <h3>&#128992; ×—×•×§ 2</h3>
        <h3>×›×•×— = ××¡×” &times; ×ª××•×¦×”</h3>
        <p>×“×—×™×¤×” ×—×–×§×” ×™×•×ª×¨ = ×ª××•×¦×” ×’×“×•×œ×” ×™×•×ª×¨. ×›×‘×“ ×™×•×ª×¨ = ×¦×¨×™×š ×™×•×ª×¨ ×›×•×—!</p>
        <div id="home-done-2" style="display:none"><span class="done-badge">&#10003; ×”×•×©×œ×!</span></div>
      </div>
      <div class="home-law-card home-card-3" onclick="switchTab('law3')">
        <h3>&#128995; ×—×•×§ 3</h3>
        <h3>×¤×¢×•×œ×” &amp; ×ª×’×•×‘×”</h3>
        <p>×œ×›×œ ×¤×¢×•×œ×” ×™×© ×ª×’×•×‘×” ×©×•×•×” ×•×× ×•×’×“×ª!</p>
        <div id="home-done-3" style="display:none"><span class="done-badge">&#10003; ×”×•×©×œ×!</span></div>
      </div>
      <div class="home-law-card" style="border-color:var(--energy);background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.05))" onclick="switchTab('energy')">
        <div style="font-size:2em">âš¡</div>
        <h3 style="color:var(--energy)">×©×™××•×¨ ×”×× ×¨×’×™×”</h3>
        <p>×× ×¨×’×™×” ×œ× × ×•×¦×¨×ª ×•×œ× × ×¢×œ××ª â€” ×”×™× ×¨×§ ××©× ×” ×¦×•×¨×”!</p>
      </div>
      <div class="home-law-card" style="border-color:var(--gravity);background:linear-gradient(135deg,rgba(225,29,72,0.15),rgba(225,29,72,0.05))" onclick="switchTab('gravity')">
        <div style="font-size:2em">ğŸŒ</div>
        <h3 style="color:var(--gravity)">×›×‘×™×“×” ×•×§×œ×™×¢×™×</h3>
        <p>×”×›×‘×™×“×” ××¢×§××ª ×›×œ ×¢×¦× ×–×¨×•×§ ×œ×¤×¨×‘×•×œ×”!</p>
      </div>
      <div class="home-law-card home-card-quiz" onclick="switchTab('quiz')">
        <h3>&#10067; ×—×™×“×•×Ÿ</h3>
        <h3>×‘×—×Ÿ ××ª ×¢×¦××š!</h3>
        <p>5 ×©××œ×•×ª. ×¢×“ 200 × ×§×•×“×•×ª. ××•×›× ×™×?</p>
        <div id="home-done-quiz" style="display:none"><span class="done-badge">&#10003; ×”×•×©×œ×!</span></div>
      </div>
    </div>

    <div class="card" id="completion-screen" style="display:none">
      <div class="trophy-heading">&#127942; ××œ×•×£ ×”×¤×™×–×™×§×”! &#127942;</div>
      <div class="stars-big" id="final-stars">&#11088;&#11088;&#11088;&#11088;&#11088;</div>
      <div class="final-score" id="final-score-display">0 / 1200</div>
      <p style="font-size:18px; color:#ccc; margin-bottom:20px;">×¡×™×™××ª ××ª ×›×œ ×”× ×™×¡×•×™×™× ×•×¢×‘×¨×ª ××ª ×”×—×™×“×•×Ÿ!</p>
      <p style="font-size:16px; color:var(--gold); margin-bottom:10px;">×”× ×™×§×•×“ ×”×¡×•×¤×™ ×©×œ×š: <span id="final-score-display-2"></span> ××ª×•×š 1200</p>
      <p style="font-size:18px; color:#ccc; margin-bottom:20px;">×ª×¢×•×“×ª ××œ×•×£ ×¤×™×–×™×§×” â€” ×©×œ×˜×ª ×‘×©×œ×•×©×ª ×—×•×§×™ × ×™×•×˜×•×Ÿ!</p>
      <div class="law-summaries">
        <div class="law-summary-card hl-law1">
          <strong>&#128309; ×—×•×§ 1 â€” ××™× ×¨×¦×™×”:</strong><br>
          ×’×•×£ ×××©×™×š ×œ×¢×©×•×ª ××” ×©×”×•× ×¢×•×©×” ××œ× ×× ×›×Ÿ ×›×•×— ×¤×•×¢×œ ×¢×œ×™×•. ×œ×›×Ÿ ×—×’×•×¨×•×ª ×”×‘×˜×™×—×•×ª ××¦×™×œ×•×ª ×—×™×™×!
        </div>
        <div class="law-summary-card hl-law2">
          <strong>&#128992; ×—×•×§ 2 â€” ×›×•×—=××¡×”&times;×ª××•×¦×”:</strong><br>
          ×›×•×— ×©×•×•×” ××¡×” ×›×¤×•×œ ×ª××•×¦×”. ×“×—×¤×• ×—×–×§ ×™×•×ª×¨ ××• ×”×¤×—×™×ª×• ××¡×” ×›×“×™ ×œ×”××™×¥ ××”×¨ ×™×•×ª×¨!
        </div>
        <div class="law-summary-card hl-law3">
          <strong>&#128995; ×—×•×§ 3 â€” ×¤×¢×•×œ×”/×ª×’×•×‘×”:</strong><br>
          ×œ×›×œ ×“×—×™×¤×” ×™×© ×“×—×™×¤×” ×—×–×¨×” ×©×•×•×” ×‘×›×™×•×•×Ÿ ×”× ×’×“×™. ×›×š ×¨×§×˜×•×ª ×¢×¤×•×ª!
        </div>
      </div>
      <button class="btn btn-gold btn-lg" onclick="resetGame()">×©×—×§ ×©×•×‘! &#128260;</button>
    </div>
  </div>

  <!-- ======== LAW 1 ======== -->
  <div class="section" id="sec-law1">
    <div class="card card-law1">
      <h1>&#128309; ×—×•×§ 1: ×—×•×§ ×”××™× ×¨×¦×™×”</h1>
      <div class="highlight-box hl-law1">
        "×’×•×£ ×©× ××¦× ×‘×× ×•×—×” ×™×©××¨ ×‘×× ×•×—×”, ×•×’×•×£ ×©× ×¢ ×™××©×™×š ×œ× ×•×¢ ×‘××•×ª×” ××”×™×¨×•×ª â€” ××œ× ×× ×›×Ÿ ×›×•×— ×›×œ×©×”×• ×¤×•×¢×œ ×¢×œ×™×•! &#127944;"
      </div>
      <p>×–×” × ×§×¨× <strong>××™× ×¨×¦×™×”</strong> â€” ×”× ×˜×™×™×” ×©×œ ×’×•×¤×™× ×œ×”×ª× ×’×“ ×œ×©×™× ×•×™×™× ×‘×ª× ×•×¢×ª×.</p>
      <p>×“×•×’×××•×ª ××”×—×™×™×:</p>
      <ul class="examples-list">
        <li><strong>×—×’×•×¨×ª ×‘×˜×™×—×•×ª ×‘×¨×›×‘:</strong> ×›×©×¨×›×‘ ×¢×•×¦×¨ ×¤×ª××•×, ×”×’×•×£ ×©×œ×š ×××©×™×š ×œ× ×•×¢ ×§×“×™××”. ×—×’×•×¨×ª ×”×‘×˜×™×—×•×ª ×”×™× ×”×›×•×— ×©×¢×•×¦×¨ ××•×ª×š!</li>
        <li><strong>×“×™×¡×§ ×”×•×§×™ ×¢×œ ×§×¨×—:</strong> ×¢×œ ×§×¨×— ×—×œ×§, ×”×“×™×¡×§ ××—×œ×™×§ ××¨×—×§ ×¨×‘ ×××•×“ ×›×™ ×›××¢×˜ ××™×Ÿ ×—×™×›×•×š ×©×××˜ ××•×ª×•.</li>
        <li><strong>×—×œ×œ×™×ª ×©×“×•××” ×‘×—×œ×œ:</strong> ×œ×œ× ×—×™×›×•×š ××•×•×™×¨ ×‘×—×œ×œ, ×—×œ×œ×™×ª ×©× ×–×¨×§×ª ×§×“×™××” ×“×•××” ×œ× ×¦×— ××œ× ×× ×× ×•×¢×™× × ×“×œ×§×™×!</li>
        <li><strong>×˜×¨×™×§ ××¤×ª ×”×©×•×œ×—×Ÿ:</strong> ××©×™×›×ª ××¤×” ××”×™×¨×” ××•×ª×™×¨×” ××ª ×”×›×œ×™× ×‘××§×•× ×‘×’×œ×œ ×”××™× ×¨×¦×™×” ×©×œ×”×!</li>
      </ul>
    </div>

    <!-- Game 1A: Surface Slide -->
    <div class="card card-law1">
      <h2>&#127918; × ×™×¡×•×™: ×”×—×œ×§×” ×¢×œ ××©×˜×—×™× ×©×•× ×™×</h2>
      <p>×‘×¢×˜×• ×‘×“×™×¡×§ ×¢×œ ××©×˜×—×™× ×©×•× ×™×. ×©×™××• ×œ×‘ ×›×™×¦×“ ×”×—×™×›×•×š ××©× ×” ××ª ×”××¨×—×§ ×©×”×•× ×¢×•×‘×¨!</p>

      <div class="btn-row" id="surface-btns">
        <button class="surface-btn selected" data-surface="ice"   onclick="selectSurface('ice',this)">×§×¨×— â„ï¸ (&#956;=0.005)</button>
        <button class="surface-btn"          data-surface="wood"  onclick="selectSurface('wood',this)">×¢×¥ ğŸªµ (&#956;=0.04)</button>
        <button class="surface-btn"          data-surface="grass" onclick="selectSurface('grass',this)">×“×©× ğŸŒ± (&#956;=0.09)</button>
        <button class="surface-btn"          data-surface="sand"  onclick="selectSurface('sand',this)">×—×•×œ ğŸ–ï¸ (&#956;=0.15)</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-slide" width="780" height="180">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×§× ×‘×¡. ×× × ×”×©×ª××©×• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ×œ×¦×¤×™×™×” ×‘×”× ×¤×©×”.</canvas>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">××©×˜×—:</div>
          <div class="stat-value" id="slide-surface-name" style="color:var(--law1);font-size:16px">×§×¨×—</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×—×™×›×•×š (&#956;)</div>
          <div class="stat-value" id="slide-friction-val" style="color:var(--law1)">0.005</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××¨×—×§:</div>
          <div class="stat-value" id="slide-distance" style="color:var(--law1)">-- ×'</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××”×™×¨×•×ª:</div>
          <div class="stat-value" id="slide-speed" style="color:var(--law1)">0 ×'/×©'</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law1 btn-lg" onclick="kickPuck()">×‘×¢×™×˜×”! ğŸ¦µ</button>
        <button class="btn btn-gray btn-sm" onclick="resetSlide()">××¤×¡</button>
        <span id="slide-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 × ×§×•×“×•×ª!</span>
      </div>
    </div>

    <!-- Game 1B: Space Drift -->
    <div class="card card-law1">
      <h2>&#127918; × ×™×¡×•×™: ×©×™×™×˜ ×‘×—×œ×œ</h2>
      <p>×”×¤×¢×™×œ×• ×× ×•×¢ ×¨×§×˜×”. ×”×¤×¢×™×œ×•/×›×‘×• ××˜××•×¡×¤×¨×”. ×‘×—×œ×œ, ×©×•× ×“×‘×¨ ×œ× ×××˜ ××ª×›×!</p>

      <div class="toggle-wrap">
        <label class="toggle-switch">
          <input type="checkbox" id="atmos-toggle" onchange="toggleAtmosphere()">
          <span class="toggle-slider"></span>
        </label>
        <span class="atmosphere-status" id="atmos-label" style="color:#888">××˜××•×¡×¤×¨×”: ×›×‘×•×™</span>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-space" width="780" height="200">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×§× ×‘×¡. ×× × ×”×©×ª××©×• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ×œ×¦×¤×™×™×” ×‘×”× ×¤×©×”.</canvas>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">××˜××•×¡×¤×¨×”:</div>
          <div class="stat-value" id="space-atmos-status" style="color:#888;font-size:15px">×›×‘×•×™</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××”×™×¨×•×ª:</div>
          <div class="stat-value" id="space-speed" style="color:var(--law1)">0 ×'/×©'</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××¨×—×§:</div>
          <div class="stat-value" id="space-distance" style="color:var(--law1)">0 ×'</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law1 btn-lg"
          onmousedown="startThrust()" onmouseup="stopThrust()"
          ontouchstart="startThrust()" ontouchend="stopThrust()">×”×¤×¢×œ ×× ×•×¢ ğŸš€</button>
        <button class="btn btn-gray btn-sm" onclick="resetSpace()">××¤×¡</button>
        <span id="space-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 × ×§×•×“×•×ª!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim)">×˜×™×¤: ×”×¤×¢×™×œ×• ×× ×•×¢, ×•××– ×¢×¦×¨×•. ×›×©×”××˜××•×¡×¤×¨×” ×›×‘×•×™×”, ×”×¨×§×˜×” ×“×•××” ×œ× ×¦×—!</p>
    </div>
  </div>

  <!-- ======== LAW 2 ======== -->
  <div class="section" id="sec-law2">
    <div class="card card-law2">
      <h1>&#128992; ×—×•×§ 2: ×›×•×— = ××¡×” &times; ×ª××•×¦×”</h1>
      <div class="highlight-box hl-law2">
        "×›×›×œ ×©×“×•×—×¤×™× ×—×–×§ ×™×•×ª×¨, ×›×š ×”×’×•×£ ×××™×¥ ××”×¨ ×™×•×ª×¨! ××‘×œ ×’×•×¤×™× ×›×‘×“×™× ×¦×¨×™×›×™× ×™×•×ª×¨ ×›×•×— ×›×“×™ ×œ×–×•×–. ×”× ×•×¡×—×”: ×ª××•×¦×” = ×›×•×— &divide; ××¡×” &#128640;"
      </div>
      <p>××©××¢×•×ª ×”×“×‘×¨: ×× ×ª×“×—×¤×• ×¢×’×œ×ª ×§× ×™×•×ª ×•×¨×›×‘ ×¢× ××•×ª×• ×›×•×—, ×”×¢×’×œ×” ×ª××™×¥ ×”×¨×‘×” ×™×•×ª×¨ ×›×™ ×”×™× ×§×œ×” ×‘×”×¨×‘×”.</p>
      <ul class="examples-list">
        <li><strong>×›×“×•×¨ ×›×“×•×¨×’×œ ×œ×¢×•××ª ×›×“×•×¨ ×›×“×•×¨×ª ×¢× ××•×ª×• ×›×•×—:</strong> ×‘×¢×˜×• ×‘×©× ×™×”× ×¢× ××•×ª×• ×›×•×—. ×”×›×“×•×¨ ×”×§×œ ×™×¢×•×£ â€” ×”×›×“×•×¨ ×”×›×‘×“ ×™×ª×’×œ×’×œ ×œ××˜.</li>
        <li><strong>×¢×’×œ×ª ×§× ×™×•×ª ×¨×™×§×” ×œ×¢×•××ª ××œ××”:</strong> ××•×ª×” ×“×—×™×¤×”, ×ª×•×¦××•×ª ×©×•× ×•×ª ×œ×—×œ×•×˜×™×Ÿ! ×”×¨×›×‘ ×›××¢×˜ ×œ× ×™×–×•×–.</li>
        <li><strong>××©××™×ª ×¨×™×§×” ×œ×¢×•××ª ×˜×¢×•× ×”:</strong> ×›×“×™ ×œ×”×¨×™× ×¨×§×˜×” ×›×‘×“×”, ×¦×¨×™×š ×›×•×— ×¢×¦×•× ××©×¨×™×¤×ª ×“×œ×§!</li>
      </ul>
    </div>

    <div class="card card-law2">
      <h2>&#127918; × ×™×¡×•×™: ××¢×‘×“×ª ×›×•×— ×•××¡×”</h2>
      <p>×©× ×• ××ª ×”×›×•×— ×•×”××¡×” ×•×¨××• ×›×™×¦×“ ×”×ª××•×¦×” ××©×ª× ×”. × ×¡×• ××ª ×”××•×‘×™×™×§×˜×™× ×”××•×’×“×¨×™× ××¨××©!</p>

      <div class="slider-row">
        <span class="slider-label">×›×•×— (× ×™×•×˜×•×Ÿ):</span>
        <input type="range" class="slider-law2" id="force-slider" min="10" max="100" value="50" oninput="updateFMA()">
        <span class="slider-val" id="force-val" style="color:var(--law2)">50 N</span>
      </div>

      <div class="slider-row">
        <span class="slider-label">××¡×” (×§"×’):</span>
        <input type="range" class="slider-law2" id="mass-slider" min="1" max="20" value="5" oninput="updateFMA()">
        <span class="slider-val" id="mass-val" style="color:var(--law2)">5 ×§"×’</span>
      </div>

      <div class="highlight-box hl-law2" style="text-align:center;font-size:20px;margin:14px 0;">
        ×ª××•×¦×” = ×›×•×— &divide; ××¡×” = <span id="fma-calc" style="color:var(--gold);font-size:24px;font-weight:900">10.0 ×'/×©'&sup2;</span>
      </div>

      <div class="btn-row">
        <span style="font-size:14px;color:var(--text-dim);margin-right:4px">×‘×—×™×¨×” ××”×™×¨×”:</span>
        <button class="btn btn-gray btn-sm" onclick="setPreset(0.45,'×›×“×•×¨ ×›×“×•×¨×’×œ')">×›×“×•×¨ ×›×“×•×¨×’×œ âš½ (0.45 ×§"×’)</button>
        <button class="btn btn-gray btn-sm" onclick="setPreset(5,'×§×•×¤×¡×”')">×§×•×¤×¡×” ğŸ“¦ (5 ×§"×’)</button>
        <button class="btn btn-gray btn-sm" onclick="setPreset(20,'×¡×œ×¢')">×¡×œ×¢ ğŸª¨ (20 ×§"×’)</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-fma" width="780" height="180">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×§× ×‘×¡. ×× × ×”×©×ª××©×• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ×œ×¦×¤×™×™×” ×‘×”× ×¤×©×”.</canvas>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">×›×•×—</div>
          <div class="stat-value" id="fma-f" style="color:var(--law2)">50 N</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××¡×”</div>
          <div class="stat-value" id="fma-m" style="color:var(--law2)">5 ×§"×’</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×ª××•×¦×”</div>
          <div class="stat-value" id="fma-a" style="color:var(--gold)">10.0 ×'/×©'&sup2;</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×¢×¦×</div>
          <div class="stat-value" id="fma-obj" style="color:var(--law2);font-size:14px">××•×ª×× ××™×©×™×ª</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law2 btn-lg" onclick="launchFMA()">×©×’×¨! &#128640;</button>
        <button class="btn btn-success btn-lg" onclick="raceMode()">××¨×•×¥! &#127937;</button>
        <button class="btn btn-gray btn-sm" onclick="resetFMA()">××¤×¡</button>
      </div>
      <p style="font-size:14px;color:var(--text-dim)">××¦×‘ ××¨×•×¥ ××©×’×¨ ×›×“×•×¨ ×›×“×•×¨×’×œ, ×§×•×¤×¡×” ×•×¡×œ×¢ ×‘×•-×–×× ×™×ª ×¢× ××•×ª×• ×›×•×—!</p>
      <div style="margin-top:8px">
        <span id="fma-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">× ×™×§×•×“!</span>
      </div>
    </div>
  </div>

  <!-- ======== LAW 3 ======== -->
  <div class="section" id="sec-law3">
    <div class="card card-law3">
      <h1>&#128995; ×—×•×§ 3: ×¤×¢×•×œ×” ×•×ª×’×•×‘×”</h1>
      <div class="highlight-box hl-law3">
        "×œ×›×œ ×¤×¢×•×œ×” ×™×© ×ª×’×•×‘×” ×©×•×•×” ×‘×’×•×“×œ×” ×•×× ×•×’×“×ª ×‘×›×™×•×•× ×”! ×›×š ×˜×™×œ×™× ××ª×¨×•×××™× ×œ××•×•×™×¨! &#128640;"
      </div>
      <p>×”××™×œ×” ×”××¤×ª×— ×”×™× <strong>×©×•×•×” ×•×× ×•×’×“</strong>. ×”×›×•×—×•×ª ×©×•×•×™× ×‘×¢×•×¦××”, ××š ×‘×›×™×•×•× ×™× ×”×¤×•×›×™×!</p>
      <ul class="examples-list">
        <li><strong>×× ×•×¢ ×¡×™×œ×•×Ÿ:</strong> ×”×× ×•×¢×™× ×“×•×—×¤×™× ×’×–×™× ×—××™× ×œ××˜×” â€” ×”×’×–×™× ×“×•×—×¤×™× ××ª ×”×¨×§×˜×” ×œ××¢×œ×”!</li>
        <li><strong>×‘×œ×•×Ÿ ×©××©×—×¨×¨ ××•×•×™×¨:</strong> ×”×‘×œ×•×Ÿ ×“×•×—×£ ××•×•×™×¨ ××—×•×¨×” â€” ×”××•×•×™×¨ ×“×•×—×£ ××ª ×”×‘×œ×•×Ÿ ×§×“×™××”!</li>
        <li><strong>×©×—×™×™×Ÿ ×©×“×•×—×£ ××ª ×”×§×™×¨:</strong> ×”×™×“×™×™× ×“×•×—×¤×•×ª ××™× ××—×•×¨×” â€” ×”××™× ×“×•×—×¤×™× ××ª ×”×©×—×™×™×Ÿ ×§×“×™××”!</li>
        <li><strong>×§×¤×™×¦×” ××¡×™×¨×”:</strong> ××ª× ×“×•×—×¤×™× ××ª ×”×¡×™×¨×” ×›×©××ª× ×§×•×¤×¦×™× â€” ×”×¡×™×¨×” ××ª×¨×—×§×ª ×‘×›×™×•×•×Ÿ ×”×”×¤×•×š!</li>
      </ul>
    </div>

    <!-- Game 3A: Balloon Rocket -->
    <div class="card card-law3">
      <h2>&#127918; × ×™×¡×•×™: ×¨×§×˜×ª ×‘×œ×•×Ÿ</h2>
      <p>× ×¤×—×• ××ª ×”×‘×œ×•×Ÿ ×™×•×ª×¨ ×œ×›×•×— ×ª×’×•×‘×” ×’×“×•×œ ×™×•×ª×¨!</p>

      <div class="slider-row">
        <span class="slider-label">× ×™×¤×•×—:</span>
        <input type="range" class="slider-law3" id="balloon-slider" min="10" max="100" value="60" oninput="updateBalloon()">
        <span class="slider-val" id="balloon-val" style="color:var(--law3)">60%</span>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-balloon" width="780" height="190">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×§× ×‘×¡. ×× × ×”×©×ª××©×• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ×œ×¦×¤×™×™×” ×‘×”× ×¤×©×”.</canvas>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">× ×™×¤×•×—</div>
          <div class="stat-value" id="bal-inflation" style="color:var(--law3)">60%</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×›×•×— ×”××•×•×™×¨</div>
          <div class="stat-value" id="bal-force" style="color:var(--law3)">60 N</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××¨×—×§:</div>
          <div class="stat-value" id="bal-distance" style="color:var(--law3)">-- ×'</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law3 btn-lg" onclick="releaseBalloon()">×©×—×¨×¨! &#128168;</button>
        <button class="btn btn-gray btn-sm" onclick="resetBalloon()">××¤×¡</button>
        <span id="bal-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 × ×§×•×“×•×ª!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim)">×¦×¤×• ×‘×—×¦×™ ×”×¤×¢×•×œ×” (××•×•×™×¨ ×™×œ×š ×©×××œ×”) ×•×ª×’×•×‘×” (×”×‘×œ×•×Ÿ ×™×œ×š ×™××™× ×”)!</p>
    </div>

    <!-- Game 3B: Rocket Launch -->
    <div class="card card-law3">
      <h2>&#127918; × ×™×¡×•×™: ×©×™×’×•×¨ ×¨×§×˜×”</h2>
      <p>×©× ×• ××ª ×¢×•×¦××ª ×”×“×—×£ ×•×©×’×¨×• ××ª ×”×¨×§×˜×”! ×’×–×™ ×”×¤×œ×™×˜×” ×™×•×¨×“×™× â€” ×”×¨×§×˜×” ×¢×•×œ×”!</p>

      <div class="slider-row">
        <span class="slider-label">×›×•×— ×“×—×£:</span>
        <input type="range" class="slider-law3" id="thrust-slider" min="20" max="100" value="60" oninput="updateThrust()">
        <span class="slider-val" id="thrust-val" style="color:var(--law3)">60%</span>
      </div>

      <div style="display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start">
        <div class="canvas-wrap" style="flex:1;min-width:240px">
          <canvas id="canvas-rocket" width="380" height="300">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×§× ×‘×¡. ×× × ×”×©×ª××©×• ×‘×“×¤×“×¤×Ÿ ××•×“×¨× ×™ ×œ×¦×¤×™×™×” ×‘×”× ×¤×©×”.</canvas>
        </div>
        <div style="flex:0 0 auto;padding-top:4px">
          <div style="margin-bottom:8px;font-size:14px;color:var(--text-dim)">×’×•×‘×”</div>
          <div class="altitude-wrap">
            <div class="altitude-bar-outer">
              <div class="altitude-bar-inner" id="altitude-bar" style="height:0%"></div>
            </div>
          </div>
          <div style="margin-top:6px;font-size:18px;font-weight:700;color:var(--law3)" id="altitude-text">0 ×'</div>
        </div>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">×›×•×— ×“×—×£</div>
          <div class="stat-value" id="rocket-thrust" style="color:var(--law3)">60%</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×’×•×‘×”:</div>
          <div class="stat-value" id="rocket-altitude" style="color:var(--law3)">0 ×'</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">××”×™×¨×•×ª:</div>
          <div class="stat-value" id="rocket-speed" style="color:var(--law3)">0 ×'/×©'</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law3 btn-lg" onclick="launchRocket()">×©×’×¨! &#128640;</button>
        <button class="btn btn-gray btn-sm" onclick="resetRocket()">××¤×¡</button>
        <span id="rocket-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 × ×§×•×“×•×ª!</span>
      </div>
    </div>
  </div>

  <!-- ======== ENERGY ======== -->
  <div class="section" id="sec-energy">
    <div class="section-header" style="background:linear-gradient(135deg,#166534,var(--energy))">
      <h2>âš¡ ×—×•×§ ×©×™××•×¨ ×”×× ×¨×’×™×”</h2>
      <p class="section-tagline">×× ×¨×’×™×” ×œ× × ×•×¦×¨×ª ×•×œ× × ×¢×œ××ª â€” ×”×™× ×¨×§ ××©× ×” ×¦×•×¨×”!</p>
    </div>
    <div class="section-body">
      <div class="law-explanation">
        <p>×× ×¨×’×™×” <strong>×œ× × ×•×¦×¨×ª ×•×œ× × ×¢×œ××ª</strong> â€” ×”×™× ×¨×§ ××©× ×” ×¦×•×¨×”! âš¡ ×›×©×¨×›×‘×ª ×”×¨×™× ×™×•×¨×“×ª ×‘××•×¨×“, <strong>×× ×¨×’×™×” ×¤×•×˜× ×¦×™××œ×™×ª</strong> (×’×•×‘×”) ×”×•×¤×›×ª ×œ<strong>×× ×¨×’×™×” ×§×™× ×˜×™×ª</strong> (×ª× ×•×¢×”). ×¡×š ×”×× ×¨×’×™×” ×ª××™×“ × ×©××¨ ×–×”×”!</p>
      </div>
      <div class="real-world-box" style="border-color:var(--energy)">
        <h4>ğŸŒ ×“×•×’×××•×ª ××”×—×™×™×:</h4>
        <ul><li>ğŸ¢ ×¨×›×‘×ª ×”×¨×™× ×”×××™×¨×” ×’×•×‘×” ×œ××”×™×¨×•×ª</li><li>ğŸ€ ×›×“×•×¨ ×§×•×¤×¥ (×§×™× ×˜×™×ªâ†’×¤×•×˜× ×¦×™××œ×™×ªâ†’×§×™× ×˜×™×ª)</li><li>ğŸ’§ ×¡×›×¨ ×”×™×“×¨×•××œ×§×˜×¨×™ (×¤×•×˜× ×¦×™××œ×™×ªâ†’×—×©××œ×™×ª)</li><li>ğŸ•°ï¸ ×©×¢×•×Ÿ ××˜×•×˜×œ×ª</li><li>ğŸ“± ×¡×•×œ×œ×ª ×˜×œ×¤×•×Ÿ (×›×™××™×ªâ†’×—×©××œ×™×ª)</li></ul>
      </div>
      <div class="experiment-card">
        <h3>ğŸ¢ × ×™×¡×•×™: ×× ×¨×’×™×” ×‘×¨×›×‘×ª ×”×¨×™×</h3>
        <p>×§×‘×¢ ××ª ×”×’×•×‘×” ×•×©×’×¨ ××ª ×”×§×¨×•×Ÿ. ×¦×¤×” ×›×™×¦×“ ×”×× ×¨×’×™×” ×”×¤×•×˜× ×¦×™××œ×™×ª (×›×—×•×œ) ×”×•×¤×›×ª ×œ×§×™× ×˜×™×ª (×›×ª×•×) ×‘×™×¨×™×“×”!</p>
        <div style="margin:10px 0">
          <label>×’×•×‘×” ×”×ª×—×œ×ª×™: <span id="rc-height-val">70</span>%</label>
          <input type="range" id="rc-height" min="20" max="100" value="70" oninput="document.getElementById('rc-height-val').textContent=this.value">
        </div>
        <button class="btn" style="background:var(--energy)" onclick="launchRollerCoaster()">ğŸš€ ×©×’×¨!</button>
        <button class="btn btn-dim" onclick="resetRollerCoaster()">××¤×¡</button>
        <canvas id="canvas-rc" width="500" height="180" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">×¡×™××•×œ×¦×™×™×ª ×¨×›×‘×ª ×”×¨×™×</canvas>
        <div id="rc-status" style="color:var(--energy);font-size:14px;min-height:20px"></div>
      </div>
      <div class="experiment-card">
        <h3>ğŸ€ × ×™×¡×•×™: ×›×“×•×¨ ×§×•×¤×¥</h3>
        <p>×©×—×¨×¨ ×›×“×•×¨ ××’×‘×”×™× ×©×•× ×™× ×•×¦×¤×” ×›×™×¦×“ ×× ×¨×’×™×” ×¤×•×˜× ×¦×™××œ×™×ª ×”×•×¤×›×ª ×œ×§×™× ×˜×™×ª ×•×‘×—×–×¨×”. ×›×œ ×§×¤×™×¦×” ×××‘×“×ª ×§×¦×ª ×× ×¨×’×™×” ×œ×—×•×!</p>
        <div style="margin:10px 0">
          <label>×’×•×‘×” ×©×—×¨×•×¨: <span id="bb-height-val">80</span>%</label>
          <input type="range" id="bb-height" min="20" max="100" value="80" oninput="document.getElementById('bb-height-val').textContent=this.value">
        </div>
        <button class="btn" style="background:var(--energy)" onclick="launchBounceBall()">ğŸ€ ×©×—×¨×¨!</button>
        <button class="btn btn-dim" onclick="resetBounceBall()">××¤×¡</button>
        <canvas id="canvas-bb" width="300" height="220" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">×¡×™××•×œ×¦×™×™×ª ×›×“×•×¨ ×§×•×¤×¥</canvas>
      </div>
      <div class="info-box" style="border-color:var(--energy)">
        <h4>âš¡ ×¡×•×’×™ ×× ×¨×’×™×”:</h4>
        <p>ğŸƒ <strong>×§×™× ×˜×™×ª</strong> â€” ×× ×¨×’×™×™×ª ×ª× ×•×¢×” | ğŸ”ï¸ <strong>×¤×•×˜× ×¦×™××œ×™×ª</strong> â€” ×× ×¨×’×™×” ×¦×‘×•×¨×” ×‘×’×•×‘×” | ğŸ”¥ <strong>×ª×¨××™×ª</strong> â€” ×× ×¨×’×™×™×ª ×—×•× | ğŸ <strong>×›×™××™×ª</strong> â€” ××–×•×Ÿ ×•×“×œ×§ | âš¡ <strong>×—×©××œ×™×ª</strong> â€” ××œ×§×˜×¨×•× ×™× ×–×•×¨××™×</p>
      </div>
    </div>
  </div>

  <!-- ======== GRAVITY ======== -->
  <div class="section" id="sec-gravity">
    <div class="section-header" style="background:linear-gradient(135deg,#881337,var(--gravity))">
      <h2>ğŸŒ ×›×‘×™×“×” ×•×ª× ×•×¢×ª ×§×œ×™×¢×™×</h2>
      <p class="section-tagline">×›×œ ×¢×¦× ×–×¨×•×§ ×¢×•×§×‘ ××—×¨ ×¤×¨×‘×•×œ×” ××•×©×œ××ª!</p>
    </div>
    <div class="section-body">
      <div class="law-explanation">
        <p>×”×›×‘×™×“×” ××•×©×›×ª ×”×›×œ ×œ×›×™×•×•×Ÿ ××¨×›×– ×›×“×•×¨ ×”××¨×¥ ×‘×ª××•×¦×” ×©×œ <strong>9.8 ××³/×©× ×™×™×”Â²</strong>! ğŸŒ ×›×©×–×•×¨×§×™× ×›×“×•×¨, ×”×•× × ×¢ <strong>×§×“×™××”</strong> (×‘×’×œ×œ ×”×–×¨×™×§×”) ×•×’× <strong>× ×•×¤×œ ×œ××˜×”</strong> (×‘×’×œ×œ ×›×‘×™×“×”) â€” ×™×—×“ ×™×•×¦×¨×™× ×§×©×ª ×”× ×§×¨××ª <strong>×¤×¨×‘×•×œ×”</strong>!</p>
      </div>
      <div class="real-world-box" style="border-color:var(--gravity)">
        <h4>ğŸŒ ×“×•×’×××•×ª ××”×—×™×™×:</h4>
        <ul><li>ğŸ€ ×–×¨×™×§×ª ×›×“×•×¨×¡×œ ×œ×¡×œ</li><li>ğŸˆ ××¡×™×¨×ª ×›×“×•×¨×’×œ ×××¨×™×§××™</li><li>âš½ ×‘×¢×™×˜×ª ×¤× ×“×œ ×©×¢×•×§×¤×ª ×§×™×¨</li><li>ğŸŒŠ ×§×©×ª ××–×¨×§×”</li><li>ğŸš€ ××¡×œ×•×œ×™ ×—×œ×œ×™×•×ª</li></ul>
      </div>
      <div class="experiment-card">
        <h3>ğŸ€ × ×™×¡×•×™: ××©×’×¨ ×§×œ×™×¢×™×</h3>
        <p>×©× ×” ××ª ×”×–×•×•×™×ª ×•×”××”×™×¨×•×ª, ×•××– ×©×’×¨! × ×¡×” ×–×•×•×™×•×ª ×©×•× ×•×ª ×›×“×™ ×œ××¦×•× ××™ ×©×•×œ×—×ª ×”×›×™ ×¨×—×•×§ (×¨××–: 45Â°!)</p>
        <div style="margin:10px 0;display:flex;gap:20px;flex-wrap:wrap">
          <div><label>×–×•×•×™×ª: <span id="proj-angle-val">45</span>Â°</label><br>
          <input type="range" id="proj-angle" min="10" max="80" value="45" oninput="document.getElementById('proj-angle-val').textContent=this.value;drawProjectileIdle()"></div>
          <div><label>××”×™×¨×•×ª: <span id="proj-speed-val">60</span>%</label><br>
          <input type="range" id="proj-speed" min="20" max="100" value="60" oninput="document.getElementById('proj-speed-val').textContent=this.value;drawProjectileIdle()"></div>
        </div>
        <button class="btn" style="background:var(--gravity)" onclick="launchProjectile()">ğŸš€ ×©×’×¨!</button>
        <button class="btn btn-dim" onclick="resetProjectile()">××¤×¡</button>
        <canvas id="canvas-proj" width="520" height="200" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">×¡×™××•×œ×¦×™×™×ª ×ª× ×•×¢×ª ×§×œ×™×¢</canvas>
        <div id="proj-status" style="color:var(--gravity);font-size:14px;min-height:20px"></div>
      </div>
      <div class="experiment-card">
        <h3>ğŸª × ×™×¡×•×™: ×›×‘×™×“×” ×‘×¢×•×œ××•×ª ×©×•× ×™×</h3>
        <p>××•×ª×” ×–×¨×™×§×”, ×›×‘×™×“×” ×©×•× ×”! ×¨××” ×›×™×¦×“ ××•×ª×• ×›×“×•×¨ × ×•×¡×¢ ×”×¨×‘×” ×™×•×ª×¨ ×¨×—×•×§ ×¢×œ ×”×™×¨×— ×××©×¨ ×¢×œ ×¦×“×§!</p>
        <button class="btn" style="background:var(--gravity)" onclick="launchWorlds()">ğŸš€ ×©×’×¨ ×‘×›×œ ×”×¢×•×œ××•×ª!</button>
        <button class="btn btn-dim" onclick="resetWorlds()">××¤×¡</button>
        <canvas id="canvas-worlds" width="520" height="200" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">×”×©×•×•××ª ×›×‘×™×“×” ×‘×™×Ÿ ×¢×•×œ××•×ª</canvas>
        <div style="display:flex;gap:15px;flex-wrap:wrap;font-size:13px;margin-top:5px">
          <span style="color:#C0C0C0">âšª ×™×¨×—: 1.6 ××³/×©× Â²</span>
          <span style="color:#FF6B35">ğŸ”´ ×××“×™×: 3.7 ××³/×©× Â²</span>
          <span style="color:#00C9FF">ğŸ”µ ×›×“×•×¨ ×”××¨×¥: 9.8 ××³/×©× Â²</span>
          <span style="color:#FFB347">ğŸŸ  ×¦×“×§: 24.8 ××³/×©× Â²</span>
        </div>
      </div>
      <div class="info-box" style="border-color:var(--gravity)">
        <h4>ğŸ¤” ×”×× ×™×“×¢×ª?</h4>
        <p>ğŸŒ™ ×›×‘×™×“×ª ×”×™×¨×— = ×¨×§ 1/6 ××›×“×•×¨ ×”××¨×¥! | ğŸ›ï¸ ×’×œ×™×œ××• ×”×¤×™×œ ×›×“×•×¨×™× ×××’×“×œ ×¤×™×–×” ×”× ×˜×•×™ | ğŸ‘¨â€ğŸš€ ××¡×˜×¨×•× ××•×˜×™ ××¤×•×œ×• ×™×›×œ×• ×œ×§×¤×¥ ×¤×™ 6 ×™×•×ª×¨ ×’×‘×•×” ×¢×œ ×”×™×¨×—!</p>
      </div>
    </div>
  </div>

  <!-- ======== QUIZ ======== -->
  <div class="section" id="sec-quiz">
    <div class="card card-quiz">
      <h1>&#10067; ×—×™×“×•×Ÿ: ×‘×—×Ÿ ××ª ×¢×¦××š!</h1>
      <p>×¢× ×” ×¢×œ 5 ×©××œ×•×ª ×•×’×œ×” ×¢×“ ×›××” ××ª×” ××•××—×” ×¤×™×–×™×§×”! 5 ×©××œ×•×ª, 40 × ×§×•×“×•×ª ×›×œ ××—×ª. ×‘×”×¦×œ×—×”!</p>
    </div>

    <div id="quiz-questions"></div>

    <div id="quiz-submit-area" style="text-align:center;margin:20px 0;">
      <button class="btn btn-gold btn-lg" onclick="submitQuiz()" id="quiz-submit-btn">×©×œ×— ×ª×©×•×‘×•×ª! &#10003;</button>
    </div>

    <div id="quiz-result" style="display:none" class="card card-quiz">
      <h2 id="quiz-result-heading">×ª×•×¦××•×ª ×”×—×™×“×•×Ÿ</h2>
      <p id="quiz-result-msg"></p>
      <div class="btn-row" style="justify-content:center;margin-top:16px">
        <button class="btn btn-gold"    onclick="retakeQuiz()">×©×—×§ ×©×•×‘ &#128260;</button>
        <button class="btn btn-success" onclick="switchTab('home')">×—×–×¨×” ×œ×‘×™×ª &#127968;</button>
      </div>
    </div>
  </div>

</div><!-- end #main -->

<div id="notif">+100 × ×§×•×“×•×ª!</div>

<script>
// ================================================================
//  STATE
// ================================================================
var state = {
  score: 0,
  law1done: false,
  law2done: false,
  law3done: false,
  quizDone: false,
  currentTab: 'home',
  slide1aKicked: false,
  space1bFired: false,
  fmaLaunches: 0,
  fmaTotalPts: 0,
  bal3aDone: false,
  rocket3bDone: false,
  quizSubmitted: false,
  energyDone: false,
  gravityDone: false,
  rcDone: false,
  bbDone: false,
  projDone: false,
  worldsDone: false
};

// ================================================================
//  SCORE & UI
// ================================================================
function addScore(pts) {
  state.score = Math.min(1200, state.score + pts);
  updateScoreDisplay();
  showNotif('+' + pts + ' × ×§×•×“×•×ª!');
  checkCompletion();
}

function updateScoreDisplay() {
  document.getElementById('score-text').textContent = '× ×™×§×•×“: ' + state.score + ' / 1200';
  var pct = (state.score / 1200) * 100;
  document.getElementById('progress-bar').style.width = pct + '%';
  var thresholds = [200, 400, 600, 800, 1000];
  var stars = 0;
  for (var i = 0; i < thresholds.length; i++) {
    if (state.score >= thresholds[i]) stars++;
  }
  var full = '\u2B50', empty = '\u2606';
  document.getElementById('stars-display').textContent = full.repeat(stars) + empty.repeat(5 - stars);
}

var notifTimer = null;
function showNotif(msg) {
  var n = document.getElementById('notif');
  n.textContent = msg;
  n.classList.add('show');
  clearTimeout(notifTimer);
  notifTimer = setTimeout(function() { n.classList.remove('show'); }, 2400);
}

function updateDot(id, done) {
  var dot = document.getElementById('dot-' + id);
  if (done) dot.classList.add('done');
  else dot.classList.remove('done');
}

function markDot(id, done) { updateDot(id, done); }

function checkLaw1Done() {
  if (state.slide1aKicked && state.space1bFired && !state.law1done) {
    state.law1done = true;
    updateDot('law1', true);
    document.getElementById('home-done-1').style.display = 'block';
    showNotif('×—×•×§ 1 ×”×•×©×œ×! ×›×œ ×”×›×‘×•×“!');
    checkCompletion();
  }
}

function checkLaw2Done() {
  if (state.fmaLaunches >= 3 && !state.law2done) {
    state.law2done = true;
    updateDot('law2', true);
    document.getElementById('home-done-2').style.display = 'block';
    showNotif('×—×•×§ 2 ×”×•×©×œ×!');
    checkCompletion();
  }
}

function checkLaw3Done() {
  if (state.bal3aDone && state.rocket3bDone && !state.law3done) {
    state.law3done = true;
    updateDot('law3', true);
    document.getElementById('home-done-3').style.display = 'block';
    showNotif('×—×•×§ 3 ×”×•×©×œ×!');
    checkCompletion();
  }
}

function checkCompletion() {
  if (state.law1done && state.law2done && state.law3done && state.energyDone && state.gravityDone && state.quizDone) {
    setTimeout(function() {
      switchTab('home');
      document.getElementById('completion-screen').style.display = 'block';
      var s = document.getElementById('stars-display').textContent;
      document.getElementById('final-stars').textContent = s;
      document.getElementById('final-score-display').textContent = state.score + ' / 1200';
      var s2 = document.getElementById('final-score-display-2');
      if (s2) s2.textContent = state.score;
    }, 600);
  }
}

function resetGame() {
  state.score = 0;
  state.law1done = false;
  state.law2done = false;
  state.law3done = false;
  state.quizDone = false;
  state.slide1aKicked = false;
  state.space1bFired = false;
  state.fmaLaunches = 0;
  state.fmaTotalPts = 0;
  state.bal3aDone = false;
  state.rocket3bDone = false;
  state.quizSubmitted = false;
  state.energyDone = false;
  state.gravityDone = false;
  state.rcDone = false; state.bbDone = false;
  state.projDone = false; state.worldsDone = false;
  updateScoreDisplay();
  ['law1','law2','law3','energy','gravity','quiz'].forEach(function(k) { updateDot(k, false); });
  ['home-done-1','home-done-2','home-done-3','home-done-quiz'].forEach(function(id) {
    document.getElementById(id).style.display = 'none';
  });
  document.getElementById('completion-screen').style.display = 'none';
  ['slide-pts-msg','space-pts-msg','fma-pts-msg','bal-pts-msg','rocket-pts-msg'].forEach(function(id) {
    document.getElementById(id).style.display = 'none';
  });
  currentSurface = 'ice';
  document.querySelectorAll('.surface-btn').forEach(function(b) { b.classList.remove('selected'); });
  document.querySelector('.surface-btn[data-surface="ice"]').classList.add('selected');
  document.getElementById('slide-surface-name').textContent = '×§×¨×—';
  document.getElementById('slide-friction-val').textContent = '0.005';
  resetSlide();
  document.getElementById('atmos-toggle').checked = false;
  toggleAtmosphere();
  resetSpace();
  resetFMA();
  updateFMA();
  resetBalloon();
  updateBalloon();
  resetRocket();
  updateThrust();
  buildQuiz();
  switchTab('home');
}

// ================================================================
//  STOP ALL ANIMATION LOOPS
// ================================================================
function stopAllAnimations() {
  cancelAnimationFrame(slideState.raf);   slideState.running  = false;
  cancelAnimationFrame(spaceState.raf);   spaceState.running  = false; spaceState.thrusting = false;
  cancelAnimationFrame(fmaState.raf);     fmaState.running    = false;
  cancelAnimationFrame(balloonState.raf); balloonState.running = false;
  cancelAnimationFrame(rocketState.raf);  rocketState.running  = false;
  if (typeof rcRaf !== 'undefined' && rcRaf) { cancelAnimationFrame(rcRaf); rcRaf = null; }
  if (typeof bbRaf !== 'undefined' && bbRaf) { cancelAnimationFrame(bbRaf); bbRaf = null; }
  if (typeof projRaf !== 'undefined' && projRaf) { cancelAnimationFrame(projRaf); projRaf = null; }
  if (typeof worldsRaf !== 'undefined' && worldsRaf) { cancelAnimationFrame(worldsRaf); worldsRaf = null; }
  if (typeof rcState !== 'undefined') rcState.running = false;
  if (typeof bbState !== 'undefined') bbState.running = false;
  if (typeof projState !== 'undefined') projState.running = false;
  if (typeof worldsState !== 'undefined') worldsState.running = false;
}

// ================================================================
//  TAB NAVIGATION
// ================================================================
function switchTab(tab) {
  stopAllAnimations();
  state.currentTab = tab;
  document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b) {
    b.classList.toggle('active', b.dataset.tab === tab);
  });
  var secMap = { home:'sec-home', law1:'sec-law1', law2:'sec-law2', law3:'sec-law3', energy:'sec-energy', gravity:'sec-gravity', quiz:'sec-quiz' };
  document.getElementById(secMap[tab]).classList.add('active');
  window.scrollTo(0, 0);
  if (tab === 'law1') { setTimeout(function(){ drawSlideCanvas(); drawSpaceCanvas(); }, 50); }
  if (tab === 'law2') { setTimeout(function(){ drawFMACanvas(); }, 50); }
  if (tab === 'law3') { setTimeout(function(){ drawBalloonCanvas(); drawRocketCanvas(); }, 50); }
  if (tab === 'energy') { setTimeout(function(){ initRCCanvas(); }, 50); }
  if (tab === 'gravity') { setTimeout(function(){ drawProjectileIdle(); }, 50); }
}

document.querySelectorAll('.tab-btn').forEach(function(btn) {
  btn.addEventListener('click', function() { switchTab(btn.dataset.tab); });
});

// ================================================================
//  LAW 1A â€” SURFACE SLIDE
// ================================================================
var SURFACES = {
  ice:   { name:'×§×¨×—',  mu:0.005, color:'#a8e8ff', emoji:'×§×¨×—' },
  wood:  { name:'×¢×¥',   mu:0.04,  color:'#c8a060', emoji:'×¢×¥' },
  grass: { name:'×“×©×',  mu:0.09,  color:'#5ab040', emoji:'×“×©×' },
  sand:  { name:'×—×•×œ',  mu:0.15,  color:'#d4b870', emoji:'×—×•×œ' }
};

var currentSurface = 'ice';
var slideState = { x:60, vx:0, running:false, puckR:18, startX:60, raf:null };

function selectSurface(surf, btn) {
  currentSurface = surf;
  document.querySelectorAll('.surface-btn').forEach(function(b) { b.classList.remove('selected'); });
  btn.classList.add('selected');
  var s = SURFACES[surf];
  document.getElementById('slide-surface-name').textContent = s.name;
  document.getElementById('slide-friction-val').textContent = s.mu;
  resetSlide();
}

function drawSlideCanvas() {
  var cvs = document.getElementById('canvas-slide');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  var s = SURFACES[currentSurface];

  ctx.clearRect(0, 0, W, H);

  // Sky
  var sky = ctx.createLinearGradient(0, 0, 0, H * 0.55);
  sky.addColorStop(0, '#080818');
  sky.addColorStop(1, '#101828');
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, W, H * 0.55);

  // Ground
  ctx.fillStyle = s.color;
  ctx.fillRect(0, H * 0.55, W, H * 0.45);

  // Texture
  ctx.strokeStyle = 'rgba(0,0,0,0.12)';
  ctx.lineWidth = 1;
  for (var x = 0; x < W; x += 36) {
    ctx.beginPath(); ctx.moveTo(x, H * 0.55); ctx.lineTo(x, H); ctx.stroke();
  }

  // Label
  ctx.fillStyle = 'rgba(0,0,0,0.55)';
  ctx.fillRect(W - 160, H * 0.56, 152, 28);
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 13px Arial, sans-serif';
  ctx.textAlign = 'right';
  ctx.fillText('×—×™×›×•×š: ' + s.mu + '  ' + s.name, W - 12, H * 0.56 + 19);
  ctx.textAlign = 'left';

  // Puck
  var px = slideState.x;
  var py = Math.floor(H * 0.55) - slideState.puckR;

  ctx.shadowColor = 'rgba(0,201,255,0.6)';
  ctx.shadowBlur = 12;
  ctx.beginPath();
  ctx.arc(px, py, slideState.puckR, 0, Math.PI * 2);
  ctx.fillStyle = '#00C9FF';
  ctx.fill();
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.shadowBlur = 0;

  ctx.beginPath();
  ctx.arc(px, py, 5, 0, Math.PI * 2);
  ctx.fillStyle = '#fff';
  ctx.fill();

  // Velocity arrow
  if (slideState.vx > 0.5) {
    var arrLen = Math.min(slideState.vx * 4, 80);
    ctx.strokeStyle = '#FFD700';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(px + slideState.puckR + 3, py);
    ctx.lineTo(px + slideState.puckR + arrLen, py);
    ctx.stroke();
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.moveTo(px + slideState.puckR + arrLen + 8, py);
    ctx.lineTo(px + slideState.puckR + arrLen, py - 6);
    ctx.lineTo(px + slideState.puckR + arrLen, py + 6);
    ctx.fill();
  }
}

function kickPuck() {
  if (slideState.running) return;
  cancelAnimationFrame(slideState.raf);
  slideState.x = 60;
  slideState.vx = 13;
  slideState.running = true;
  slideState.startX = 60;
  document.getElementById('slide-distance').textContent = '-- ×\'';
  document.getElementById('slide-speed').textContent = '0 ×\'/×©\'';
  animateSlide();
}

function animateSlide() {
  var cvs = document.getElementById('canvas-slide');
  if (!cvs || !slideState.running) { slideState.running = false; return; }
  var W = cvs.width;
  var mu = SURFACES[currentSurface].mu;
  var decel = mu * 9.8;

  slideState.vx = Math.max(0, slideState.vx - decel * 0.055);
  slideState.x += slideState.vx * 1.1;

  var pixelsPerMeter = (W - 90) / 10;
  var distMeters = (slideState.x - slideState.startX) / pixelsPerMeter;

  document.getElementById('slide-speed').textContent = (slideState.vx * 0.65).toFixed(1) + ' ×\'/×©\'';
  document.getElementById('slide-distance').textContent = distMeters.toFixed(1) + ' ×\'';

  drawSlideCanvas();

  if (slideState.running && slideState.vx > 0.05 && slideState.x < W - 30) {
    slideState.raf = requestAnimationFrame(animateSlide);
  } else {
    slideState.running = false;
    slideState.vx = 0;
    drawSlideCanvas();
    if (!state.slide1aKicked) {
      state.slide1aKicked = true;
      addScore(100);
      document.getElementById('slide-pts-msg').style.display = 'inline';
      checkLaw1Done();
    }
  }
}

function resetSlide() {
  cancelAnimationFrame(slideState.raf);
  slideState.x = 60;
  slideState.vx = 0;
  slideState.running = false;
  document.getElementById('slide-speed').textContent = '0 ×\'/×©\'';
  document.getElementById('slide-distance').textContent = '-- ×\'';
  drawSlideCanvas();
}

// ================================================================
//  LAW 1B â€” SPACE DRIFT
// ================================================================
var spaceState = {
  x: 80, y: 100, vx: 0,
  thrusting: false,
  atmosphere: false,
  running: false,
  distance: 0,
  raf: null,
  particles: [],
  frameCount: 0   /* used to auto-stop very long runs */
};

function toggleAtmosphere() {
  spaceState.atmosphere = document.getElementById('atmos-toggle').checked;
  var label  = document.getElementById('atmos-label');
  var status = document.getElementById('space-atmos-status');
  if (spaceState.atmosphere) {
    label.textContent  = '××˜××•×¡×¤×¨×”: ×¤×•×¢×œ';
    label.style.color  = '#4CAF50';
    status.textContent = '×¤×•×¢×œ';
    status.style.color = '#4CAF50';
  } else {
    label.textContent  = '××˜××•×¡×¤×¨×”: ×›×‘×•×™';
    label.style.color  = '#888';
    status.textContent = '×›×‘×•×™';
    status.style.color = '#888';
  }
  drawSpaceCanvas();
}

function startThrust() {
  spaceState.thrusting = true;
  if (!spaceState.running) {
    spaceState.running  = true;
    spaceState.frameCount = 0;
    animateSpace();
  }
}
function stopThrust() { spaceState.thrusting = false; }

var STAR_POS = [];
(function() {
  var seed = [13,47,71,103,157,211,263,311,367,421,479,523,577,631,683,739,797,853,907,967];
  seed.forEach(function(s, i) {
    STAR_POS.push({ x: (s*53 + i*137) % 780, y: (s*31 + i*97) % 200, r: (i % 3)*0.5 + 0.7 });
  });
})();

function drawSpaceCanvas() {
  var cvs = document.getElementById('canvas-space');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);

  if (spaceState.atmosphere) {
    var sg = ctx.createLinearGradient(0, 0, 0, H);
    sg.addColorStop(0, '#001535');
    sg.addColorStop(1, '#003060');
    ctx.fillStyle = sg;
  } else {
    ctx.fillStyle = '#000510';
  }
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = 'rgba(255,255,255,0.75)';
  STAR_POS.forEach(function(st) {
    ctx.beginPath();
    ctx.arc(st.x, st.y, st.r, 0, Math.PI * 2);
    ctx.fill();
  });

  if (spaceState.atmosphere) {
    ctx.fillStyle = 'rgba(0,160,255,0.07)';
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = 'rgba(100,200,255,0.4)';
    ctx.font = 'bold 13px Arial, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('×”×ª× ×’×“×•×ª ××•×•×™×¨ ×¤×¢×™×œ×” â€” ×”×¨×§×˜×” ×ª××˜', W/2, 20);
    ctx.textAlign = 'left';
  } else {
    ctx.fillStyle = 'rgba(0,201,255,0.4)';
    ctx.font = 'bold 13px Arial, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('×•××§×•× ×—×œ×œ â€” ××¤×¡ ×’×¨×¨! ×”×¨×§×˜×” ×“×•××” ×œ× ×¦×—.', W/2, 20);
    ctx.textAlign = 'left';
  }

  // Particles
  spaceState.particles.forEach(function(p) {
    ctx.globalAlpha = p.life;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.fill();
  });
  ctx.globalAlpha = 1;

  // Rocket
  var rx = spaceState.x, ry = spaceState.y;

  ctx.fillStyle = '#ccccdd';
  ctx.fillRect(rx-12, ry-20, 24, 38);
  ctx.fillStyle = '#ddddef';
  ctx.beginPath();
  ctx.moveTo(rx, ry-36);
  ctx.lineTo(rx-12, ry-20);
  ctx.lineTo(rx+12, ry-20);
  ctx.closePath();
  ctx.fill();
  ctx.fillStyle = '#00C9FF';
  ctx.beginPath();
  ctx.arc(rx, ry-6, 6, 0, Math.PI*2);
  ctx.fill();
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 1.5;
  ctx.stroke();
  ctx.fillStyle = '#FF6B35';
  ctx.beginPath();
  ctx.moveTo(rx-12, ry+12); ctx.lineTo(rx-22, ry+26); ctx.lineTo(rx-12, ry+18); ctx.fill();
  ctx.beginPath();
  ctx.moveTo(rx+12, ry+12); ctx.lineTo(rx+22, ry+26); ctx.lineTo(rx+12, ry+18); ctx.fill();

  if (spaceState.thrusting) {
    ctx.fillStyle = '#FF6B35';
    ctx.beginPath();
    ctx.moveTo(rx-8, ry+18);
    ctx.lineTo(rx, ry+34 + Math.random()*12);
    ctx.lineTo(rx+8, ry+18);
    ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.moveTo(rx-4, ry+18);
    ctx.lineTo(rx, ry+25 + Math.random()*8);
    ctx.lineTo(rx+4, ry+18);
    ctx.closePath();
    ctx.fill();
  }

  if (spaceState.vx > 0.4) {
    var alen = Math.min(spaceState.vx * 5, 90);
    ctx.strokeStyle = '#FFD700';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(rx+22, ry); ctx.lineTo(rx+22+alen, ry); ctx.stroke();
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.moveTo(rx+22+alen+8, ry);
    ctx.lineTo(rx+22+alen, ry-5);
    ctx.lineTo(rx+22+alen, ry+5);
    ctx.fill();
  }
}

function animateSpace() {
  var cvs = document.getElementById('canvas-space');
  if (!cvs || !spaceState.running) { spaceState.running = false; return; }
  var W = cvs.width;

  if (spaceState.thrusting) {
    spaceState.vx = Math.min(spaceState.vx + 0.38, 16);
    for (var i = 0; i < 3; i++) {
      spaceState.particles.push({
        x: spaceState.x,
        y: spaceState.y + 20 + Math.random()*8,
        vx: -(Math.random()*2+1),
        vy: (Math.random()-0.5)*0.8,
        r: Math.random()*4+1,
        life: 1,
        color: ['#FF6B35','#FFD700','#ff9900'][Math.floor(Math.random()*3)]
      });
    }
  }

  if (spaceState.atmosphere) {
    spaceState.vx = Math.max(0, spaceState.vx - 0.16);
  }

  spaceState.x += spaceState.vx * 0.5;
  spaceState.distance += spaceState.vx * 0.5;
  spaceState.frameCount++;

  if (spaceState.x > W + 40) spaceState.x = -40;

  spaceState.particles = spaceState.particles
    .filter(function(p) { return p.life > 0; })
    .map(function(p) { return { x:p.x+p.vx, y:p.y+p.vy, vx:p.vx, vy:p.vy, r:p.r, life:p.life-0.04, color:p.color }; });

  document.getElementById('space-speed').textContent = (spaceState.vx * 0.6).toFixed(1) + ' ×\'/×©\'';
  document.getElementById('space-distance').textContent = Math.round(spaceState.distance * 0.5) + ' ×\'';

  drawSpaceCanvas();

  if (!state.space1bFired && spaceState.distance > 60) {
    state.space1bFired = true;
    addScore(100);
    document.getElementById('space-pts-msg').style.display = 'inline';
    checkLaw1Done();
  }

  var shouldStop = (spaceState.atmosphere && !spaceState.thrusting && spaceState.vx < 0.05)
                || (spaceState.frameCount > 3600);

  if (spaceState.running && !shouldStop) {
    spaceState.raf = requestAnimationFrame(animateSpace);
  } else {
    spaceState.running = false;
    drawSpaceCanvas();
  }
}

function resetSpace() {
  cancelAnimationFrame(spaceState.raf);
  spaceState.x = 80;
  spaceState.y = 100;
  spaceState.vx = 0;
  spaceState.thrusting = false;
  spaceState.running = false;
  spaceState.distance = 0;
  spaceState.particles = [];
  spaceState.frameCount = 0;
  document.getElementById('space-speed').textContent = '0 ×\'/×©\'';
  document.getElementById('space-distance').textContent = '0 ×\'';
  drawSpaceCanvas();
}

// ================================================================
//  LAW 2 â€” F=ma
// ================================================================
var fmaState = { objects:[], running:false, raf:null, currentObjName:'××•×ª×× ××™×©×™×ª' };
var fmaForce = 50, fmaMass = 5;

function updateFMA() {
  fmaForce = parseInt(document.getElementById('force-slider').value);
  fmaMass  = parseFloat(document.getElementById('mass-slider').value);
  var acc = (fmaForce / fmaMass).toFixed(1);
  document.getElementById('force-val').textContent  = fmaForce + ' N';
  document.getElementById('mass-val').textContent   = fmaMass + ' ×§"×’';
  document.getElementById('fma-calc').textContent   = acc + ' ×\'/×©\'\u00B2';
  document.getElementById('fma-f').textContent      = fmaForce + ' N';
  document.getElementById('fma-m').textContent      = fmaMass + ' ×§"×’';
  document.getElementById('fma-a').textContent      = acc + ' ×\'/×©\'\u00B2';
}

function setPreset(mass, name) {
  fmaMass = mass;
  document.getElementById('mass-slider').value = Math.min(20, Math.max(1, mass));
  document.getElementById('fma-obj').textContent = name;
  fmaState.currentObjName = name;
  updateFMA();
}

function drawFMACanvas() {
  var cvs = document.getElementById('canvas-fma');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);

  ctx.fillStyle = '#080818';
  ctx.fillRect(0, 0, W, H);

  ctx.strokeStyle = '#334455';
  ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(0, H-30); ctx.lineTo(W, H-30); ctx.stroke();

  ctx.strokeStyle = 'rgba(255,215,0,0.5)';
  ctx.lineWidth = 2;
  ctx.setLineDash([6,4]);
  ctx.beginPath(); ctx.moveTo(W-30, 0); ctx.lineTo(W-30, H-30); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle = '#FFD700';
  ctx.font = 'bold 13px Arial, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('×§×• ×¡×™×•×', W-30, 18);
  ctx.textAlign = 'left';

  fmaState.objects.forEach(function(obj) {
    var r  = Math.max(10, Math.min(34, 8 + obj.mass * 1.4));
    var cy = H - 30 - r;
    ctx.shadowColor = obj.color + '80';
    ctx.shadowBlur  = 12;
    ctx.beginPath();
    ctx.arc(obj.x, cy, r, 0, Math.PI*2);
    ctx.fillStyle = obj.color;
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.shadowBlur = 0;
    if (obj.label) {
      ctx.fillStyle = '#fff';
      ctx.font = 'bold ' + Math.max(12, r*0.75) + 'px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(obj.label, obj.x, cy + r*0.35);
      ctx.textAlign = 'left';
    }
    ctx.fillStyle = obj.color;
    ctx.font = '12px Arial, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText((obj.vx*0.35).toFixed(1)+' ×\'/×©\'', obj.x, cy - r - 5);
    ctx.textAlign = 'left';
  });
}

function launchFMA() {
  if (fmaState.running) return;
  cancelAnimationFrame(fmaState.raf);
  var acc = fmaForce / fmaMass;
  fmaState.objects = [{ x:40, mass:fmaMass, vx:0, acc:acc, color:'#FF6B35', label:'' }];
  fmaState.running = true;
  state.fmaLaunches++;
  animateFMA(false);
}

function raceMode() {
  if (fmaState.running) return;
  var force = fmaForce;
  var presets = [
    { mass:0.45, label:'×›×“×•×¨', color:'#00C9FF' },
    { mass:5,    label:'×§×•×¤×¡×”', color:'#FF6B35' },
    { mass:20,   label:'×¡×œ×¢', color:'#7B2FBE' }
  ];
  fmaState.objects = presets.map(function(p) {
    return { x:40, mass:p.mass, vx:0, acc:force/p.mass, color:p.color, label:p.label };
  });
  fmaState.running = true;
  if (state.fmaLaunches < 3) state.fmaLaunches = 3;
  animateFMA(true);
}

function animateFMA(isRace) {
  var cvs = document.getElementById('canvas-fma');
  if (!cvs || !fmaState.running) { fmaState.running = false; return; }
  var W = cvs.width;
  var allDone = true;

  fmaState.objects = fmaState.objects.map(function(obj) {
    if (obj.x < W - 30) {
      allDone = false;
      obj.vx = Math.min(obj.vx + obj.acc * 0.028, obj.acc * 4.5);
      obj.x  += obj.vx * 0.45;
    }
    return obj;
  });

  drawFMACanvas();

  if (!allDone && fmaState.running) {
    fmaState.raf = requestAnimationFrame(function() { animateFMA(isRace); });
  } else {
    fmaState.running = false;
    if (!state.law2done) {
      var ptsToAdd = (state.fmaLaunches >= 3) ? 70 : (state.fmaLaunches === 2 ? 60 : 70);
      if (state.fmaTotalPts < 200) {
        var pts = Math.min(ptsToAdd, 200 - state.fmaTotalPts);
        state.fmaTotalPts += pts;
        addScore(pts);
      }
      var msg = document.getElementById('fma-pts-msg');
      msg.style.display = 'inline';
      msg.textContent   = state.fmaLaunches >= 3 ? '××¢×•×œ×”! 3+ × ×™×¡×•×™×™× ×”×•×©×œ××•!' : state.fmaLaunches + '/3 × ×™×¡×•×™×™×';
      checkLaw2Done();
    }
  }
}

function resetFMA() {
  cancelAnimationFrame(fmaState.raf);
  fmaState.objects = [];
  fmaState.running = false;
  fmaState.currentObjName = '××•×ª×× ××™×©×™×ª';
  document.getElementById('fma-obj').textContent = '××•×ª×× ××™×©×™×ª';
  drawFMACanvas();
}

// ================================================================
//  LAW 3A â€” BALLOON ROCKET
// ================================================================
var balloonState = { x:80, running:false, raf:null, vx:0, inflation:60, particles:[] };

function updateBalloon() {
  balloonState.inflation = parseInt(document.getElementById('balloon-slider').value);
  document.getElementById('balloon-val').textContent  = balloonState.inflation + '%';
  document.getElementById('bal-inflation').textContent = balloonState.inflation + '%';
  document.getElementById('bal-force').textContent     = balloonState.inflation + ' N';
  drawBalloonCanvas();
}

function drawBalloonCanvas() {
  var cvs = document.getElementById('canvas-balloon');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);

  ctx.fillStyle = '#080828';
  ctx.fillRect(0, 0, W, H);

  ctx.strokeStyle = '#445';
  ctx.lineWidth = 3;
  ctx.setLineDash([8,4]);
  ctx.beginPath(); ctx.moveTo(20, H/2); ctx.lineTo(W-20, H/2); ctx.stroke();
  ctx.setLineDash([]);

  balloonState.particles.forEach(function(p) {
    ctx.globalAlpha = p.life;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = '#99ccff';
    ctx.fill();
    ctx.strokeStyle = '#99ccff';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    ctx.lineTo(p.x + p.vx * 3, p.y);
    ctx.stroke();
  });
  ctx.globalAlpha = 1;

  var bx  = balloonState.x;
  var by  = H / 2;
  var inf = balloonState.inflation;
  var bw  = 18 + inf * 0.48;
  var bh  = 14 + inf * 0.38;

  ctx.shadowColor = 'rgba(123,47,190,0.7)';
  ctx.shadowBlur  = 16;
  ctx.fillStyle   = '#7B2FBE';
  ctx.beginPath();
  ctx.ellipse(bx, by, bw, bh, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = 'rgba(255,255,255,0.18)';
  ctx.beginPath();
  ctx.ellipse(bx - bw*0.22, by - bh*0.28, bw*0.33, bh*0.28, -0.4, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;
  ctx.fillStyle  = '#5a1a8e';
  ctx.beginPath(); ctx.arc(bx + bw, by, 5, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle = '#aaa'; ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(bx + bw + 5, by);
  ctx.lineTo(bx + bw + 14, by + 18);
  ctx.stroke();

  if (balloonState.running) {
    var ax = bx + bw + 4;
    var alen = 60;
    // Action arrow (air left)
    ctx.strokeStyle = '#ff4444'; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(ax, by-28); ctx.lineTo(ax-alen, by-28); ctx.stroke();
    ctx.fillStyle = '#ff4444';
    ctx.beginPath();
    ctx.moveTo(ax-alen-8, by-28); ctx.lineTo(ax-alen, by-34); ctx.lineTo(ax-alen, by-22); ctx.fill();
    ctx.font = 'bold 12px Arial, sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('×¤×¢×•×œ×”: ××•×•×™×¨ × ×“×—×£ ×œ××—×•×¨', ax-alen/2, by-36);
    // Reaction arrow (balloon right)
    ctx.strokeStyle = '#44ff88'; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(bx, by+28); ctx.lineTo(bx+alen, by+28); ctx.stroke();
    ctx.fillStyle = '#44ff88';
    ctx.beginPath();
    ctx.moveTo(bx+alen+8, by+28); ctx.lineTo(bx+alen, by+22); ctx.lineTo(bx+alen, by+34); ctx.fill();
    ctx.fillText('×ª×’×•×‘×”: ×”×‘×œ×•×Ÿ × ×¢ ×§×“×™××”', bx+alen/2, by+44);
    ctx.textAlign = 'left';
  }
}

function releaseBalloon() {
  if (balloonState.running) return;
  balloonState.x   = 80;
  balloonState.vx  = balloonState.inflation * 0.09 + 0.8;
  balloonState.running  = true;
  balloonState.particles = [];
  animateBalloon();
}

function animateBalloon() {
  var cvs = document.getElementById('canvas-balloon');
  if (!cvs || !balloonState.running) { balloonState.running = false; return; }
  var W  = cvs.width;
  var bw = 18 + balloonState.inflation * 0.48;

  balloonState.vx = Math.max(0, balloonState.vx - 0.018);
  balloonState.x += balloonState.vx;

  if (balloonState.vx > 0.3) {
    for (var i = 0; i < 3; i++) {
      balloonState.particles.push({
        x: balloonState.x + bw,
        y: cvs.height/2 + (Math.random()-0.5)*18,
        vx: -(balloonState.vx*1.4 + Math.random()*2),
        vy: (Math.random()-0.5)*0.5,
        r: Math.random()*3+1,
        life: 1
      });
    }
  }

  balloonState.particles = balloonState.particles
    .filter(function(p) { return p.life > 0; })
    .map(function(p) { return { x:p.x+p.vx, y:p.y+p.vy, vx:p.vx, vy:p.vy, r:p.r, life:p.life-0.024 }; });

  var pixPerM = (W - 80) / 5;
  var dist = (balloonState.x - 80) / pixPerM;
  document.getElementById('bal-distance').textContent = dist.toFixed(1) + ' ×\'';

  drawBalloonCanvas();

  if (balloonState.running && balloonState.x < W - bw - 20 && balloonState.vx > 0.04) {
    balloonState.raf = requestAnimationFrame(animateBalloon);
  } else {
    balloonState.running = false;
    if (!state.bal3aDone) {
      state.bal3aDone = true;
      addScore(100);
      document.getElementById('bal-pts-msg').style.display = 'inline';
      checkLaw3Done();
    }
  }
}

function resetBalloon() {
  cancelAnimationFrame(balloonState.raf);
  balloonState.x = 80;
  balloonState.vx = 0;
  balloonState.running = false;
  balloonState.particles = [];
  document.getElementById('bal-distance').textContent = '-- ×\'';
  drawBalloonCanvas();
}

// ================================================================
//  LAW 3B â€” ROCKET LAUNCH
// ================================================================
var rocketState = {
  y: 262, vy: 0, thrust: 60,
  running: false, raf: null,
  exhaustParticles: [],
  fuelFrames: 0,
  maxFuel: 0
};

function updateThrust() {
  rocketState.thrust = parseInt(document.getElementById('thrust-slider').value);
  document.getElementById('thrust-val').textContent    = rocketState.thrust + '%';
  document.getElementById('rocket-thrust').textContent = rocketState.thrust + '%';
  drawRocketCanvas();
}

function drawRocketCanvas() {
  var cvs = document.getElementById('canvas-rocket');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);

  var grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, '#000010');
  grad.addColorStop(0.65, '#0a0a30');
  grad.addColorStop(1, '#1a2a10');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  var RSTARS = [17,41,79,113,151,197,239,281,317,359,401];
  ctx.fillStyle = 'rgba(255,255,255,0.85)';
  RSTARS.forEach(function(s, i) {
    var sx = (s*29 + i*53) % W;
    var sy = (s*37 + i*71) % (H*0.75);
    ctx.beginPath(); ctx.arc(sx, sy, 1.1, 0, Math.PI*2); ctx.fill();
  });

  ctx.fillStyle = '#1a3010';
  ctx.fillRect(0, H-18, W, 18);
  ctx.fillStyle = '#253515';
  ctx.fillRect(0, H-20, W, 4);

  ctx.strokeStyle = 'rgba(123,47,190,0.25)';
  ctx.lineWidth = 1;
  ctx.setLineDash([4,6]);
  for (var h = 40; h <= H-20; h += 50) {
    ctx.beginPath(); ctx.moveTo(0, h); ctx.lineTo(W, h); ctx.stroke();
    ctx.fillStyle = 'rgba(255,255,255,0.25)';
    ctx.font = '10px Arial, sans-serif';
    ctx.fillText(Math.round(((H-20-h)/(H-20))*100)+'×\'', 4, h-2);
  }
  ctx.setLineDash([]);

  // Exhaust particles
  rocketState.exhaustParticles.forEach(function(p) {
    ctx.globalAlpha = p.life * 0.8;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = p.color; ctx.fill();
  });
  ctx.globalAlpha = 1;

  var rx = W/2, ry = rocketState.y;
  var groundY = H - 38;
  var altPct = Math.max(0, Math.min(100, ((groundY - ry) / groundY) * 100));

  // Exhaust flame (action â€” down, only while fuel remains)
  if (rocketState.running && rocketState.vy < 0 && rocketState.fuelFrames > 0) {
    var fLen = 18 + (rocketState.thrust/100)*38;
    ctx.fillStyle = '#FF6B35';
    ctx.beginPath();
    ctx.moveTo(rx-10, ry+22);
    ctx.lineTo(rx, ry+22+fLen + Math.random()*14);
    ctx.lineTo(rx+10, ry+22);
    ctx.closePath(); ctx.fill();
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.moveTo(rx-5, ry+22);
    ctx.lineTo(rx, ry+22+fLen*0.6 + Math.random()*8);
    ctx.lineTo(rx+5, ry+22);
    ctx.closePath(); ctx.fill();

    ctx.fillStyle = 'rgba(255,100,70,0.85)';
    ctx.font = 'bold 11px Arial, sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('×¤×¢×•×œ×”: ×’×–×™× ×œ××—×•×¨', rx, ry+22+fLen+18);
  }

  // Rocket body
  ctx.fillStyle = '#ccccdd';
  ctx.fillRect(rx-13, ry-20, 26, 42);
  ctx.fillStyle = '#ddddef';
  ctx.beginPath();
  ctx.moveTo(rx, ry-40); ctx.lineTo(rx-13, ry-20); ctx.lineTo(rx+13, ry-20);
  ctx.closePath(); ctx.fill();
  ctx.fillStyle = '#FF6B35';
  ctx.beginPath(); ctx.arc(rx, ry-40, 5, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle = '#7B2FBE';
  ctx.beginPath(); ctx.arc(rx, ry-6, 7, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle = '#fff'; ctx.lineWidth = 1.5; ctx.stroke();
  // stripes
  ctx.fillStyle = '#FF6B35';
  ctx.fillRect(rx-13, ry+4, 26, 5);
  // fins
  ctx.beginPath();
  ctx.moveTo(rx-13, ry+8); ctx.lineTo(rx-23, ry+28); ctx.lineTo(rx-13, ry+22); ctx.fill();
  ctx.beginPath();
  ctx.moveTo(rx+13, ry+8); ctx.lineTo(rx+23, ry+28); ctx.lineTo(rx+13, ry+22); ctx.fill();

  // Reaction arrow (up) â€” only while thrusting with fuel
  if (rocketState.running && rocketState.vy < 0 && rocketState.fuelFrames > 0) {
    ctx.strokeStyle = '#44ff88'; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(rx+36, ry); ctx.lineTo(rx+36, ry-46); ctx.stroke();
    ctx.fillStyle = '#44ff88';
    ctx.beginPath();
    ctx.moveTo(rx+36, ry-54); ctx.lineTo(rx+30, ry-46); ctx.lineTo(rx+42, ry-46); ctx.fill();
    ctx.font = 'bold 10px Arial, sans-serif'; ctx.textAlign = 'left';
    ctx.fillText('×ª×’×•×‘×”:', rx+42, ry-36);
    ctx.fillText('×¨×§×˜×” ×œ××¢×œ×”!', rx+42, ry-23);
  }

  ctx.textAlign = 'left';

  // Altitude bar update
  document.getElementById('altitude-bar').style.height   = altPct + '%';
  document.getElementById('altitude-text').textContent   = Math.round(altPct) + ' ×\'';
  document.getElementById('rocket-altitude').textContent = Math.round(altPct) + ' ×\'';
}

function launchRocket() {
  if (rocketState.running) return;
  var cvs = document.getElementById('canvas-rocket');
  var groundY = cvs ? cvs.height - 38 : 262;
  rocketState.y  = groundY;
  rocketState.vy = 0;
  rocketState.running = true;
  rocketState.exhaustParticles = [];
  rocketState.maxFuel  = Math.round(60 + rocketState.thrust * 0.8);
  rocketState.fuelFrames = rocketState.maxFuel;
  animateRocket();
}

function animateRocket() {
  var cvs = document.getElementById('canvas-rocket');
  if (!cvs || !rocketState.running) { rocketState.running = false; return; }
  var H = cvs.height;
  var groundY = H - 38;

  var hasFuel = rocketState.fuelFrames > 0;
  if (hasFuel) rocketState.fuelFrames--;

  var thrustF = hasFuel ? rocketState.thrust * 0.0085 : 0;
  var gravity = 0.055;
  rocketState.vy -= thrustF;
  rocketState.vy += gravity;
  rocketState.vy  = Math.max(rocketState.vy, -10);
  rocketState.y  += rocketState.vy;
  if (rocketState.y < 18) { rocketState.y = 18; rocketState.vy = 0; }

  if (hasFuel && rocketState.vy < 0) {
    for (var i = 0; i < 4; i++) {
      rocketState.exhaustParticles.push({
        x: cvs.width/2 + (Math.random()-0.5)*14,
        y: rocketState.y + 24 + Math.random()*8,
        vx: (Math.random()-0.5)*1.4,
        vy: Math.random()*3 + 0.8,
        r:  Math.random()*4 + 2,
        life: 1,
        color: ['#FF6B35','#FFD700','#ff3300'][Math.floor(Math.random()*3)]
      });
    }
  }

  rocketState.exhaustParticles = rocketState.exhaustParticles
    .filter(function(p) { return p.life > 0; })
    .map(function(p) { return { x:p.x+p.vx, y:p.y+p.vy, vx:p.vx, vy:p.vy, r:p.r, life:p.life-0.03, color:p.color }; });

  document.getElementById('rocket-speed').textContent = Math.abs(rocketState.vy * 2).toFixed(1) + ' ×\'/×©\'';

  drawRocketCanvas();

  if (rocketState.y >= groundY) {
    rocketState.running = false;
    rocketState.y  = groundY;
    rocketState.vy = 0;
    drawRocketCanvas();
    if (!state.rocket3bDone) {
      state.rocket3bDone = true;
      addScore(100);
      document.getElementById('rocket-pts-msg').style.display = 'inline';
      checkLaw3Done();
    }
    return;
  }

  if (rocketState.running) {
    rocketState.raf = requestAnimationFrame(animateRocket);
  }
}

function resetRocket() {
  cancelAnimationFrame(rocketState.raf);
  var cvs = document.getElementById('canvas-rocket');
  rocketState.y  = cvs ? cvs.height - 38 : 262;
  rocketState.vy = 0;
  rocketState.running = false;
  rocketState.exhaustParticles = [];
  rocketState.fuelFrames = 0;
  rocketState.maxFuel   = 0;
  document.getElementById('altitude-bar').style.height   = '0%';
  document.getElementById('altitude-text').textContent   = '0 ×\'';
  document.getElementById('rocket-altitude').textContent = '0 ×\'';
  document.getElementById('rocket-speed').textContent    = '0 ×\'/×©\'';
  drawRocketCanvas();
}

// ================================================================
//  QUIZ
// ================================================================
var QUIZ_DATA = [
  {
    q: "×“×™×¡×§ ×”×•×§×™ ××—×œ×™×§ ×”×¨×‘×” ×™×•×ª×¨ ×¨×—×•×§ ×¢×œ ×§×¨×— ×××©×¨ ×¢×œ ×“×©×. ×–×” ×‘×’×œ×œ ×—×•×§ × ×™×•×˜×•×Ÿ ×”...?",
    opts: ["×”×¨××©×•×Ÿ (××™× ×¨×¦×™×”) âœ“", "×”×©× ×™ (×›×•×—=××¡×”Ã—×ª××•×¦×”)", "×”×©×œ×™×©×™ (×¤×¢×•×œ×”/×ª×’×•×‘×”)", "×—×•×§ ×”×›×‘×™×“×”"],
    correct: 0,
    exp: "×”×—×•×§ ×”×¨××©×•×Ÿ ××•××¨ ×©×’×•×¤×™× ×××©×™×›×™× ×œ× ×•×¢ ××œ× ×× ×›×Ÿ ×›×•×— ×¢×•×¦×¨ ××•×ª×. ×œ×§×¨×— ×™×© ×—×™×›×•×š × ××•×š ×××•×“, ×•×œ×›×Ÿ ×”×“×™×¡×§ ××—×œ×™×§ ×”×¨×‘×” ×™×•×ª×¨ ×¨×—×•×§!"
  },
  {
    q: "×‘×¢×˜×ª ×‘×›×“×•×¨ ×›×“×•×¨×’×œ ×•×‘×›×“×•×¨ ×›×“×•×¨×ª ×¢× ××•×ª×• ×›×•×—. ××™ ×™×’×™×¢ ×¨×—×•×§ ×™×•×ª×¨?",
    opts: ["×›×“×•×¨ ×”×›×“×•×¨×’×œ âœ“", "×›×“×•×¨ ×”×›×“×•×¨×ª", "×©× ×™×”× ××•×ª×• ×“×‘×¨", "××£ ××—×“ ×œ× ×–×–"],
    correct: 0,
    exp: "×—×•×§ ×©× ×™: ×ª××•×¦×” = ×›×•×— Ã· ××¡×”. ×¢× ××•×ª×• ×›×•×—, ×›×“×•×¨ ×”×›×“×•×¨×’×œ ×”×§×œ ××§×‘×œ ×ª××•×¦×” ×’×“×•×œ×” ×‘×”×¨×‘×” ×××©×¨ ×›×“×•×¨ ×”×›×“×•×¨×ª ×”×›×‘×“!"
  },
  {
    q: "×× ×•×¢ ×”×¨×§×˜×” ×“×•×—×£ ×’×–×™× ×—××™× ×›×œ×¤×™ ××˜×”. ××” ×§×•×¨×” ×œ×¨×§×˜×”?",
    opts: ["×”×™× ×¢×•×œ×” ×œ××¢×œ×” âœ“", "×”×™× ×™×•×¨×“×ª ×œ××˜×”", "×”×™× × ×©××¨×ª ×‘××§×•×", "×”×™× ××¡×ª×•×‘×‘×ª"],
    correct: 0,
    exp: "×—×•×§ ×©×œ×™×©×™! ×”×¨×§×˜×” ×“×•×—×¤×ª ×’×–×™× ×œ××˜×” (×¤×¢×•×œ×”), ××– ×”×’×–×™× ×“×•×—×¤×™× ××ª ×”×¨×§×˜×” ×œ××¢×œ×” (×ª×’×•×‘×”) â€” ×›×•×— ×©×•×•×”, ×›×™×•×•×Ÿ ×”×¤×•×š!"
  },
  {
    q: "×œ××” ×¦×¨×™×š ×—×’×•×¨×ª ×‘×˜×™×—×•×ª ×›×©×”×¨×›×‘ ×¢×•×¦×¨ ×¤×ª××•×?",
    opts: ["×”×’×•×£ ×××©×™×š ×œ× ×•×¢ ×§×“×™××” ×‘×’×œ×œ ××™× ×¨×¦×™×” âœ“", "×”×¨×›×‘ ××•×©×š ××ª×›× ×§×“×™××”", "×”×‘×œ××™× ×“×•×—×¤×™× ××ª×›×", "×”×›×‘×™×“×” ××•×©×›×ª ××ª×›×"],
    correct: 0,
    exp: "×—×•×§ ×¨××©×•×Ÿ â€” ××™× ×¨×¦×™×”! ×”×’×•×£ ×©×œ×š × ×¢ ×¢× ×”×¨×›×‘. ×›×©×”×¨×›×‘ ×¢×•×¦×¨, ×”×’×•×£ ×¨×•×¦×” ×œ×”××©×™×š ×œ× ×•×¢. ×—×’×•×¨×ª ×”×‘×˜×™×—×•×ª ××¤×¢×™×œ×” ××ª ×›×•×— ×”×¢×¦×™×¨×”!"
  },
  {
    q: "×× ××›×¤×™×œ×™× ××ª ××¡×ª ×”×¢×¦× ×•×©×•××¨×™× ×¢×œ ××•×ª×• ×›×•×—, ×”×ª××•×¦×” ×ª×”×™×”...?",
    opts: ["××—×¦×™×ª âœ“", "×›×¤×•×œ×”", "××•×ª×• ×”×“×‘×¨", "×¤×™ ×©×œ×•×©"],
    correct: 0,
    exp: "×ª××•×¦×” = ×›×•×— Ã· ××¡×”. ×× ×”××¡×” ××•×›×¤×œ×ª ×•×”×›×•×— × ×©××¨ ×–×”×”: ×ª××•×¦×” = ×›×•×— Ã· (2Ã—××¡×”) = ××—×¦×™×ª ×”×ª××•×¦×” ×”××§×•×¨×™×ª!"
  },
  {
    q: "×›×“×•×¨ ×‘×¨××© ×’×‘×¢×” ××—×–×™×§ ×‘××™×–×” ×¡×•×’ ×× ×¨×’×™×”?",
    opts: ["×× ×¨×’×™×” ×¤×•×˜× ×¦×™××œ×™×ª (×’×•×‘×” ×¦×‘×•×¨)", "×× ×¨×’×™×” ×§×™× ×˜×™×ª (×ª× ×•×¢×”)", "×× ×¨×’×™×” ×—×©××œ×™×ª", "××™×Ÿ ×œ×• ×× ×¨×’×™×” ×›×œ×œ"],
    correct: 0,
    exp: "×‘×¨××© ×”×’×‘×¢×” ×œ×›×“×•×¨ ×™×© ×× ×¨×’×™×” ×¤×•×˜× ×¦×™××œ×™×ª â€” ×× ×¨×’×™×” ×¦×‘×•×¨×” ×‘×’×œ×œ ×’×•×‘×”×•. ×›×©×”×•× ××ª×’×œ×’×œ ×œ××˜×”, ×”×× ×¨×’×™×” ×”×¤×•×˜× ×¦×™××œ×™×ª ×”×•×¤×›×ª ×œ×§×™× ×˜×™×ª (×ª× ×•×¢×”)!"
  },
  {
    q: "×‘××™×–×• ×–×•×•×™×ª ×›×“××™ ×œ×–×¨×•×§ ×›×“×•×¨ ×›×“×™ ×©×™×’×™×¢ ×œ×›×™ ×¨×—×•×§?",
    opts: ["45 ××¢×œ×•×ª", "90 ××¢×œ×•×ª (×™×©×¨ ×œ××¢×œ×”)", "10 ××¢×œ×•×ª (×›××¢×˜ ×©×˜×•×—)", "0 ××¢×œ×•×ª (××•×¤×§×™ ×œ×’××¨×™)"],
    correct: 0,
    exp: "45Â° × ×•×ª×Ÿ ××ª ×”××™×–×•×Ÿ ×”××•×©×œ× ×‘×™×Ÿ ×’×•×‘×” ×•××¨×—×§ ××•×¤×§×™, ×•××™×™×¦×¨ ××ª ×”×˜×•×•×— ×”××¨×‘×™ ×œ×›×œ ×§×œ×™×¢ ×©× ×–×¨×§ ×‘××•×ª×” ××”×™×¨×•×ª!"
  }
];

var quizAnswered = {};

function buildQuiz() {
  quizAnswered = {};
  state.quizSubmitted = false;
  var container = document.getElementById('quiz-questions');
  container.innerHTML = '';
  document.getElementById('quiz-result').style.display   = 'none';
  document.getElementById('quiz-submit-area').style.display = 'block';
  var btn = document.getElementById('quiz-submit-btn');
  btn.disabled = false;
  btn.style.opacity = '1';

  QUIZ_DATA.forEach(function(q, qi) {
    var div = document.createElement('div');
    div.className = 'quiz-question';
    div.id = 'q-' + qi;
    var optsHtml = q.opts.map(function(opt, oi) {
      return '<button class="q-opt" id="opt-'+qi+'-'+oi+'" onclick="selectAnswer('+qi+','+oi+')">'
           + String.fromCharCode(65+oi) + ') ' + opt + '</button>';
    }).join('');
    div.innerHTML = '<div class="q-text">' + (qi+1) + '. ' + q.q + '</div>'
                  + '<div class="q-options">' + optsHtml + '</div>'
                  + '<div class="q-explanation" id="exp-' + qi + '"></div>';
    container.appendChild(div);
  });
}

function selectAnswer(qi, oi) {
  if (state.quizSubmitted) return;
  quizAnswered[qi] = oi;
  for (var i = 0; i < QUIZ_DATA[qi].opts.length; i++) {
    var b = document.getElementById('opt-'+qi+'-'+i);
    b.style.borderColor = (i === oi) ? 'var(--gold)' : '#444';
    b.style.background  = (i === oi) ? 'rgba(255,215,0,0.15)' : '';
    b.style.color       = (i === oi) ? '#fff' : '';
  }
}

function submitQuiz() {
  if (Object.keys(quizAnswered).length < QUIZ_DATA.length) {
    showNotif('×¢× ×” ×¢×œ ×›×œ 7 ×”×©××œ×•×ª ×ª×—×™×œ×”!');
    return;
  }
  state.quizSubmitted = true;
  var correct = 0;

  QUIZ_DATA.forEach(function(q, qi) {
    var chosen    = quizAnswered[qi];
    var isCorrect = (chosen === q.correct);
    if (isCorrect) correct++;

    for (var oi = 0; oi < q.opts.length; oi++) {
      var btn = document.getElementById('opt-'+qi+'-'+oi);
      btn.classList.add('disabled');
      btn.style.borderColor = '';
      btn.style.background  = '';
      btn.style.color       = '';
      if (oi === q.correct)                btn.classList.add('correct');
      else if (oi === chosen && !isCorrect) btn.classList.add('wrong');
    }

    var expDiv = document.getElementById('exp-' + qi);
    expDiv.textContent = isCorrect
      ? '\u2705 ' + q.exp
      : '\u274C ×ª×©×•×‘×” × ×›×•× ×”: ' + q.opts[q.correct] + '. ' + q.exp;
    expDiv.className = 'q-explanation show ' + (isCorrect ? 'correct-exp' : 'wrong-exp');
  });

  var pts = correct * 40;
  document.getElementById('quiz-result-heading').textContent = '×ª×•×¦××•×ª ×”×—×™×“×•×Ÿ: ' + correct + '/' + QUIZ_DATA.length + ' × ×›×•×Ÿ!';
  document.getElementById('quiz-result-msg').textContent = '×§×™×‘×œ×ª ' + pts + ' × ×§×•×“×•×ª ××ª×•×š ' + (QUIZ_DATA.length * 40) + '!';
  document.getElementById('quiz-result').style.display   = 'block';
  document.getElementById('quiz-submit-area').style.display = 'none';

  if (!state.quizDone) {
    state.quizDone = true;
    updateDot('quiz', true);
    document.getElementById('home-done-quiz').style.display = 'block';
    addScore(pts);
    checkCompletion();
  }
}

function retakeQuiz() {
  state.quizSubmitted = false;
  quizAnswered = {};
  buildQuiz();
}

// ================================================================
// ENERGY LESSON â€” Roller Coaster
// ================================================================
var rcRaf = null;
var rcState = { running: false, cartX: 0, cartY: 0, launched: false, t: 0 };

function getRCProfile(cvs) {
  var pts = [];
  var w = cvs.width, h = cvs.height;
  var groundY = h - 30;
  for (var i = 0; i <= 100; i++) {
    var x = (i / 100) * w;
    var nx = i / 100;
    var heightPct = parseFloat(document.getElementById('rc-height').value) / 100;
    var hillH = (h - 60) * heightPct;
    var y = groundY - hillH * Math.pow(1 - nx, 1.5);
    pts.push({ x: x, y: y });
  }
  return pts;
}

function drawRCCanvas() {
  var cvs = document.getElementById('canvas-rc');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var w = cvs.width, h = cvs.height;
  ctx.clearRect(0, 0, w, h);
  var groundY = h - 30;
  var heightPct = parseFloat(document.getElementById('rc-height').value) / 100;
  var hillH = (h - 60) * heightPct;

  var pts = getRCProfile(cvs);
  ctx.beginPath();
  ctx.moveTo(0, groundY);
  pts.forEach(function(p) { ctx.lineTo(p.x, p.y); });
  ctx.lineTo(w, groundY);
  ctx.closePath();
  ctx.fillStyle = '#1e4d2b';
  ctx.fill();

  ctx.strokeStyle = '#22c55e';
  ctx.lineWidth = 2;
  ctx.beginPath();
  pts.forEach(function(p, i) { i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y); });
  ctx.stroke();

  var cx = rcState.cartX, cy = rcState.cartY;
  ctx.fillStyle = '#FFD700';
  ctx.fillRect(cx - 12, cy - 10, 24, 14);
  ctx.beginPath(); ctx.arc(cx - 7, cy + 4, 5, 0, Math.PI * 2); ctx.fillStyle = '#aaa'; ctx.fill();
  ctx.beginPath(); ctx.arc(cx + 7, cy + 4, 5, 0, Math.PI * 2); ctx.fill();

  var maxH = 30;
  var totalE = hillH;
  var pe = totalE * Math.pow(Math.max(0, 1 - rcState.t), 1.5);
  var ke = totalE - pe;
  var peH = (pe / (totalE || 1)) * maxH;
  var keH = (ke / (totalE || 1)) * maxH;
  var bx = 10;
  ctx.fillStyle = '#1e40af'; ctx.fillRect(bx, groundY - peH, 30, peH);
  ctx.fillStyle = '#ea580c'; ctx.fillRect(bx + 35, groundY - keH, 30, keH);
  ctx.fillStyle = '#aaa'; ctx.font = '10px Arial';
  ctx.fillText('×¤.×¤', bx + 5, groundY + 12);
  ctx.fillText('×.×§', bx + 40, groundY + 12);
}

function launchRollerCoaster() {
  if (rcState.running) return;
  rcState.running = true;
  rcState.launched = true;
  rcState.t = 0;
  if (rcRaf) cancelAnimationFrame(rcRaf);
  animateRC();
}

function animateRC() {
  if (!rcState.running) return;
  rcState.t = Math.min(1, rcState.t + 0.012);
  var cvs = document.getElementById('canvas-rc');
  if (!cvs) { rcState.running = false; return; }
  var pts = getRCProfile(cvs);
  var idx = Math.floor(rcState.t * (pts.length - 1));
  idx = Math.min(idx, pts.length - 1);
  rcState.cartX = pts[idx].x;
  rcState.cartY = pts[idx].y;
  drawRCCanvas();
  if (rcState.t < 1) {
    rcRaf = requestAnimationFrame(animateRC);
  } else {
    rcState.running = false;
    document.getElementById('rc-status').textContent = 'ğŸ‰ ×”×§×¨×•×Ÿ ×”×’×™×¢ ×œ×ª×—×ª×™×ª! ×›×œ ×”×× ×¨×’×™×” ×”×¤×•×˜× ×¦×™××œ×™×ª ×”×¤×›×” ×œ×§×™× ×˜×™×ª!';
    if (!state.rcDone) {
      state.rcDone = true;
      addScore(100);
      checkEnergyCompletion();
    }
  }
}

function resetRollerCoaster() {
  rcState.running = false; rcState.t = 0; rcState.launched = false;
  if (rcRaf) cancelAnimationFrame(rcRaf);
  var cvs = document.getElementById('canvas-rc');
  if (!cvs) return;
  var pts = getRCProfile(cvs);
  rcState.cartX = pts[0].x; rcState.cartY = pts[0].y;
  drawRCCanvas();
  document.getElementById('rc-status').textContent = '';
}

function initRCCanvas() {
  var cvs = document.getElementById('canvas-rc');
  if (!cvs) return;
  var pts = getRCProfile(cvs);
  rcState.cartX = pts[0].x; rcState.cartY = pts[0].y;
  drawRCCanvas();
}

// ================================================================
// ENERGY LESSON â€” Bouncing Ball
// ================================================================
var bbRaf = null;
var bbState = { running: false, y: 0, vy: 0, bounces: 0, maxY: 0 };

function launchBounceBall() {
  if (bbState.running) return;
  var cvs = document.getElementById('canvas-bb');
  if (!cvs) return;
  var h = cvs.height;
  var heightPct = parseFloat(document.getElementById('bb-height').value) / 100;
  bbState.running = true;
  bbState.y = (h - 40) * (1 - heightPct) + 10;
  bbState.vy = 0;
  bbState.maxY = h - 25;
  bbState.bounces = 0;
  if (bbRaf) cancelAnimationFrame(bbRaf);
  animateBB();
}

function animateBB() {
  if (!bbState.running) return;
  var cvs = document.getElementById('canvas-bb');
  if (!cvs) { bbState.running = false; return; }
  var ctx = cvs.getContext('2d');
  var w = cvs.width, h = cvs.height;
  bbState.vy += 0.5;
  bbState.y += bbState.vy;
  if (bbState.y >= bbState.maxY) {
    bbState.y = bbState.maxY;
    bbState.vy *= -0.72;
    bbState.bounces++;
    if (!state.bbDone) { state.bbDone = true; addScore(100); checkEnergyCompletion(); }
    if (Math.abs(bbState.vy) < 1.5) { bbState.running = false; }
  }
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = '#374151'; ctx.fillRect(0, bbState.maxY + 2, w, 4);
  var grad = ctx.createRadialGradient(w/2, bbState.y - 4, 2, w/2, bbState.y, 14);
  grad.addColorStop(0, '#f97316'); grad.addColorStop(1, '#7c2d12');
  ctx.beginPath(); ctx.arc(w/2, bbState.y, 14, 0, Math.PI * 2);
  ctx.fillStyle = grad; ctx.fill();
  var startY = (h - 40) * (1 - parseFloat(document.getElementById('bb-height').value)/100) + 10;
  var totalH = bbState.maxY - startY;
  var peRatio = Math.max(0, (bbState.maxY - bbState.y) / (totalH || 1));
  var keRatio = 1 - peRatio;
  ctx.font = 'bold 11px Arial'; ctx.textAlign = 'left';
  ctx.fillStyle = '#60a5fa'; ctx.fillText('×¤.×¤: ' + Math.round(peRatio * 100) + '%', 8, bbState.y + 5);
  ctx.fillStyle = '#f97316'; ctx.fillText('×.×§: ' + Math.round(keRatio * 100) + '%', 8, bbState.y + 18);
  ctx.textAlign = 'start';
  if (bbState.running) bbRaf = requestAnimationFrame(animateBB);
}

function resetBounceBall() {
  bbState.running = false;
  if (bbRaf) cancelAnimationFrame(bbRaf);
  var cvs = document.getElementById('canvas-bb');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  ctx.clearRect(0, 0, cvs.width, cvs.height);
}

function checkEnergyCompletion() {
  if (state.rcDone && state.bbDone && !state.energyDone) {
    state.energyDone = true;
    markDot('energy', true);
  }
}

// ================================================================
// GRAVITY LESSON â€” Projectile Launcher
// ================================================================
var projRaf = null;
var projState = { running: false, x: 0, y: 0, vx: 0, vy: 0, trail: [], launched: false };

function drawProjectileIdle() {
  var cvs = document.getElementById('canvas-proj');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var w = cvs.width, h = cvs.height;
  var groundY = h - 20;
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = '#374151'; ctx.fillRect(0, groundY, w, 4);
  var angle = parseFloat(document.getElementById('proj-angle').value);
  var rad = angle * Math.PI / 180;
  var len = 40;
  var ox = 30, oy = groundY;
  ctx.strokeStyle = '#FFD700'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(ox + Math.cos(rad)*len, oy - Math.sin(rad)*len); ctx.stroke();
  ctx.fillStyle = '#FFD700'; ctx.font = '12px Arial';
  ctx.fillText(angle + 'Â°', ox + Math.cos(rad)*len + 5, oy - Math.sin(rad)*len);
  ctx.beginPath(); ctx.arc(ox, oy - 8, 8, 0, Math.PI * 2);
  ctx.fillStyle = '#e11d48'; ctx.fill();
}

function launchProjectile() {
  if (projState.running) return;
  var cvs = document.getElementById('canvas-proj');
  if (!cvs) return;
  var w = cvs.width, h = cvs.height;
  var groundY = h - 20;
  var angle = parseFloat(document.getElementById('proj-angle').value) * Math.PI / 180;
  var speed = parseFloat(document.getElementById('proj-speed').value) * 0.08;
  projState.running = true;
  projState.x = 30; projState.y = groundY - 8;
  projState.vx = Math.cos(angle) * speed;
  projState.vy = -Math.sin(angle) * speed;
  projState.trail = [];
  if (projRaf) cancelAnimationFrame(projRaf);
  animateProjectile();
}

function animateProjectile() {
  if (!projState.running) return;
  var cvs = document.getElementById('canvas-proj');
  if (!cvs) { projState.running = false; return; }
  var ctx = cvs.getContext('2d');
  var w = cvs.width, h = cvs.height;
  var groundY = h - 20;
  var g = 0.025;
  projState.vy += g;
  projState.x += projState.vx;
  projState.y += projState.vy;
  projState.trail.push({ x: projState.x, y: projState.y });
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = '#374151'; ctx.fillRect(0, groundY, w, 4);
  projState.trail.forEach(function(p, i) {
    ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(225,29,72,' + (i / projState.trail.length) + ')'; ctx.fill();
  });
  ctx.beginPath(); ctx.arc(projState.x, projState.y, 8, 0, Math.PI * 2);
  ctx.fillStyle = '#e11d48'; ctx.fill();
  if (projState.y >= groundY - 8 && projState.trail.length > 5) {
    projState.running = false;
    var dist = Math.round(projState.x - 30);
    document.getElementById('proj-status').textContent = 'ğŸ“ ××¨×—×§: ' + dist + ' ×¤×™×§×¡×œ! × ×¡×” 45Â° ×œ×˜×•×•×— ××¨×‘×™!';
    if (!state.projDone) { state.projDone = true; addScore(100); checkGravityCompletion(); }
    return;
  }
  if (projState.x > w) {
    projState.running = false;
    document.getElementById('proj-status').textContent = 'ğŸš€ ×™×¦× ××”××¡×š! ××¨×—×§ ××¢×•×œ×”!';
    if (!state.projDone) { state.projDone = true; addScore(100); checkGravityCompletion(); }
    return;
  }
  projRaf = requestAnimationFrame(animateProjectile);
}

function resetProjectile() {
  projState.running = false;
  if (projRaf) cancelAnimationFrame(projRaf);
  document.getElementById('proj-status').textContent = '';
  drawProjectileIdle();
}

// ================================================================
// GRAVITY LESSON â€” Worlds Comparison
// ================================================================
var worldsRaf = null;
var worldsState = { running: false, balls: [] };
var WORLDS = [
  { name: '×™×¨×—',        g: 0.004, color: '#C0C0C0' },
  { name: '×××“×™×',      g: 0.009, color: '#FF6B35' },
  { name: '×›×“×•×¨ ×”××¨×¥', g: 0.025, color: '#00C9FF' },
  { name: '×¦×“×§',        g: 0.062, color: '#FFB347' }
];

function launchWorlds() {
  if (worldsState.running) return;
  var cvs = document.getElementById('canvas-worlds');
  if (!cvs) return;
  var h = cvs.height, groundY = h - 20;
  var angle = 45 * Math.PI / 180;
  var speed = 0.065;
  worldsState.running = true;
  worldsState.balls = WORLDS.map(function(wld) {
    return { x: 30, y: groundY - 6, vx: Math.cos(angle)*speed, vy: -Math.sin(angle)*speed, g: wld.g, color: wld.color, name: wld.name, landed: false, trail: [] };
  });
  if (worldsRaf) cancelAnimationFrame(worldsRaf);
  animateWorlds();
}

function animateWorlds() {
  if (!worldsState.running) return;
  var cvs = document.getElementById('canvas-worlds');
  if (!cvs) { worldsState.running = false; return; }
  var ctx = cvs.getContext('2d');
  var w = cvs.width, h = cvs.height, groundY = h - 20;
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = '#374151'; ctx.fillRect(0, groundY, w, 4);
  var allDone = true;
  worldsState.balls.forEach(function(ball) {
    if (!ball.landed) {
      ball.vy += ball.g;
      ball.x += ball.vx;
      ball.y += ball.vy;
      ball.trail.push({ x: ball.x, y: ball.y });
      if (ball.y >= groundY - 6 && ball.trail.length > 3) {
        ball.landed = true;
        ball.y = groundY - 6;
      }
    }
    if (!ball.landed) allDone = false;
    ball.trail.forEach(function(p, i) {
      ctx.beginPath(); ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
      ctx.globalAlpha = i / ball.trail.length * 0.5;
      ctx.fillStyle = ball.color; ctx.fill(); ctx.globalAlpha = 1;
    });
    ctx.beginPath(); ctx.arc(ball.x, ball.y, 7, 0, Math.PI * 2);
    ctx.fillStyle = ball.color; ctx.fill();
    if (ball.landed) {
      ctx.fillStyle = ball.color; ctx.font = 'bold 10px Arial'; ctx.textAlign = 'center';
      ctx.fillText(ball.name, ball.x, groundY + 14);
    }
  });
  ctx.textAlign = 'start';
  if (allDone) {
    worldsState.running = false;
    if (!state.worldsDone) { state.worldsDone = true; addScore(100); checkGravityCompletion(); }
    return;
  }
  worldsRaf = requestAnimationFrame(animateWorlds);
}

function resetWorlds() {
  worldsState.running = false;
  if (worldsRaf) cancelAnimationFrame(worldsRaf);
  var cvs = document.getElementById('canvas-worlds');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  ctx.clearRect(0, 0, cvs.width, cvs.height);
}

function checkGravityCompletion() {
  if ((state.projDone || state.worldsDone) && !state.gravityDone) {
    state.gravityDone = true;
    markDot('gravity', true);
  }
}

// ================================================================
//  INIT
// ================================================================
buildQuiz();
updateFMA();
updateBalloon();
updateThrust();

window.addEventListener('load', function() {
  drawSlideCanvas();
  drawSpaceCanvas();
  drawFMACanvas();
  drawBalloonCanvas();
  drawRocketCanvas();
});
</script>
</body>
</html>
