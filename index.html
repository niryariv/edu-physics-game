<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>חוקי ניוטון - הרפתקת פיזיקה!</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #1A1A2E;
    --card: #0F3460;
    --law1: #00C9FF;
    --law2: #FF6B35;
    --law3: #7B2FBE;
    --energy: #22c55e;
    --gravity: #e11d48;
    --gold: #FFD700;
    --success: #4CAF50;
    --danger: #F44336;
    --text: #E0E0E0;
    --text-dim: #A0A0B0;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: Arial, Tahoma, sans-serif;
    font-size: 17px;
    min-height: 100vh;
    overflow-x: hidden;
    direction: rtl;
    text-align: right;
  }

  #header {
    background: var(--card);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    direction: rtl;
  }

  #header-title { font-size: 18px; font-weight: 700; color: var(--gold); white-space: nowrap; }
  #score-display { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  #score-text { font-size: 17px; font-weight: 700; color: var(--gold); }
  #progress-dots { display: flex; gap: 8px; }

  .dot {
    width: 18px; height: 18px; border-radius: 50%;
    background: #333; border: 2px solid #555;
    transition: background 0.4s, border-color 0.4s;
  }
  .dot.done { background: var(--gold); border-color: var(--gold); box-shadow: 0 0 8px var(--gold); }
  #stars-display { font-size: 20px; letter-spacing: 2px; }
  #progress-bar-wrap { width: 100%; height: 6px; background: #333; border-radius: 3px; margin-top: 4px; }
  #progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--law1), var(--law2), var(--law3), var(--gold));
    border-radius: 3px; transition: width 0.5s ease; width: 0%;
  }

  #nav-tabs {
    display: flex; background: rgba(0,0,0,0.3);
    padding: 8px 12px; gap: 6px; overflow-x: auto; scrollbar-width: none;
    direction: rtl;
  }
  #nav-tabs::-webkit-scrollbar { display: none; }

  .tab-btn {
    padding: 10px 18px; border: none; border-radius: 24px; cursor: pointer;
    font-size: 15px; font-weight: 600; white-space: nowrap;
    transition: all 0.2s; background: var(--card); color: var(--text-dim);
    font-family: Arial, Tahoma, sans-serif;
  }
  .tab-btn:hover { filter: brightness(1.3); transform: translateY(-1px); }
  .tab-btn.active { color: #fff; box-shadow: 0 3px 10px rgba(0,0,0,0.4); }
  .tab-btn[data-tab="home"].active  { background: var(--success); }
  .tab-btn[data-tab="law1"].active  { background: linear-gradient(135deg, #0070a0, var(--law1)); }
  .tab-btn[data-tab="law2"].active  { background: linear-gradient(135deg, #a03000, var(--law2)); }
  .tab-btn[data-tab="law3"].active  { background: linear-gradient(135deg, #4a0a7e, var(--law3)); }
  .tab-btn[data-tab="quiz"].active  { background: linear-gradient(135deg, #a08000, var(--gold)); color: #1A1A2E; }
  .tab-btn[data-tab="energy"].active { background: linear-gradient(135deg, #166534, var(--energy)); }
  .tab-btn[data-tab="gravity"].active { background: linear-gradient(135deg, #881337, var(--gravity)); }

  #main { max-width: 860px; margin: 0 auto; padding: 20px 16px 60px; }
  .section { display: none; }
  .section.active { display: block; }

  .card {
    background: var(--card); border-radius: 16px; padding: 22px;
    margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  }
  .card-law1  { border-right: 5px solid var(--law1); border-left: none; }
  .card-law2  { border-right: 5px solid var(--law2); border-left: none; }
  .card-law3  { border-right: 5px solid var(--law3); border-left: none; }
  .card-quiz  { border-right: 5px solid var(--gold); border-left: none; }
  .card-home  { border-right: 5px solid var(--success); border-left: none; }

  h1 { font-size: 28px; margin-bottom: 12px; }
  h2 { font-size: 22px; margin-bottom: 10px; }
  h3 { font-size: 19px; margin-bottom: 8px; }
  p  { line-height: 1.65; margin-bottom: 10px; font-size: 16px; }

  .highlight-box {
    border-radius: 12px; padding: 16px; margin: 14px 0;
    font-size: 17px; font-weight: 600; line-height: 1.5;
  }
  .hl-law1 { background: rgba(0,201,255,0.12); border: 2px solid rgba(0,201,255,0.4); color: #cff5ff; }
  .hl-law2 { background: rgba(255,107,53,0.12); border: 2px solid rgba(255,107,53,0.4); color: #ffe5d8; }
  .hl-law3 { background: rgba(123,47,190,0.12); border: 2px solid rgba(123,47,190,0.4); color: #e8d4ff; }
  .hl-gold { background: rgba(255,215,0,0.12);  border: 2px solid rgba(255,215,0,0.4);  color: #fff5c0; }

  .examples-list { list-style: none; padding: 0; margin: 10px 0; }
  .examples-list li { padding: 8px 32px 8px 12px; position: relative; font-size: 16px; line-height: 1.5; }
  .examples-list li::before { content: '\25C0'; position: absolute; right: 8px; opacity: 0.7; }

  .btn {
    display: inline-block; padding: 12px 24px; border: none;
    border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 700;
    transition: all 0.2s; text-align: center; line-height: 1.2;
    font-family: Arial, Tahoma, sans-serif;
  }
  .btn:hover   { filter: brightness(1.15); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
  .btn:active  { transform: translateY(0); }
  .btn-law1    { background: var(--law1);    color: #002030; }
  .btn-law2    { background: var(--law2);    color: #fff; }
  .btn-law3    { background: var(--law3);    color: #fff; }
  .btn-gold    { background: var(--gold);    color: #1A1A2E; }
  .btn-success { background: var(--success); color: #fff; }
  .btn-danger  { background: var(--danger);  color: #fff; }
  .btn-gray    { background: #444;           color: #ddd; }
  .btn-sm { padding: 8px 16px;  font-size: 14px; }
  .btn-lg { padding: 14px 32px; font-size: 18px; }
  .btn-row { display: flex; flex-wrap: wrap; gap: 10px; margin: 12px 0; align-items: center; }

  canvas {
    display: block; border-radius: 10px; background: #0a0a1a;
    width: 100%; height: auto; max-width: 100%;
  }
  .canvas-wrap {
    position: relative; margin: 14px 0; border-radius: 10px;
    overflow: hidden; border: 2px solid rgba(255,255,255,0.1);
  }

  .slider-row { display: flex; align-items: center; gap: 12px; margin: 10px 0; flex-wrap: wrap; flex-direction: row-reverse; }
  .slider-label { min-width: 140px; font-size: 15px; font-weight: 600; text-align: right; }
  input[type=range] {
    flex: 1; min-width: 120px; height: 8px; border-radius: 4px;
    outline: none; cursor: pointer; appearance: none; -webkit-appearance: none; background: #333;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; cursor: pointer;
  }
  .slider-law1 { accent-color: var(--law1); }
  .slider-law1::-webkit-slider-thumb { background: var(--law1); }
  .slider-law2 { accent-color: var(--law2); }
  .slider-law2::-webkit-slider-thumb { background: var(--law2); }
  .slider-law3 { accent-color: var(--law3); }
  .slider-law3::-webkit-slider-thumb { background: var(--law3); }
  .slider-energy { accent-color: var(--energy); }
  .slider-gravity { accent-color: var(--gravity); }

  .slider-val { min-width: 64px; font-size: 16px; font-weight: 700; text-align: left; }
  input[type=number] {
    width: 76px; background: #1a2a40; border: 1px solid #445; border-radius: 6px;
    color: var(--text); padding: 5px 8px; font-size: 15px; font-weight: 700;
  }

  .stat-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px; margin: 14px 0;
  }
  .stat-box  { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 14px; text-align: center; }
  .stat-label { font-size: 13px; color: var(--text-dim); margin-bottom: 4px; }
  .stat-value { font-size: 22px; font-weight: 700; }

  .surface-btn {
    padding: 10px 16px; border-radius: 8px; border: 2px solid transparent;
    background: #1a2040; color: #ccc; cursor: pointer; font-size: 14px;
    font-weight: 600; transition: all 0.2s; font-family: Arial, Tahoma, sans-serif;
  }
  .surface-btn:hover { filter: brightness(1.3); }
  .surface-btn.selected { border-color: var(--law1); background: rgba(0,201,255,0.2); color: #fff; }

  /* FORMULA CARD */
  .formula-card {
    background: rgba(0,0,0,0.45); border: 2px solid rgba(255,215,0,0.35);
    border-radius: 14px; padding: 16px 20px; margin: 14px 0;
  }
  .formula-card .formula-title {
    font-size: 13px; color: var(--text-dim); text-transform: uppercase;
    letter-spacing: 1px; margin-bottom: 8px; font-weight: 700;
  }
  .formula-card .formula-main {
    font-size: 18px; font-weight: 700; color: #cff; margin-bottom: 8px; font-family: monospace;
  }
  .formula-card .formula-live { font-size: 15px; color: var(--text-dim); }
  .formula-card .formula-live .fval { color: var(--gold); font-weight: 700; font-size: 17px; }

  /* GOAL BANNER */
  .goal-banner {
    background: rgba(255,215,0,0.1); border: 2px solid var(--gold);
    border-radius: 12px; padding: 12px 18px; margin: 10px 0;
    font-size: 16px; font-weight: 700; color: var(--gold);
  }

  /* RESULT BANNER */
  .result-banner {
    border-radius: 12px; padding: 14px 18px; margin: 12px 0;
    font-size: 16px; font-weight: 700; display: none;
  }
  .result-banner.success { background: rgba(76,175,80,0.2); border: 2px solid var(--success); color: #a0ffb0; }
  .result-banner.fail    { background: rgba(244,67,54,0.2);  border: 2px solid var(--danger);  color: #ffb0b0; }
  .result-banner.show    { display: block; }

  /* PREV LINK */
  .prev-link {
    font-size: 13px; color: var(--text-dim); font-style: italic;
    margin-bottom: 14px; line-height: 1.5; padding: 10px 14px;
    background: rgba(0,0,0,0.2); border-radius: 8px;
    border-right: 3px solid rgba(255,215,0,0.3);
  }

  .quiz-question { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 18px; margin-bottom: 16px; }
  .q-text { font-size: 17px; font-weight: 600; margin-bottom: 12px; line-height: 1.5; }
  .q-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  @media (max-width: 480px) { .q-options { grid-template-columns: 1fr; } }
  .q-opt {
    padding: 12px 16px; border-radius: 9px; border: 2px solid #444;
    background: #1a2040; color: #ddd; cursor: pointer; font-size: 15px;
    font-weight: 600; text-align: right; transition: all 0.2s; line-height: 1.4;
    font-family: Arial, Tahoma, sans-serif;
  }
  .q-opt:hover    { border-color: var(--gold); color: #fff; background: rgba(255,215,0,0.1); }
  .q-opt.correct  { background: rgba(76,175,80,0.25);  border-color: var(--success); color: #a0ffb0; }
  .q-opt.wrong    { background: rgba(244,67,54,0.25);  border-color: var(--danger);  color: #ffb0b0; }
  .q-opt.disabled { cursor: not-allowed; opacity: 0.7; }
  .q-explanation { margin-top: 10px; padding: 10px 14px; border-radius: 8px; font-size: 15px; line-height: 1.5; display: none; }
  .q-explanation.show         { display: block; }
  .q-explanation.correct-exp  { background: rgba(76,175,80,0.15);  color: #a0ffb0; border: 1px solid rgba(76,175,80,0.4); }
  .q-explanation.wrong-exp    { background: rgba(244,67,54,0.15);  color: #ffb0b0; border: 1px solid rgba(244,67,54,0.4); }

  #completion-screen  { text-align: center; padding: 30px 20px; }
  .trophy-heading     { font-size: 32px; color: var(--gold); margin-bottom: 16px; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
  .final-score        { font-size: 52px; font-weight: 900; color: var(--gold); margin: 16px 0; }
  .stars-big          { font-size: 40px; letter-spacing: 6px; margin: 14px 0; }

  .law-summaries {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 14px; margin: 24px 0; text-align: right;
  }
  .law-summary-card { border-radius: 12px; padding: 16px; font-size: 15px; line-height: 1.5; }

  #notif {
    position: fixed; bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--success); color: #fff; padding: 14px 28px;
    border-radius: 30px; font-size: 17px; font-weight: 700;
    z-index: 9999; transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 4px 20px rgba(0,0,0,0.4); white-space: nowrap;
  }
  #notif.show { transform: translateX(-50%) translateY(0); }

  .home-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin: 20px 0; }
  .home-law-card { border-radius: 14px; padding: 20px; cursor: pointer; transition: all 0.25s; text-align: center; }
  .home-law-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
  .home-law-card h3 { font-size: 20px; margin-bottom: 8px; }
  .home-law-card p  { font-size: 14px; opacity: 0.85; margin: 0; }
  .home-card-1    { background: linear-gradient(135deg, #003050, #004870); border: 2px solid var(--law1); }
  .home-card-2    { background: linear-gradient(135deg, #3a1400, #5a2000); border: 2px solid var(--law2); }
  .home-card-3    { background: linear-gradient(135deg, #250a40, #3d1060); border: 2px solid var(--law3); }
  .home-card-quiz { background: linear-gradient(135deg, #302000, #504000); border: 2px solid var(--gold); }

  .done-badge {
    display: inline-block; background: var(--success); color: #fff;
    border-radius: 12px; padding: 3px 10px; font-size: 13px; font-weight: 700; margin-top: 8px;
  }

  .toggle-wrap { display: flex; align-items: center; gap: 10px; margin: 10px 0; flex-direction: row-reverse; justify-content: flex-end; }
  .toggle-switch { position: relative; width: 52px; height: 28px; display: inline-block; }
  .toggle-switch input { display: none; }
  .toggle-slider { position: absolute; inset: 0; background: #444; border-radius: 14px; cursor: pointer; transition: 0.3s; }
  .toggle-slider:before {
    content: ''; position: absolute; width: 22px; height: 22px;
    left: 3px; top: 3px; border-radius: 50%; background: #aaa; transition: 0.3s;
  }
  .toggle-switch input:checked + .toggle-slider { background: var(--law1); }
  .toggle-switch input:checked + .toggle-slider:before { background: #fff; transform: translateX(24px); }
  .atmosphere-status { font-size: 16px; font-weight: 700; }

  .altitude-wrap { display: flex; align-items: flex-end; gap: 10px; height: 200px; margin: 12px 0; }
  .altitude-bar-outer { width: 40px; height: 100%; background: rgba(0,0,0,0.4); border-radius: 8px; border: 2px solid #444; position: relative; overflow: hidden; }
  .altitude-bar-inner { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, var(--law3), #ff80ff); transition: height 0.1s; border-radius: 6px; }
  .altitude-label { font-size: 13px; color: var(--text-dim); writing-mode: vertical-rl; transform: rotate(180deg); }

  @media (max-width: 600px) {
    h1 { font-size: 22px; } h2 { font-size: 18px; }
    .btn-lg { font-size: 16px; padding: 12px 24px; }
    #header-title { font-size: 15px; }
    .tab-btn { padding: 8px 12px; font-size: 13px; }
  }

  .lang-switch { color: var(--gold); border: 1px solid var(--gold); border-radius: 20px; padding: 4px 12px; font-size: 14px; text-decoration: none; white-space: nowrap; transition: background 0.2s; }
  .lang-switch:hover { background: rgba(255,215,0,0.15); }

  .lesson-quiz { background: rgba(255,215,0,0.07); border: 2px solid var(--gold); border-radius: 14px; padding: 20px 22px; margin-top: 28px; }
  .lesson-quiz h3 { color: var(--gold); margin-bottom: 14px; font-size: 1.15em; }
  .lq-question { margin-bottom: 18px; }
  .lq-question .lq-text { font-weight: 600; margin-bottom: 10px; font-size: 1em; line-height: 1.5; }
  .lq-opts { display: flex; flex-direction: column; gap: 7px; }
  .lq-opt { background: var(--card); border: 2px solid #555; border-radius: 8px; padding: 9px 14px; cursor: pointer; text-align: right; font-size: 0.95em; transition: border-color 0.2s, background 0.2s; color: var(--text); font-family: Arial, Tahoma, sans-serif; }
  .lq-opt:hover:not(:disabled) { border-color: var(--gold); background: rgba(255,215,0,0.1); }
  .lq-opt.correct { border-color: var(--success) !important; background: rgba(76,175,80,0.18) !important; color: #fff; }
  .lq-opt.wrong   { border-color: var(--danger)  !important; background: rgba(244,67,54,0.18)  !important; color: #fff; }
  .lq-feedback { margin-top: 8px; font-size: 0.9em; line-height: 1.5; padding: 8px 12px; border-radius: 6px; display: none; }
  .lq-feedback.show { display: block; }
  .lq-feedback.ok  { background: rgba(76,175,80,0.15); color: #86efac; }
  .lq-feedback.bad { background: rgba(244,67,54,0.15); color: #fca5a5; }
  .lesson-quiz-score { text-align: center; margin-top: 16px; font-size: 1.1em; font-weight: 700; color: var(--gold); display: none; }

  .planet-btn {
    padding: 8px 14px; border-radius: 8px; border: 2px solid transparent;
    background: #1a2040; color: #ccc; cursor: pointer; font-size: 13px;
    font-weight: 600; transition: all 0.2s;
  }
  .planet-btn:hover { filter: brightness(1.3); }
  .planet-btn.selected { border-color: var(--gravity); background: rgba(225,29,72,0.2); color: #fff; }
</style>
</head>
<body>

<div id="header">
  <div id="header-title">חוקי ניוטון: הרפתקת פיזיקה! &#128640;</div>
  <div id="score-display">
    <div id="stars-display">&#9734;&#9734;&#9734;&#9734;&#9734;</div>
    <div id="score-text">ניקוד: 0 / 1200</div>
    <div id="progress-dots">
      <div class="dot" id="dot-law1" title="חוק 1: אינרציה"></div>
      <div class="dot" id="dot-law2" title="חוק 2: כוח=מסה&#215;תאוצה"></div>
      <div class="dot" id="dot-law3" title="חוק 3: פעולה/תגובה"></div>
      <div class="dot" id="dot-energy" title="אנרגיה"></div>
      <div class="dot" id="dot-gravity" title="כבידה ותנועת קליעים"></div>
      <div class="dot" id="dot-quiz" title="חידון"></div>
    </div>
  </div>
  <div id="progress-bar-wrap" style="flex-basis:100%"><div id="progress-bar"></div></div>
  <a href="index.en.html" class="lang-switch">&#127482;&#127480; English</a>
</div>

<div id="nav-tabs">
  <button class="tab-btn active" data-tab="home">&#127968; בית</button>
  <button class="tab-btn" data-tab="law1">&#128309; חוק 1</button>
  <button class="tab-btn" data-tab="law2">&#128992; חוק 2</button>
  <button class="tab-btn" data-tab="law3">&#128995; חוק 3</button>
  <button class="tab-btn" data-tab="energy">&#9889; אנרגיה</button>
  <button class="tab-btn" data-tab="gravity">&#127757; כבידה</button>
  <button class="tab-btn" data-tab="quiz">&#10067; חידון</button>
</div>

<div id="main">

  <!-- HOME -->
  <div class="section active" id="sec-home">
    <div class="card card-home">
      <h1>ברוכים הבאים לעולם הפיזיקה! &#127881;</h1>
      <p>יצחק ניוטון גילה שלושה כללים מדהימים שמסבירים כיצד הכל ביקום נע — מדיסקי הוקי ועד רקטות ועד חגורות בטיחות. החוקים האלה נמצאים בכל מקום!</p>
      <p>חקרו כל חוק, בצעו ניסויים, והוכיחו שאתם אלופי פיזיקה על ידי פתרון החידון!</p>
    </div>
    <div class="home-grid">
      <div class="home-law-card home-card-1" onclick="switchTab('law1')">
        <h3>&#128309; חוק 1</h3><h3>אינרציה</h3>
        <p>גוף שנע ממשיך לנוע. גוף במנוחה נשאר במנוחה!</p>
        <div id="home-done-1" style="display:none"><span class="done-badge">&#10003; הושלם!</span></div>
      </div>
      <div class="home-law-card home-card-2" onclick="switchTab('law2')">
        <h3>&#128992; חוק 2</h3><h3>כוח = מסה &#215; תאוצה</h3>
        <p>דחיפה חזקה יותר = תאוצה גדולה יותר. כבד יותר = צריך יותר כוח!</p>
        <div id="home-done-2" style="display:none"><span class="done-badge">&#10003; הושלם!</span></div>
      </div>
      <div class="home-law-card home-card-3" onclick="switchTab('law3')">
        <h3>&#128995; חוק 3</h3><h3>פעולה &amp; תגובה</h3>
        <p>לכל פעולה יש תגובה שווה ומנוגדת!</p>
        <div id="home-done-3" style="display:none"><span class="done-badge">&#10003; הושלם!</span></div>
      </div>
      <div class="home-law-card" style="border-color:var(--energy);background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.05))" onclick="switchTab('energy')">
        <div style="font-size:2em">&#9889;</div>
        <h3 style="color:var(--energy)">שימור האנרגיה</h3>
        <p>אנרגיה לא נוצרת ולא נעלמת — היא רק משנה צורה!</p>
      </div>
      <div class="home-law-card" style="border-color:var(--gravity);background:linear-gradient(135deg,rgba(225,29,72,0.15),rgba(225,29,72,0.05))" onclick="switchTab('gravity')">
        <div style="font-size:2em">&#127757;</div>
        <h3 style="color:var(--gravity)">כבידה וקליעים</h3>
        <p>הכבידה מעקמת כל עצם זרוק לפרבולה!</p>
      </div>
      <div class="home-law-card home-card-quiz" onclick="switchTab('quiz')">
        <h3>&#10067; חידון</h3><h3>בחן את עצמך!</h3>
        <p>7 שאלות. עד 280 נקודות. מוכנים?</p>
        <div id="home-done-quiz" style="display:none"><span class="done-badge">&#10003; הושלם!</span></div>
      </div>
    </div>
    <div class="card" id="completion-screen" style="display:none">
      <div class="trophy-heading">&#127942; אלוף הפיזיקה! &#127942;</div>
      <div class="stars-big" id="final-stars">&#11088;&#11088;&#11088;&#11088;&#11088;</div>
      <div class="final-score" id="final-score-display">0 / 1200</div>
      <p style="font-size:18px;color:#ccc;margin-bottom:20px;">שלטת בשלושת חוקי ניוטון!</p>
      <div class="law-summaries">
        <div class="law-summary-card hl-law1"><strong>&#128309; חוק 1 — אינרציה:</strong><br>גוף ממשיך לעשות מה שהוא עושה אלא אם כן כוח פועל עליו.</div>
        <div class="law-summary-card hl-law2"><strong>&#128992; חוק 2 — כוח=מסה&#215;תאוצה:</strong><br>כוח שווה מסה כפול תאוצה. דחפו חזק יותר או הפחיתו מסה כדי להאיץ מהר יותר!</div>
        <div class="law-summary-card hl-law3"><strong>&#128995; חוק 3 — פעולה/תגובה:</strong><br>לכל דחיפה יש דחיפה חזרה שווה בכיוון הנגדי. כך רקטות עפות!</div>
      </div>
      <button class="btn btn-gold btn-lg" onclick="resetGame()">שחק שוב! &#128260;</button>
    </div>
  </div>

  <!-- LAW 1 -->
  <div class="section" id="sec-law1">
    <div class="card card-law1">
      <h1>&#128309; חוק 1: חוק האינרציה</h1>
      <div class="highlight-box hl-law1">
        אם עצם אינו זז — הוא יישאר עומד. אם עצם נע — הוא ימשיך לנוע באותה מהירות לאותו כיוון לנצח — אם לא יפעל עליו כוח כלשהו. ההתנגדות לשינוי הזאת נקראת אינרציה! &#127944;
      </div>
      <p>תחשבו על זה כך: עצמים הם עצלנים! הם לא רוצים להתחיל לזוז, וכשהם נעים, הם לא רוצים לעצור. אינרציה זה פשוט שם מפוצץ לעצלנות הזאת.</p>
      <ul class="examples-list">
        <li>&#128663; <strong>חגורת בטיחות:</strong> כשמכונית בולמת בחוזקה, גופך ממשיך לעוף קדימה בגלל אינרציה.</li>
        <li>&#127944; <strong>דיסק הוקי על קרח:</strong> קרח חלק מאוד (חיכוך נמוך), ולכן כמעט שום דבר לא מאט את הדיסק — הוא ממשיך להחליק!</li>
        <li>&#128640; <strong>חללית בחלל:</strong> אין אוויר בחלל, ולכן שום דבר לא מאט חללית נעה. היא מחליקה לנצח.</li>
      </ul>
    </div>

    <div class="card card-law1">
      <h2>&#127918; ניסוי 1א — החלקה על משטחים</h2>
      <p>קבע את מהירות ההתחלה v&#8320; ובחר משטח (שקובע את מקדם החיכוך &#956;). הנוסחה מנבאת בדיוק כמה רחוק הדיסק יחליק. פגע בדגל המטרה ב-80 מ'!</p>

      <div class="formula-card">
        <div class="formula-title">עד כמה היא תחלוק?</div>
        <div class="formula-main">מרחק = מהירות&sup2; &divide; (2 &times; חיכוך &times; 9.8)</div>
        <div class="formula-live">
          d = <span class="fval" id="law1-v0-disp">20</span>&sup2; &divide; (2 &times; <span class="fval" id="law1-mu-disp">0.050</span> &times; 9.8)
          = <span class="fval" id="law1-dist-pred">408.2</span> מ'
        </div>
      </div>

      <div class="goal-banner">&#127919; מטרה: פגע בדגל המטרה ב-80 מ' בדיוק!</div>

      <div class="slider-row">
        <span class="slider-label">מהירות התחלתית:</span>
        <input type="range" class="slider-law1" id="law1-v0-slider" min="5" max="40" step="1" value="20" oninput="syncLaw1('v0',this.value)">
        <input type="number" id="law1-v0-num" min="5" max="40" step="1" value="20" oninput="syncLaw1('v0',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">m/s</span>
      </div>

      <div class="slider-row">
        <span class="slider-label">חיכוך משטח:</span>
        <input type="range" class="slider-law1" id="law1-mu-slider" min="0.005" max="0.6" step="0.005" value="0.05" oninput="syncLaw1('mu',this.value)">
        <input type="number" id="law1-mu-num" min="0.005" max="0.6" step="0.005" value="0.05" oninput="syncLaw1('mu',this.value)" style="width:80px">
      </div>

      <div class="btn-row" id="surface-btns">
        <span style="font-size:14px;color:var(--text-dim)">פריסטים:</span>
        <button class="surface-btn" data-surface="ice"    onclick="selectSurface('ice',this)">&#10052;&#65039; קרח &#956;=0.005</button>
        <button class="surface-btn selected" data-surface="custom" onclick="selectSurface('custom',this)">&#9881; מותאם</button>
        <button class="surface-btn" data-surface="wood"   onclick="selectSurface('wood',this)">&#129683; עץ &#956;=0.04</button>
        <button class="surface-btn" data-surface="grass"  onclick="selectSurface('grass',this)">&#127807; דשא &#956;=0.09</button>
        <button class="surface-btn" data-surface="sand"   onclick="selectSurface('sand',this)">&#127958;&#65039; חול &#956;=0.15</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-slide" width="780" height="180">הדפדפן שלך אינו תומך בקנבס.</canvas>
      </div>

      <div id="law1-result" class="result-banner"></div>

      <div class="stat-grid">
        <div class="stat-box">
          <div class="stat-label">מרחק חזוי</div>
          <div class="stat-value" id="slide-pred-dist" style="color:var(--gold)">408 מ'</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">מרחק בפועל</div>
          <div class="stat-value" id="slide-distance" style="color:var(--law1)">-- מ'</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">מהירות נוכחית</div>
          <div class="stat-value" id="slide-speed" style="color:var(--law1)">0 m/s</div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law1 btn-lg" onclick="kickPuck()">&#127944; בעיטה!</button>
        <button class="btn btn-gray btn-sm" onclick="resetSlide()">אתחול</button>
        <span id="slide-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+150 נקודות!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim);margin-top:10px">&#128161; טיפ: כדי לפגוע ב-80 מ', נסה v&#8320;=20 m/s עם &#956;=0.255, או v&#8320;=28 m/s עם &#956;=0.5</p>
    </div>

    <div class="card card-law1">
      <h2>&#127918; ניסוי 1ב — שייט בחלל</h2>
      <p>הפעל את המנוע פעם אחת ואז ראה מה קורה. נסה עם אטמוספרה כבויה (חלל אמיתי!) ואז הפעל אותה כדי לראות את ההבדל.</p>
      <div class="toggle-wrap">
        <label class="toggle-switch">
          <input type="checkbox" id="atmos-toggle" onchange="toggleAtmosphere()">
          <span class="toggle-slider"></span>
        </label>
        <span class="atmosphere-status" id="atmos-label" style="color:#888">&#127756; מצב חלל (ללא התנגדות אוויר)</span>
      </div>
      <div class="canvas-wrap">
        <canvas id="canvas-space" width="780" height="200">הדפדפן שלך אינו תומך בקנבס.</canvas>
      </div>
      <div class="stat-grid">
        <div class="stat-box"><div class="stat-label">אטמוספרה</div><div class="stat-value" id="space-atmos-status" style="color:#888;font-size:15px">כבוי</div></div>
        <div class="stat-box"><div class="stat-label">מהירות</div><div class="stat-value" id="space-speed" style="color:var(--law1)">0 m/s</div></div>
        <div class="stat-box"><div class="stat-label">מרחק</div><div class="stat-value" id="space-distance" style="color:var(--law1)">0 m</div></div>
      </div>
      <div class="btn-row">
        <button class="btn btn-law1 btn-lg"
          onmousedown="startThrust()" onmouseup="stopThrust()"
          ontouchstart="startThrust()" ontouchend="stopThrust()">&#128640; לחץ להנעה!</button>
        <button class="btn btn-gray btn-sm" onclick="resetSpace()">אתחול</button>
        <span id="space-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 נקודות!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim)">&#128161; כשהאטמוספרה כבויה תוכל לראות אינרציה בפעולה — החללית פשוט ממשיכה לנוע!</p>

      <div class="lesson-quiz">
        <h3>&#129504; בחן את עצמך — חוק 1: אינרציה</h3>
        <div id="lq-law1"></div>
      </div>
    </div>
  </div>

  <!-- LAW 2 -->
  <div class="section" id="sec-law2">
    <div class="card card-law2">
      <h1>&#128992; חוק 2: כוח = מסה &#215; תאוצה</h1>
      <div class="highlight-box hl-law2">
        דחף משהו חזק יותר — הוא יאיץ מהר יותר. דחף משהו כבד יותר — הוא יאיץ לאט יותר. הנוסחה: כוח = מסה &#215; תאוצה (או: תאוצה = כוח &divide; מסה) &#128640;
      </div>
      <p>דמיינו שאתם דוחפים עגלת קניות. עגלה ריקה קלה לדחוף מהר. עגלה מלאה בקניות כבדה צריכה דחיפה הרבה יותר חזקה כדי לנוע. אותו כוח נותן לעצם קל יותר תאוצה גדולה יותר.</p>
      <ul class="examples-list">
        <li>&#9917; <strong>אותה בעיטה, כדורים שונים:</strong> בעט בכדור כדורגל קל ובכדורת כבדה עם אותו כוח. הכדור עף רחוק; הכדורת כמעט לא זזה.</li>
        <li>&#127950;&#65039; <strong>מכוניות מירוץ:</strong> מכוניות מירוץ צריכות כוח אדיר כדי להאיץ מ-0 ל-200 קמ"ש בשניות ספורות.</li>
        <li>&#128722; <strong>עגלת קניות:</strong> עגלה ריקה קלה. מלאה בקניות — אותה דחיפה תיתן הרבה פחות תאוצה.</li>
      </ul>
    </div>

    <div class="card card-law2">
      <div class="prev-link">&#128218; מתבסס על חוק 1: בחוק 1, החיכוך היה הכוח שעצר את הדיסק. עכשיו בחוק 2 אתה בוחר את הכוח ישירות. F = ma מראה בדיוק כיצד כוחות משנים מהירות!</div>
      <h2>&#127918; ניסוי — מעבדת תותח ומגדל</h2>
      <p>קבע את כוח התותח ומסת כדור התותח. הנוסחה מנבאת את התאוצה. ירה את כדור התותח — האם תוכל להפיל את המגדל ב-60 מ' בדיוק?</p>

      <div class="formula-card">
        <div class="formula-title">החוק השני של ניוטון</div>
        <div class="formula-main">תאוצה = כוח &divide; מסה</div>
        <div class="formula-live">
          a = <span class="fval" id="law2-f-disp">80</span> N &divide; <span class="fval" id="law2-m-disp">5</span> kg
          = <span class="fval" id="law2-a-disp">16.0</span> m/s&sup2;
        </div>
      </div>

      <div class="goal-banner">&#127919; מטרה: הפל את המגדל ב-60 מ' בדיוק!</div>

      <div class="slider-row">
        <span class="slider-label">כוח התותח:</span>
        <input type="range" class="slider-law2" id="force-slider" min="10" max="200" step="5" value="80" oninput="syncLaw2('f',this.value)">
        <input type="number" id="force-num" min="10" max="200" step="5" value="80" oninput="syncLaw2('f',this.value)" style="width:76px">
        <span style="color:var(--text-dim);font-size:14px">N</span>
      </div>
      <div class="slider-row">
        <span class="slider-label">מסת כדור התותח:</span>
        <input type="range" class="slider-law2" id="mass-slider" min="1" max="20" step="0.5" value="5" oninput="syncLaw2('m',this.value)">
        <input type="number" id="mass-num" min="1" max="20" step="0.5" value="5" oninput="syncLaw2('m',this.value)" style="width:76px">
        <span style="color:var(--text-dim);font-size:14px">kg</span>
      </div>

      <div class="btn-row">
        <span style="font-size:14px;color:var(--text-dim)">פריסטים מהירים:</span>
        <button class="btn btn-gray btn-sm" onclick="setPreset(0.45,'כדור כדורגל')">כדור כדורגל (0.45 kg)</button>
        <button class="btn btn-gray btn-sm" onclick="setPreset(5,'קופסה')">קופסה (5 kg)</button>
        <button class="btn btn-gray btn-sm" onclick="setPreset(20,'סלע')">סלע (20 kg)</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-fma" width="780" height="180">הדפדפן שלך אינו תומך בקנבס.</canvas>
      </div>

      <div id="law2-result" class="result-banner"></div>

      <div class="stat-grid">
        <div class="stat-box"><div class="stat-label">כוח</div><div class="stat-value" id="fma-f" style="color:var(--law2)">80 N</div></div>
        <div class="stat-box"><div class="stat-label">מסה</div><div class="stat-value" id="fma-m" style="color:var(--law2)">5 kg</div></div>
        <div class="stat-box"><div class="stat-label">תאוצה</div><div class="stat-value" id="fma-a" style="color:var(--gold)">16.0 m/s&sup2;</div></div>
        <div class="stat-box"><div class="stat-label">עצם</div><div class="stat-value" id="fma-obj" style="color:var(--law2);font-size:14px">מותאם</div></div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law2 btn-lg" onclick="launchFMA()">&#128640; ירי!</button>
        <button class="btn btn-success btn-lg" onclick="raceMode()">&#127937; מצב מרוץ!</button>
        <button class="btn btn-gray btn-sm" onclick="resetFMA()">אתחול</button>
      </div>
      <p style="font-size:14px;color:var(--text-dim)">מצב מרוץ משגר כדור כדורגל, קופסה וסלע בו-זמנית עם אותו כוח!</p>
      <div style="margin-top:8px">
        <span id="fma-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">ניקוד!</span>
      </div>

      <div class="lesson-quiz">
        <h3>&#129504; בחן את עצמך — חוק 2: F = ma</h3>
        <div id="lq-law2"></div>
      </div>
    </div>
  </div>

  <!-- LAW 3 -->
  <div class="section" id="sec-law3">
    <div class="card card-law3">
      <h1>&#128995; חוק 3: פעולה ותגובה</h1>
      <div class="highlight-box hl-law3">
        לכל דחיפה יש דחיפה חזרה שווה! אם דחפת משהו, הוא דוחף אותך חזרה בדיוק באותה עוצמה — אבל בכיוון ההפוך! &#128640;
      </div>
      <p>נסה לדחוף קיר. אתה דוחף את הקיר קדימה; הקיר דוחף אותך אחורה בדיוק באותה עוצמה. לכן רקטות עובדות — הן דוחפות גז אחורה, והגז דוחף את הרקטה קדימה!</p>
      <ul class="examples-list">
        <li>&#128640; <strong>מנועי רקטה:</strong> גזים לוהטים יורים למטה (פעולה). הגזים דוחפים את הרקטה למעלה (תגובה).</li>
        <li>&#127880; <strong>בלון:</strong> שחרר בלון מנופח — האוויר יוצא מצד אחד (פעולה), הבלון עף לכיוון ההפוך (תגובה)!</li>
        <li>&#127944; <strong>שחייה:</strong> אתה דוחף מים אחורה (פעולה). המים דוחפים אותך קדימה (תגובה).</li>
      </ul>
    </div>

    <div class="card card-law3">
      <h2>&#127918; ניסוי 3א — רקטת בלון</h2>
      <p>הזז את המחוון כדי לבחור כמה אוויר יש בבלון, ולחץ שחרר! יותר אוויר = יותר כוח = מרחק גדול יותר!</p>
      <div class="slider-row">
        <span class="slider-label">&#128168; אוויר בבלון:</span>
        <input type="range" class="slider-law3" id="balloon-slider" min="10" max="100" value="60" oninput="updateBalloon()">
        <span class="slider-val" id="balloon-val" style="color:var(--law3)">60%</span>
      </div>
      <div class="canvas-wrap">
        <canvas id="canvas-balloon" width="780" height="190">הדפדפן שלך אינו תומך בקנבס.</canvas>
      </div>
      <div class="stat-grid">
        <div class="stat-box"><div class="stat-label">ניפוח</div><div class="stat-value" id="bal-inflation" style="color:var(--law3)">60%</div></div>
        <div class="stat-box"><div class="stat-label">כוח האוויר</div><div class="stat-value" id="bal-force" style="color:var(--law3)">60 N</div></div>
        <div class="stat-box"><div class="stat-label">מרחק</div><div class="stat-value" id="bal-distance" style="color:var(--law3)">-- m</div></div>
      </div>
      <div class="btn-row">
        <button class="btn btn-law3 btn-lg" onclick="releaseBalloon()">&#128168; שחרר!</button>
        <button class="btn btn-gray btn-sm" onclick="resetBalloon()">אתחול</button>
        <span id="bal-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+100 נקודות!</span>
      </div>
    </div>

    <div class="card card-law3">
      <div class="prev-link">&#128218; מתבסס על חוק 2: בחוק 2, F = ma הראה כיצד כוח יוצר תאוצה. עכשיו הדחף של הרקטה הוא אותו כוח — שנוצר על ידי חוק ניוטון השלישי!</div>
      <h2>&#127918; ניסוי 3ב — שיגור רקטה</h2>
      <p>קבע את קצב שריפת הדלק ומהירות גז הפליטה. הנוסחה מחשבת את הדחף האמיתי. האם תגיע למסלול ב-500 מ' גובה?</p>

      <div class="formula-card">
        <div class="formula-title">דחף הרקטה (החוק השלישי של ניוטון)</div>
        <div class="formula-main">דחף = קצב שריפה &times; מהירות גז</div>
        <div class="formula-live">
          דחף = <span class="fval" id="law3-br-disp">8</span> kg/s &times; <span class="fval" id="law3-ex-disp">400</span> m/s
          = <span class="fval" id="law3-thrust-disp">3200</span> N
          &nbsp;|&nbsp; משקל הרקטה = <span class="fval" id="law3-weight-disp">~784</span> N
          &nbsp;&#8594;&nbsp; כוח נטו כלפי מעלה: <span class="fval" id="law3-net-disp">~2416</span> N
        </div>
      </div>

      <div class="goal-banner">&#127919; מטרה: הגע למסלול ב-500 מ' גובה!</div>

      <div class="slider-row">
        <span class="slider-label">קצב שריפת דלק:</span>
        <input type="range" class="slider-law3" id="burn-rate-slider" min="1" max="20" step="0.5" value="8" oninput="syncLaw3('br',this.value)">
        <input type="number" id="burn-rate-num" min="1" max="20" step="0.5" value="8" oninput="syncLaw3('br',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">kg/s</span>
      </div>
      <div class="slider-row">
        <span class="slider-label">מהירות גז הפליטה:</span>
        <input type="range" class="slider-law3" id="exhaust-speed-slider" min="100" max="1000" step="50" value="400" oninput="syncLaw3('ex',this.value)">
        <input type="number" id="exhaust-speed-num" min="100" max="1000" step="50" value="400" oninput="syncLaw3('ex',this.value)" style="width:80px">
        <span style="color:var(--text-dim);font-size:14px">m/s</span>
      </div>

      <div style="display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start">
        <div class="canvas-wrap" style="flex:1;min-width:240px">
          <canvas id="canvas-rocket" width="380" height="300">הדפדפן שלך אינו תומך בקנבס.</canvas>
        </div>
        <div style="flex:0 0 auto;padding-top:4px">
          <div style="margin-bottom:8px;font-size:14px;color:var(--text-dim)">גובה</div>
          <div class="altitude-wrap">
            <div class="altitude-bar-outer">
              <div class="altitude-bar-inner" id="altitude-bar" style="height:0%"></div>
            </div>
          </div>
          <div style="margin-top:6px;font-size:18px;font-weight:700;color:var(--law3)" id="altitude-text">0 m</div>
          <div style="margin-top:4px;font-size:12px;color:var(--gold)" id="orbit-label">מסלול: 500 m</div>
        </div>
      </div>

      <div id="law3-result" class="result-banner"></div>

      <div class="stat-grid">
        <div class="stat-box"><div class="stat-label">דחף</div><div class="stat-value" id="rocket-thrust" style="color:var(--law3)">3200 N</div></div>
        <div class="stat-box"><div class="stat-label">גובה מרבי</div><div class="stat-value" id="rocket-altitude" style="color:var(--law3)">0 m</div></div>
        <div class="stat-box"><div class="stat-label">מהירות</div><div class="stat-value" id="rocket-speed" style="color:var(--law3)">0 m/s</div></div>
      </div>

      <div class="btn-row">
        <button class="btn btn-law3 btn-lg" onclick="launchRocket()">&#128640; !שיגור</button>
        <button class="btn btn-gray btn-sm" onclick="resetRocket()">אתחול</button>
        <span id="rocket-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+150 נקודות!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim);margin-top:10px">&#128161; הדחף חייב לעלות על המשקל (מסה &#215; 9.8) כדי להמריא! נסה דחף &gt; 500 N למסלול.</p>

      <div class="lesson-quiz">
        <h3>&#129504; בחן את עצמך — חוק 3: פעולה ותגובה</h3>
        <div id="lq-law3"></div>
      </div>
    </div>
  </div>

  <!-- ENERGY -->
  <div class="section" id="sec-energy">
    <div style="background:linear-gradient(135deg,#166534,var(--energy));border-radius:16px;padding:22px;margin-bottom:20px">
      <h2>&#9889; חוק שימור האנרגיה</h2>
      <p style="margin:0;opacity:0.9">אנרגיה לא נוצרת ולא נעלמת — היא רק משנה צורה!</p>
    </div>
    <div class="card">
      <p>אנרגיה היא כמו מטבע ש<strong>לעולם לא נעלם</strong> — הוא רק <em>מוחלף</em> בסוג אחר!</p>
      <p><strong>אנרגיה פוטנציאלית</strong> היא אנרגיה צבורה — כמו כדור בראש גבעה. <strong>אנרגיה קינטית</strong> היא אנרגיה של תנועה. כשהכדור מתגלגל למטה, כל האנרגיה הפוטנציאלית הופכת לקינטית. הסכום תמיד נשאר זהה.</p>
    </div>
    <div class="card" style="border-right:5px solid var(--energy);border-left:none">
      <div class="prev-link">&#128218; מתבסס על חוק 3: בחוק 3, הרקטה שרפה דלק כדי לצבור מהירות. אותה מהירות היא אנרגיה קינטית (&frac12;mv&sup2;)!</div>
      <h3>&#127906; ניסוי: לולאת רכבת הרים</h3>
      <p>קבע גובה התחלתי ומסת העגלה. הנוסחה מראה כיצד הגובה הופך למהירות בתחתית. אתה צריך v&#8805;14 m/s להשלמת הלולאה!</p>

      <div class="formula-card">
        <div class="formula-title">שימור אנרגיה</div>
        <div class="formula-main">גובה &rarr; מהירות: &nbsp; מהירות בתחתית = &radic;(2 &times; 9.8 &times; גובה)</div>
        <div class="formula-live">
          אנרגיה צבורה (PE) = <span class="fval" id="en-m-disp">3</span> kg &times; 9.8 &times; <span class="fval" id="en-h-disp">20</span> m
          = <span class="fval" id="en-pe-disp">588</span> J &nbsp;|&nbsp;
          מהירות בתחתית = <span class="fval" id="en-v-disp">19.8</span> m/s
          <span id="en-loop-ok" style="color:var(--success);margin-left:8px">&#10003; מספיק ללולאה!</span>
          <span id="en-loop-fail" style="color:var(--danger);margin-left:8px;display:none">&#10007; צריך גובה גדול יותר!</span>
        </div>
      </div>

      <div class="goal-banner">&#127919; מטרה: השלם את הלולאה! הגע ל-v&#8805;14 m/s בתחתית.</div>

      <div class="slider-row">
        <span class="slider-label">גובה התחלתי:</span>
        <input type="range" class="slider-energy" id="rc-height-slider" min="5" max="30" step="1" value="20" oninput="syncEnergy('h',this.value)" style="accent-color:var(--energy)">
        <input type="number" id="rc-height-num" min="5" max="30" step="1" value="20" oninput="syncEnergy('h',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">m</span>
      </div>
      <div class="slider-row">
        <span class="slider-label">מסת העגלה:</span>
        <input type="range" class="slider-energy" id="rc-mass-slider" min="1" max="10" step="0.5" value="3" oninput="syncEnergy('m',this.value)" style="accent-color:var(--energy)">
        <input type="number" id="rc-mass-num" min="1" max="10" step="0.5" value="3" oninput="syncEnergy('m',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">kg</span>
      </div>

      <canvas id="canvas-rc" width="780" height="220" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">סימולציית רכבת הרים</canvas>

      <div id="law-energy-result" class="result-banner"></div>
      <div id="rc-status" style="color:var(--energy);font-size:14px;min-height:20px"></div>

      <div class="btn-row">
        <button class="btn btn-lg" style="background:var(--energy)" onclick="launchRollerCoaster()">&#128640; !שיגור</button>
        <button class="btn btn-gray" onclick="resetRollerCoaster()">אתחול</button>
        <span id="energy-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+150 נקודות!</span>
      </div>
      <p style="font-size:14px;color:var(--text-dim);margin-top:8px">&#128064; צפה בעמודת PE מתכווצת ועמודת KE גדלה. בתחתית — הכל אנרגיה קינטית!</p>
    </div>
    <div class="card">
      <h3>&#127944; ניסוי: כדור קופץ</h3>
      <p>קבע גובה שחרור הכדור ולחץ שחרר!</p>
      <div style="margin:10px 0">
        <label>גובה שחרור: <span id="bb-height-val">80</span>%</label>
        <input type="range" id="bb-height" min="20" max="100" value="80" oninput="document.getElementById('bb-height-val').textContent=this.value">
      </div>
      <button class="btn" style="background:var(--energy)" onclick="launchBounceBall()">&#127944; שחרר!</button>
      <button class="btn btn-gray" onclick="resetBounceBall()">אתחול</button>
      <canvas id="canvas-bb" width="300" height="220" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">סימולציית כדור קופץ</canvas>
    </div>
    <div class="card" style="border-right:5px solid var(--energy);border-left:none">
      <h4>&#9889; סוגי אנרגיה:</h4>
      <p>&#127939; <strong>קינטית</strong> — אנרגיית תנועה | &#127956;&#65039; <strong>פוטנציאלית</strong> — אנרגיה צבורה בגובה | &#128293; <strong>תרמית</strong> — אנרגיית חום | &#127822; <strong>כימית</strong> — מזון ודלק | &#9889; <strong>חשמלית</strong> — אלקטרונים זורמים</p>
      <div class="lesson-quiz">
        <h3>&#129504; בחן את עצמך — אנרגיה</h3>
        <div id="lq-energy"></div>
      </div>
    </div>
  </div>

  <!-- GRAVITY -->
  <div class="section" id="sec-gravity">
    <div style="background:linear-gradient(135deg,#881337,var(--gravity));border-radius:16px;padding:22px;margin-bottom:20px">
      <h2>&#127757; כבידה ותנועת קליעים</h2>
      <p style="margin:0;opacity:0.9">כל עצם זרוק עוקב אחר פרבולה מושלמת!</p>
    </div>
    <div class="card">
      <p>הכבידה מושכת כל עצם לכיוון כדור הארץ בתאוצה של <strong>9.8 m/s&sup2;</strong>. כשזורקים כדור, הוא נע <strong>הצידה</strong> מהזריקה וגם <strong>למטה</strong> מהכבידה — השילוב יוצר פרבולה.</p>
      <p>הזווית שאתה זורק בה חשובה מאוד. <strong>הנקודה המושלמת היא 45&deg;</strong> — איזון מושלם בין גובה למרחק.</p>
    </div>

    <div class="card" style="border-right:5px solid var(--gravity);border-left:none">
      <div class="prev-link">&#128218; מתבסס על אנרגיה: בשיעור האנרגיה, גובה התחלתי הפך למהירות שיגור. אותו v&#8320; הוא המהירות ההתחלתית של הקליע!</div>
      <h3>&#127944; ניסוי: משגר גשש</h3>
      <p>קבע מהירות שיגור, זווית וכבידת הכוכב. האם תוכל לנחות עם הגשש על הכרית ב-150 מ' בדיוק?</p>

      <div class="formula-card">
        <div class="formula-title">תנועת קליע</div>
        <div class="formula-main">טווח = מהירות&sup2; &times; sin(2 &times; זווית) &divide; כבידה</div>
        <div class="formula-live">
          טווח = <span class="fval" id="grav-v0-disp">40</span>&sup2; &times; sin(2 &times; <span class="fval" id="grav-ang-disp">45</span>&deg;) &divide; <span class="fval" id="grav-g-disp">9.8</span>
          = <span class="fval" id="grav-range-disp">163.3</span> m
        </div>
      </div>

      <div class="goal-banner">&#127919; מטרה: נחת עם הגשש על הכרית ב-150 מ'!</div>

      <div class="slider-row">
        <span class="slider-label">מהירות שיגור:</span>
        <input type="range" class="slider-gravity" id="proj-v0-slider" min="10" max="80" step="1" value="40" oninput="syncGravity('v0',this.value)" style="accent-color:var(--gravity)">
        <input type="number" id="proj-v0-num" min="10" max="80" step="1" value="40" oninput="syncGravity('v0',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">m/s</span>
      </div>
      <div class="slider-row">
        <span class="slider-label">זווית שיגור:</span>
        <input type="range" class="slider-gravity" id="proj-angle-slider" min="10" max="80" step="1" value="45" oninput="syncGravity('ang',this.value)" style="accent-color:var(--gravity)">
        <input type="number" id="proj-angle-num" min="10" max="80" step="1" value="45" oninput="syncGravity('ang',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">&#176;</span>
      </div>
      <div class="slider-row">
        <span class="slider-label">כבידת הכוכב:</span>
        <input type="range" class="slider-gravity" id="proj-g-slider" min="1.6" max="24.8" step="0.1" value="9.8" oninput="syncGravity('g',this.value)" style="accent-color:var(--gravity)">
        <input type="number" id="proj-g-num" min="1.6" max="24.8" step="0.1" value="9.8" oninput="syncGravity('g',this.value)" style="width:70px">
        <span style="color:var(--text-dim);font-size:14px">m/s&sup2;</span>
      </div>

      <div class="btn-row">
        <span style="font-size:14px;color:var(--text-dim)">פריסטי כוכבים:</span>
        <button class="planet-btn" onclick="setPlanetG(1.6,'ירח',this)">&#127765; ירח 1.6</button>
        <button class="planet-btn" onclick="setPlanetG(3.7,'מאדים',this)">&#128308; מאדים 3.7</button>
        <button class="planet-btn selected" onclick="setPlanetG(9.8,'כדור הארץ',this)">&#127758; כדור הארץ 9.8</button>
        <button class="planet-btn" onclick="setPlanetG(24.8,'צדק',this)">&#129680; צדק 24.8</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas-proj" width="780" height="220">סימולציית תנועת קליע</canvas>
      </div>

      <div id="law-gravity-result" class="result-banner"></div>
      <div id="proj-status" style="color:var(--gravity);font-size:14px;min-height:20px"></div>

      <div class="btn-row">
        <button class="btn btn-lg" style="background:var(--gravity)" onclick="launchProjectile()">&#128640; !שיגור</button>
        <button class="btn btn-gray" onclick="resetProjectile()">אתחול</button>
        <span id="gravity-pts-msg" style="color:var(--success);font-weight:700;font-size:16px;display:none">+150 נקודות!</span>
      </div>
    </div>

    <div class="card">
      <h3>&#127756; ניסוי: כבידה בעולמות שונים</h3>
      <p>אותה זריקה בארבעה עולמות שונים! צפה כיצד הכבידה משפיעה על הטווח.</p>
      <button class="btn" style="background:var(--gravity)" onclick="launchWorlds()">&#128640; שגר בכל העולמות!</button>
      <button class="btn btn-gray" onclick="resetWorlds()">אתחול</button>
      <canvas id="canvas-worlds" width="780" height="200" style="display:block;margin:10px 0;border-radius:8px;background:#0a1628;max-width:100%">השוואת כבידה בין עולמות</canvas>
      <div style="display:flex;gap:15px;flex-wrap:wrap;font-size:13px;margin-top:5px">
        <span style="color:#C0C0C0">&#9898; ירח: 1.6 m/s&sup2;</span>
        <span style="color:#FF6B35">&#128308; מאדים: 3.7 m/s&sup2;</span>
        <span style="color:#00C9FF">&#128309; כדור הארץ: 9.8 m/s&sup2;</span>
        <span style="color:#FFB347">&#129030; צדק: 24.8 m/s&sup2;</span>
      </div>
    </div>

    <div class="card" style="border-right:5px solid var(--gravity);border-left:none">
      <h4>&#129300; האם ידעת?</h4>
      <p>&#127769; כבידת הירח = רק 1/6 מכדור הארץ! | &#128081;&#127995; גלילאו הפיל כדורים ממגדל פיזה הנטוי | &#128119;&#8205;&#128640; אסטרונאוטי אפולו יכלו לקפץ פי 6 יותר גבוה על הירח!</p>
      <div class="lesson-quiz">
        <h3>&#129504; בחן את עצמך — כבידה וקליעים</h3>
        <div id="lq-gravity"></div>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="section" id="sec-quiz">
    <div class="card card-quiz">
      <h1>&#10067; חידון: בחן את עצמך!</h1>
      <p>ענה על 7 שאלות וגלה עד כמה אתה מומחה פיזיקה! בהצלחה!</p>
    </div>
    <div id="quiz-questions"></div>
    <div id="quiz-submit-area" style="text-align:center;margin:20px 0;">
      <button class="btn btn-gold btn-lg" onclick="submitQuiz()" id="quiz-submit-btn">שלח תשובות &#127919;</button>
    </div>
    <div id="quiz-result" style="display:none" class="card card-quiz">
      <h2 id="quiz-result-heading">תוצאות החידון</h2>
      <p id="quiz-result-msg"></p>
      <div class="btn-row" style="justify-content:center;margin-top:16px">
        <button class="btn btn-gold" onclick="retakeQuiz()">נסה שוב &#128260;</button>
        <button class="btn btn-success" onclick="switchTab('home')">חזרה לבית &#127968;</button>
      </div>
    </div>
  </div>

</div>
<div id="notif">+100 נקודות!</div>

<script>
// ================================================================
//  STATE
// ================================================================
var state = {
  score: 0,
  law1done: false, law2done: false, law3done: false,
  quizDone: false, currentTab: 'home',
  slide1aKicked: false, slide1aGoal: false,
  space1bFired: false,
  fmaLaunches: 0, fmaTotalPts: 0, fmaGoal: false,
  bal3aDone: false,
  rocket3bDone: false, rocket3bGoal: false,
  quizSubmitted: false,
  energyDone: false, energyGoal: false,
  gravityDone: false, gravityGoal: false,
  rcDone: false, bbDone: false,
  projDone: false, worldsDone: false
};

// ================================================================
//  SCORE & UI
// ================================================================
function addScore(pts) {
  state.score = Math.min(1500, state.score + pts);
  updateScoreDisplay();
  showNotif('+' + pts + ' נקודות!');
  checkCompletion();
}

function updateScoreDisplay() {
  document.getElementById('score-text').textContent = 'ניקוד: ' + state.score + ' / 1200';
  var pct = (state.score / 1200) * 100;
  document.getElementById('progress-bar').style.width = Math.min(100,pct) + '%';
  var thresholds = [200, 400, 600, 800, 1000];
  var stars = 0;
  for (var i = 0; i < thresholds.length; i++) { if (state.score >= thresholds[i]) stars++; }
  var full = '\u2B50', empty = '\u2606';
  document.getElementById('stars-display').textContent = full.repeat(stars) + empty.repeat(5 - stars);
}

var notifTimer = null;
function showNotif(msg) {
  var n = document.getElementById('notif');
  n.textContent = msg;
  n.classList.add('show');
  clearTimeout(notifTimer);
  notifTimer = setTimeout(function() { n.classList.remove('show'); }, 2400);
}

function updateDot(id, done) {
  var dot = document.getElementById('dot-' + id);
  if (dot) { if (done) dot.classList.add('done'); else dot.classList.remove('done'); }
}
function markDot(id, done) { updateDot(id, done); }

function showResult(id, type, msg) {
  var el = document.getElementById(id);
  if (!el) return;
  el.className = 'result-banner show ' + type;
  el.textContent = msg;
}

function checkLaw1Done() {
  if (state.slide1aKicked && state.space1bFired && !state.law1done) {
    state.law1done = true;
    updateDot('law1', true);
    var d1 = document.getElementById('home-done-1');
    if (d1) d1.style.display = 'block';
    checkCompletion();
  }
}

function checkLaw2Done() {
  if (state.fmaLaunches >= 3 && !state.law2done) {
    state.law2done = true;
    updateDot('law2', true);
    var d2 = document.getElementById('home-done-2');
    if (d2) d2.style.display = 'block';
    checkCompletion();
  }
}

function checkLaw3Done() {
  if (state.bal3aDone && state.rocket3bDone && !state.law3done) {
    state.law3done = true;
    updateDot('law3', true);
    var d3 = document.getElementById('home-done-3');
    if (d3) d3.style.display = 'block';
    checkCompletion();
  }
}

function checkCompletion() {
  if (state.law1done && state.law2done && state.law3done && state.energyDone && state.gravityDone && state.quizDone) {
    setTimeout(function() {
      switchTab('home');
      var cs = document.getElementById('completion-screen');
      if (cs) cs.style.display = 'block';
      var s = document.getElementById('stars-display').textContent;
      document.getElementById('final-stars').textContent = s;
      document.getElementById('final-score-display').textContent = state.score + ' / 1200';
    }, 600);
  }
}

function resetGame() {
  Object.assign(state, {
    score:0, law1done:false, law2done:false, law3done:false, quizDone:false,
    currentTab:'home', slide1aKicked:false, slide1aGoal:false, space1bFired:false,
    fmaLaunches:0, fmaTotalPts:0, fmaGoal:false, bal3aDone:false,
    rocket3bDone:false, rocket3bGoal:false, quizSubmitted:false,
    energyDone:false, energyGoal:false, gravityDone:false, gravityGoal:false,
    rcDone:false, bbDone:false, projDone:false, worldsDone:false
  });
  updateScoreDisplay();
  ['law1','law2','law3','energy','gravity','quiz'].forEach(function(k) { updateDot(k, false); });
  ['home-done-1','home-done-2','home-done-3','home-done-quiz'].forEach(function(id) {
    var el = document.getElementById(id); if (el) el.style.display = 'none';
  });
  var cs = document.getElementById('completion-screen'); if (cs) cs.style.display = 'none';
  ['slide-pts-msg','space-pts-msg','fma-pts-msg','bal-pts-msg','rocket-pts-msg','energy-pts-msg','gravity-pts-msg'].forEach(function(id) {
    var el = document.getElementById(id); if (el) el.style.display = 'none';
  });
  ['law1-result','law2-result','law3-result','law-energy-result','law-gravity-result'].forEach(function(id) {
    var el = document.getElementById(id); if (el) { el.className = 'result-banner'; el.textContent = ''; }
  });
  law1V0 = 20; law1Mu = 0.05;
  syncLaw1('v0', 20); syncLaw1('mu', 0.05);
  resetSlide(); resetSpace();
  fmaForce = 80; fmaMass = 5;
  syncLaw2('f', 80); syncLaw2('m', 5);
  resetFMA();
  resetBalloon(); updateBalloon();
  law3BurnRate = 8; law3ExhaustSpeed = 400;
  syncLaw3('br', 8); syncLaw3('ex', 400);
  resetRocket();
  syncEnergy('h', 20); syncEnergy('m', 3);
  resetRollerCoaster();
  syncGravity('v0', 40); syncGravity('ang', 45); syncGravity('g', 9.8);
  resetProjectile();
  buildQuiz();
  switchTab('home');
}

// ================================================================
//  STOP ALL ANIMATION LOOPS
// ================================================================
function stopAllAnimations() {
  if (slideState) { cancelAnimationFrame(slideState.raf); slideState.running = false; }
  if (spaceState) { cancelAnimationFrame(spaceState.raf); spaceState.running = false; spaceState.thrusting = false; }
  if (fmaState)   { cancelAnimationFrame(fmaState.raf); fmaState.running = false; }
  if (balloonState) { cancelAnimationFrame(balloonState.raf); balloonState.running = false; }
  if (rocketState)  { cancelAnimationFrame(rocketState.raf); rocketState.running = false; }
  if (typeof rcRaf !== 'undefined' && rcRaf) { cancelAnimationFrame(rcRaf); rcRaf = null; }
  if (typeof bbRaf !== 'undefined' && bbRaf) { cancelAnimationFrame(bbRaf); bbRaf = null; }
  if (typeof projRaf !== 'undefined' && projRaf) { cancelAnimationFrame(projRaf); projRaf = null; }
  if (typeof worldsRaf !== 'undefined' && worldsRaf) { cancelAnimationFrame(worldsRaf); worldsRaf = null; }
  if (typeof rcState !== 'undefined') rcState.running = false;
  if (typeof bbState !== 'undefined') bbState.running = false;
  if (typeof projState !== 'undefined') projState.running = false;
  if (typeof worldsState !== 'undefined') worldsState.running = false;
}

// ================================================================
//  TAB NAVIGATION
// ================================================================
function switchTab(tab) {
  stopAllAnimations();
  state.currentTab = tab;
  document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b) {
    b.classList.toggle('active', b.dataset.tab === tab);
  });
  var secMap = { home:'sec-home', law1:'sec-law1', law2:'sec-law2', law3:'sec-law3', energy:'sec-energy', gravity:'sec-gravity', quiz:'sec-quiz' };
  var sec = document.getElementById(secMap[tab]);
  if (sec) sec.classList.add('active');
  window.scrollTo(0, 0);
  if (tab === 'law1') { setTimeout(function(){ drawSlideCanvas(); drawSpaceCanvas(); }, 50); }
  if (tab === 'law2') { setTimeout(function(){ drawFMACanvas(); }, 50); }
  if (tab === 'law3') { setTimeout(function(){ drawBalloonCanvas(); drawRocketCanvas(); }, 50); }
  if (tab === 'energy') { setTimeout(function(){ initRCCanvas(); }, 50); }
  if (tab === 'gravity') { setTimeout(function(){ drawProjectileIdle(); }, 50); }
}

document.querySelectorAll('.tab-btn').forEach(function(btn) {
  btn.addEventListener('click', function() { switchTab(btn.dataset.tab); });
});

// ================================================================
//  LAW 1 PARAMS
// ================================================================
var law1V0 = 20, law1Mu = 0.05;
var SURFACES = {
  ice:   { name:'קרח',   mu:0.005 },
  wood:  { name:'עץ',    mu:0.04  },
  grass: { name:'דשא',   mu:0.09  },
  sand:  { name:'חול',   mu:0.15  },
  custom:{ name:'מותאם', mu:0.05  }
};
var currentSurface = 'custom';

function syncLaw1(param, val) {
  val = parseFloat(val);
  if (param === 'v0') {
    law1V0 = Math.max(5, Math.min(40, val || 20));
    document.getElementById('law1-v0-slider').value = law1V0;
    document.getElementById('law1-v0-num').value = law1V0;
  } else {
    law1Mu = Math.max(0.005, Math.min(0.6, val || 0.05));
    document.getElementById('law1-mu-slider').value = law1Mu;
    document.getElementById('law1-mu-num').value = law1Mu;
  }
  updateLaw1Formula();
  drawSlideCanvas();
}

function updateLaw1Formula() {
  var d = (law1V0 * law1V0) / (2 * law1Mu * 9.8);
  document.getElementById('law1-v0-disp').textContent = law1V0;
  document.getElementById('law1-mu-disp').textContent = law1Mu.toFixed(3);
  document.getElementById('law1-dist-pred').textContent = d.toFixed(1);
  document.getElementById('slide-pred-dist').textContent = d.toFixed(0) + ' m';
}

function selectSurface(surf, btn) {
  currentSurface = surf;
  document.querySelectorAll('.surface-btn').forEach(function(b) { b.classList.remove('selected'); });
  btn.classList.add('selected');
  if (surf !== 'custom') { syncLaw1('mu', SURFACES[surf].mu); }
  resetSlide();
}

// ================================================================
//  LAW 1A — SURFACE SLIDE
// ================================================================
var slideState = { x:0, vx:0, running:false, puckR:18, startX:0, raf:null, pixPerM:0 };
var SLIDE_W = 780, SLIDE_H = 180;
var TARGET_METERS = 80;

function getSlideColor() {
  var colors = { ice:'#a8e8ff', wood:'#c8a060', grass:'#5ab040', sand:'#d4b870', custom:'#8080b0' };
  return colors[currentSurface] || '#8080b0';
}

function drawSlideCanvas() {
  var cvs = document.getElementById('canvas-slide');
  if (!cvs) return;
  var ctx = cvs.getContext('2d');
  var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);

  // Sky
  var sky = ctx.createLinearGradient(0, 0, 0, H * 0.55);
  sky.addColorStop(0, '#080818'); sky.addColorStop(1, '#101828');
  ctx.fillStyle = sky; ctx.fillRect(0, 0, W, H * 0.55);

  // Ground
  ctx.fillStyle = getSlideColor();
  ctx.fillRect(0, H * 0.55, W, H * 0.45);
  ctx.strokeStyle = 'rgba(0,0,0,0.12)'; ctx.lineWidth = 1;
  for (var xi = 0; xi < W; xi += 36) {
    ctx.beginPath(); ctx.moveTo(xi, H * 0.55); ctx.lineTo(xi, H); ctx.stroke();
  }

  // Compute pixels per meter
  var margin = 60;
  var usableW = W - margin * 2;
  var pixPerM = usableW / 200; // show up to 200 m range
  slideState.pixPerM = pixPerM;
  var originX = margin;

  // Distance markers
  ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '11px sans-serif'; ctx.textAlign = 'center';
  for (var m = 0; m <= 200; m += 20) {
    var mx = originX + m * pixPerM;
    if (mx > W - 10) break;
    ctx.fillRect(mx, H * 0.55, 1, 6);
    ctx.fillText(m+'m', mx, H * 0.55 - 4);
  }
  ctx.textAlign = 'left';

  // Target flag at 80 m
  var flagX = originX + TARGET_METERS * pixPerM;
  ctx.strokeStyle = '#FFD700'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(flagX, H * 0.55 - 4); ctx.lineTo(flagX, H * 0.55 - 40); ctx.stroke();
  ctx.fillStyle = '#FF3030';
  ctx.beginPath(); ctx.moveTo(flagX, H*0.55-40); ctx.lineTo(flagX+22, H*0.55-33); ctx.lineTo(flagX, H*0.55-26); ctx.fill();
  ctx.fillStyle = '#FFD700'; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'center';
  ctx.fillText('80m', flagX, H*0.55-44); ctx.textAlign = 'left';

  // Puck
  var px = originX + slideState.x * pixPerM;
  var py = Math.floor(H * 0.55) - slideState.puckR;
  px = Math.min(px, W - slideState.puckR - 4);

  ctx.shadowColor = 'rgba(0,201,255,0.6)'; ctx.shadowBlur = 12;
  ctx.beginPath(); ctx.arc(px, py, slideState.puckR, 0, Math.PI * 2);
  ctx.fillStyle = '#00C9FF'; ctx.fill();
  ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
  ctx.shadowBlur = 0;
  ctx.beginPath(); ctx.arc(px, py, 5, 0, Math.PI * 2);
  ctx.fillStyle = '#fff'; ctx.fill();

  // Velocity arrow
  if (slideState.vx > 0.5) {
    var arrLen = Math.min(slideState.vx * 4, 80);
    ctx.strokeStyle = '#FFD700'; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(px + slideState.puckR + 3, py); ctx.lineTo(px + slideState.puckR + arrLen, py); ctx.stroke();
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.moveTo(px + slideState.puckR + arrLen + 8, py);
    ctx.lineTo(px + slideState.puckR + arrLen, py - 6);
    ctx.lineTo(px + slideState.puckR + arrLen, py + 6);
    ctx.fill();
  }

  // Predicted stop marker (dotted)
  var predD = (law1V0 * law1V0) / (2 * law1Mu * 9.8);
  var predX = originX + predD * pixPerM;
  if (predX < W - 10) {
    ctx.strokeStyle = 'rgba(255,215,0,0.5)'; ctx.lineWidth = 1.5; ctx.setLineDash([4,4]);
    ctx.beginPath(); ctx.moveTo(predX, H*0.55-4); ctx.lineTo(predX, H*0.3); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(255,215,0,0.7)'; ctx.font = '11px sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('pred ' + predD.toFixed(0)+'m', predX, H*0.3-2); ctx.textAlign = 'left';
  }

  // Mu info
  ctx.fillStyle = 'rgba(0,0,0,0.55)'; ctx.fillRect(W-170, H*0.56, 162, 24);
  ctx.fillStyle = '#fff'; ctx.font = 'bold 12px sans-serif'; ctx.textAlign = 'right';
  ctx.fillText('v\u2080=' + law1V0 + 'm/s  \u03bc=' + law1Mu.toFixed(3), W-10, H*0.56+17);
  ctx.textAlign = 'left';
}

function kickPuck() {
  if (slideState.running) return;
  cancelAnimationFrame(slideState.raf);
  slideState.x = 0;
  slideState.vx = law1V0; // meters/s, we'll scale in animation
  slideState.running = true;
  var el = document.getElementById('law1-result');
  if (el) { el.className = 'result-banner'; el.textContent = ''; }
  document.getElementById('slide-distance').textContent = '-- m';
  document.getElementById('slide-speed').textContent = '0 m/s';
  animateSlide();
}

function animateSlide() {
  var cvs = document.getElementById('canvas-slide');
  if (!cvs || !slideState.running) { slideState.running = false; return; }
  var decel = law1Mu * 9.8; // m/s^2
  var dt = 1/60;
  slideState.vx = Math.max(0, slideState.vx - decel * dt);
  slideState.x += slideState.vx * dt; // x is in meters now

  var ppm = slideState.pixPerM || 3.3;
  var dist = slideState.x; // meters

  document.getElementById('slide-speed').textContent = slideState.vx.toFixed(1) + ' m/s';
  document.getElementById('slide-distance').textContent = dist.toFixed(1) + ' m';

  drawSlideCanvas();

  // Check if off canvas
  var originX = 60;
  var pxPos = originX + dist * ppm;

  if (slideState.running && slideState.vx > 0.02 && pxPos < cvs.width - slideState.puckR - 4) {
    slideState.raf = requestAnimationFrame(animateSlide);
  } else {
    slideState.running = false;
    slideState.vx = 0;
    drawSlideCanvas();
    var finalDist = slideState.x;
    document.getElementById('slide-distance').textContent = finalDist.toFixed(1) + ' m';

    var diff = Math.abs(finalDist - TARGET_METERS);
    if (!state.slide1aGoal && diff <= 5) {
      state.slide1aGoal = true;
      showResult('law1-result', 'success',
        '\uD83C\uDF89 פגיעה מושלמת! הדיסק החליק בדיוק אל הדגל! האינרציה שמרה עליו בתנועה והחיכוך עצר אותו על המטרה. +150 נקודות');
      addScore(150);
      document.getElementById('slide-pts-msg').textContent = '+150 נקודות!';
      document.getElementById('slide-pts-msg').style.display = 'inline';
    } else if (!state.slide1aGoal) {
      if (finalDist < TARGET_METERS - 5) {
        showResult('law1-result', 'fail', '\uD83D\uDCA8 איטי מדי — נסה v\u2080 גדול יותר או \u03bc קטן יותר!');
      } else {
        showResult('law1-result', 'fail', '\uD83D\uDE80 חרגת! נסה v\u2080 קטן יותר או \u03bc גדול יותר.');
      }
    }

    if (!state.slide1aKicked) {
      state.slide1aKicked = true;
      if (!state.slide1aGoal) addScore(50);
      checkLaw1Done();
    }
  }
}

function resetSlide() {
  cancelAnimationFrame(slideState.raf);
  slideState.x = 0; slideState.vx = 0; slideState.running = false;
  document.getElementById('slide-speed').textContent = '0 m/s';
  document.getElementById('slide-distance').textContent = '-- m';
  var el = document.getElementById('law1-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  drawSlideCanvas();
}

// ================================================================
//  LAW 1B — SPACE DRIFT
// ================================================================
var spaceState = { x:80, y:100, vx:0, thrusting:false, atmosphere:false, running:false, distance:0, raf:null, particles:[], frameCount:0 };

function toggleAtmosphere() {
  spaceState.atmosphere = document.getElementById('atmos-toggle').checked;
  var label = document.getElementById('atmos-label');
  var status = document.getElementById('space-atmos-status');
  if (spaceState.atmosphere) {
    label.textContent = '\uD83C\uDF0D עם אטמוספרה (האוויר מאט אותך)';
    label.style.color = '#4CAF50'; status.textContent = 'פועל'; status.style.color = '#4CAF50';
  } else {
    label.textContent = '\uD83C\uDF0C מצב חלל (ללא התנגדות אוויר)';
    label.style.color = '#888'; status.textContent = 'כבוי'; status.style.color = '#888';
  }
  drawSpaceCanvas();
}

function startThrust() { spaceState.thrusting = true; if (!spaceState.running) { spaceState.running = true; spaceState.frameCount = 0; animateSpace(); } }
function stopThrust() { spaceState.thrusting = false; }

var STAR_POS = [];
(function() {
  var seed = [13,47,71,103,157,211,263,311,367,421,479,523,577,631,683,739,797,853,907,967];
  seed.forEach(function(s, i) { STAR_POS.push({ x:(s*53+i*137)%780, y:(s*31+i*97)%200, r:(i%3)*0.5+0.7 }); });
})();

function drawSpaceCanvas() {
  var cvs = document.getElementById('canvas-space'); if (!cvs) return;
  var ctx = cvs.getContext('2d'); var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);
  if (spaceState.atmosphere) { var sg=ctx.createLinearGradient(0,0,0,H); sg.addColorStop(0,'#001535'); sg.addColorStop(1,'#003060'); ctx.fillStyle=sg; }
  else { ctx.fillStyle='#000510'; }
  ctx.fillRect(0, 0, W, H);
  ctx.fillStyle='rgba(255,255,255,0.75)';
  STAR_POS.forEach(function(st){ ctx.beginPath(); ctx.arc(st.x,st.y,st.r,0,Math.PI*2); ctx.fill(); });
  if (spaceState.atmosphere) {
    ctx.fillStyle='rgba(100,200,255,0.4)'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center';
    ctx.fillText('אטמוספרה פעילה — התנגדות אוויר מאטה את הרקטה', W/2, 20); ctx.textAlign='left';
  } else {
    ctx.fillStyle='rgba(0,201,255,0.4)'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center';
    ctx.fillText('ואקום חלל — אפס גרר! הרקטה מחליקה לנצח.', W/2, 20); ctx.textAlign='left';
  }
  spaceState.particles.forEach(function(p){ ctx.globalAlpha=p.life; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.color; ctx.fill(); }); ctx.globalAlpha=1;
  var rx=spaceState.x, ry=spaceState.y;
  ctx.fillStyle='#ccccdd'; ctx.fillRect(rx-12,ry-20,24,38);
  ctx.fillStyle='#ddddef'; ctx.beginPath(); ctx.moveTo(rx,ry-36); ctx.lineTo(rx-12,ry-20); ctx.lineTo(rx+12,ry-20); ctx.closePath(); ctx.fill();
  ctx.fillStyle='#00C9FF'; ctx.beginPath(); ctx.arc(rx,ry-6,6,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#fff'; ctx.lineWidth=1.5; ctx.stroke();
  ctx.fillStyle='#FF6B35';
  ctx.beginPath(); ctx.moveTo(rx-12,ry+12); ctx.lineTo(rx-22,ry+26); ctx.lineTo(rx-12,ry+18); ctx.fill();
  ctx.beginPath(); ctx.moveTo(rx+12,ry+12); ctx.lineTo(rx+22,ry+26); ctx.lineTo(rx+12,ry+18); ctx.fill();
  if (spaceState.thrusting) {
    ctx.fillStyle='#FF6B35'; ctx.beginPath(); ctx.moveTo(rx-8,ry+18); ctx.lineTo(rx,ry+34+Math.random()*12); ctx.lineTo(rx+8,ry+18); ctx.closePath(); ctx.fill();
    ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.moveTo(rx-4,ry+18); ctx.lineTo(rx,ry+25+Math.random()*8); ctx.lineTo(rx+4,ry+18); ctx.closePath(); ctx.fill();
  }
  if (spaceState.vx > 0.4) {
    var alen=Math.min(spaceState.vx*5,90);
    ctx.strokeStyle='#FFD700'; ctx.lineWidth=2.5;
    ctx.beginPath(); ctx.moveTo(rx+22,ry); ctx.lineTo(rx+22+alen,ry); ctx.stroke();
    ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.moveTo(rx+22+alen+8,ry); ctx.lineTo(rx+22+alen,ry-5); ctx.lineTo(rx+22+alen,ry+5); ctx.fill();
  }
}

function animateSpace() {
  var cvs = document.getElementById('canvas-space'); if (!cvs || !spaceState.running) { spaceState.running=false; return; }
  var W = cvs.width;
  if (spaceState.thrusting) {
    spaceState.vx = Math.min(spaceState.vx+0.38, 16);
    for (var i=0;i<3;i++) { spaceState.particles.push({x:spaceState.x,y:spaceState.y+20+Math.random()*8,vx:-(Math.random()*2+1),vy:(Math.random()-0.5)*0.8,r:Math.random()*4+1,life:1,color:['#FF6B35','#FFD700','#ff9900'][Math.floor(Math.random()*3)]}); }
  }
  if (spaceState.atmosphere) spaceState.vx = Math.max(0, spaceState.vx-0.16);
  spaceState.x += spaceState.vx*0.5; spaceState.distance += spaceState.vx*0.5; spaceState.frameCount++;
  if (spaceState.x > W+40) spaceState.x = -40;
  spaceState.particles = spaceState.particles.filter(function(p){return p.life>0;}).map(function(p){return{x:p.x+p.vx,y:p.y+p.vy,vx:p.vx,vy:p.vy,r:p.r,life:p.life-0.04,color:p.color};});
  document.getElementById('space-speed').textContent = (spaceState.vx*0.6).toFixed(1)+' m/s';
  document.getElementById('space-distance').textContent = Math.round(spaceState.distance*0.5)+' m';
  drawSpaceCanvas();
  if (!state.space1bFired && spaceState.distance>60) {
    state.space1bFired=true; addScore(50); document.getElementById('space-pts-msg').style.display='inline'; checkLaw1Done();
  }
  var shouldStop=(spaceState.atmosphere && !spaceState.thrusting && spaceState.vx<0.05)||(spaceState.frameCount>3600);
  if (spaceState.running && !shouldStop) { spaceState.raf=requestAnimationFrame(animateSpace); }
  else { spaceState.running=false; drawSpaceCanvas(); }
}

function resetSpace() {
  cancelAnimationFrame(spaceState.raf);
  Object.assign(spaceState, {x:80,y:100,vx:0,thrusting:false,running:false,distance:0,particles:[],frameCount:0});
  document.getElementById('space-speed').textContent='0 m/s';
  document.getElementById('space-distance').textContent='0 m';
  drawSpaceCanvas();
}

// ================================================================
//  LAW 2 — F=ma
// ================================================================
var fmaState = { objects:[], running:false, raf:null, currentObjName:'מותאם' };
var fmaForce = 80, fmaMass = 5;
var TOWER_METERS = 60; // target at 60 m

function syncLaw2(param, val) {
  val = parseFloat(val);
  if (param === 'f') {
    fmaForce = Math.max(10, Math.min(200, val || 80));
    document.getElementById('force-slider').value = fmaForce;
    document.getElementById('force-num').value = fmaForce;
  } else {
    fmaMass = Math.max(1, Math.min(20, val || 5));
    document.getElementById('mass-slider').value = fmaMass;
    document.getElementById('mass-num').value = fmaMass;
  }
  updateFMA();
}

function updateFMA() {
  fmaForce = parseFloat(document.getElementById('force-slider').value);
  fmaMass  = parseFloat(document.getElementById('mass-slider').value);
  var acc = (fmaForce / fmaMass).toFixed(1);
  document.getElementById('force-num').value = fmaForce;
  document.getElementById('mass-num').value = fmaMass;
  document.getElementById('law2-f-disp').textContent = fmaForce;
  document.getElementById('law2-m-disp').textContent = fmaMass;
  document.getElementById('law2-a-disp').textContent = acc;
  document.getElementById('fma-f').textContent = fmaForce + ' N';
  document.getElementById('fma-m').textContent = fmaMass + ' kg';
  document.getElementById('fma-a').textContent = acc + ' m/s\u00B2';
}

function setPreset(mass, name) {
  fmaMass = mass;
  document.getElementById('mass-slider').value = Math.min(20, Math.max(1, mass));
  document.getElementById('mass-num').value = mass;
  document.getElementById('fma-obj').textContent = name;
  fmaState.currentObjName = name;
  updateFMA();
}

function drawFMACanvas() {
  var cvs = document.getElementById('canvas-fma'); if (!cvs) return;
  var ctx = cvs.getContext('2d'); var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#080818'; ctx.fillRect(0, 0, W, H);
  ctx.strokeStyle = '#334455'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(0, H-30); ctx.lineTo(W, H-30); ctx.stroke();

  // Scale: canvas W px = 120 m
  var ppm = (W - 60) / 120;
  var originX = 40;

  // Distance markers
  ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.font = '10px sans-serif'; ctx.textAlign = 'center';
  for (var mi = 0; mi <= 120; mi += 20) {
    var mx = originX + mi * ppm;
    ctx.fillRect(mx, H-30, 1, 5);
    ctx.fillText(mi+'m', mx, H-17);
  }
  ctx.textAlign = 'left';

  // Tower at 60 m
  var towerX = originX + TOWER_METERS * ppm;
  var blockW = 18, blockH = 14;
  var numBlocks = 5;
  for (var bi = 0; bi < numBlocks; bi++) {
    var by = H - 30 - (bi+1)*blockH;
    var bcolor = ['#8B4513','#A0522D','#CD853F','#DEB887','#F4A460'][bi] || '#CD853F';
    ctx.fillStyle = bcolor;
    ctx.fillRect(towerX - blockW/2, by, blockW, blockH);
    ctx.strokeStyle = 'rgba(0,0,0,0.5)'; ctx.lineWidth = 1;
    ctx.strokeRect(towerX - blockW/2, by, blockW, blockH);
  }
  ctx.fillStyle = '#FFD700'; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'center';
  ctx.fillText('מגדל', towerX, H-30-numBlocks*blockH-6); ctx.textAlign = 'left';

  // Objects
  fmaState.objects.forEach(function(obj) {
    var r  = Math.max(10, Math.min(34, 8 + obj.mass * 1.4));
    var cx = originX + obj.xMeters * ppm;
    var cy = H - 30 - r;
    ctx.shadowColor = obj.color + '80'; ctx.shadowBlur = 12;
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2);
    ctx.fillStyle = obj.color; ctx.fill();
    ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
    ctx.shadowBlur = 0;
    if (obj.label) {
      ctx.fillStyle = '#fff'; ctx.font = 'bold ' + Math.max(12, r*0.75) + 'px sans-serif'; ctx.textAlign = 'center';
      ctx.fillText(obj.label, cx, cy + r*0.35); ctx.textAlign = 'left';
    }
    ctx.fillStyle = obj.color; ctx.font = '12px sans-serif'; ctx.textAlign = 'center';
    ctx.fillText(obj.vx.toFixed(1)+' m/s', cx, cy - r - 5); ctx.textAlign = 'left';

    // Topple if hit
    if (obj.hitTower) {
      for (var bi2 = 0; bi2 < numBlocks; bi2++) {
        ctx.save();
        ctx.translate(towerX + obj.toppleT * 20 * (bi2+1) * 0.3, H-30-(bi2+0.5)*blockH);
        ctx.rotate(obj.toppleT * 0.8);
        ctx.fillStyle = ['#8B4513','#A0522D','#CD853F','#DEB887','#F4A460'][bi2] || '#CD853F';
        ctx.fillRect(-blockW/2, -blockH/2, blockW, blockH);
        ctx.restore();
      }
    }
  });
}

function launchFMA() {
  if (fmaState.running) return;
  cancelAnimationFrame(fmaState.raf);
  var acc = fmaForce / fmaMass;
  fmaState.objects = [{ xMeters:0, mass:fmaMass, vx:0, acc:acc, color:'#FF6B35', label:'', hitTower:false, toppleT:0 }];
  fmaState.running = true;
  state.fmaLaunches++;
  var el = document.getElementById('law2-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  animateFMA(false);
}

function raceMode() {
  if (fmaState.running) return;
  var force = fmaForce;
  var presets = [
    { mass:0.45, label:'כדור', color:'#00C9FF' },
    { mass:5,    label:'קופסה', color:'#FF6B35' },
    { mass:20,   label:'סלע', color:'#7B2FBE' }
  ];
  fmaState.objects = presets.map(function(p) {
    return { xMeters:0, mass:p.mass, vx:0, acc:force/p.mass, color:p.color, label:p.label, hitTower:false, toppleT:0 };
  });
  fmaState.running = true;
  if (state.fmaLaunches < 3) state.fmaLaunches = 3;
  var el = document.getElementById('law2-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  animateFMA(true);
}

function animateFMA(isRace) {
  var cvs = document.getElementById('canvas-fma'); if (!cvs || !fmaState.running) { fmaState.running=false; return; }
  var allDone = true; var dt = 1/60;
  var goalHit = false, goalMiss = false, goalDist = 0;

  fmaState.objects = fmaState.objects.map(function(obj) {
    if (obj.xMeters < 125 && !obj.hitTower) {
      allDone = false;
      obj.vx += obj.acc * dt;
      obj.xMeters += obj.vx * dt;
      // Check tower hit
      if (Math.abs(obj.xMeters - TOWER_METERS) <= 2) {
        obj.hitTower = true; obj.toppleT = 0;
        goalDist = obj.xMeters;
        goalHit = true;
      }
    } else if (obj.hitTower) {
      obj.toppleT = Math.min(obj.toppleT + 0.04, 1);
      if (obj.toppleT < 1) allDone = false;
    }
    return obj;
  });

  drawFMACanvas();

  if (!allDone && fmaState.running) {
    fmaState.raf = requestAnimationFrame(function() { animateFMA(isRace); });
  } else {
    fmaState.running = false;

    // Check goal for single ball
    if (!isRace) {
      var obj = fmaState.objects[0];
      var dist = obj ? obj.xMeters : 0;
      if (!state.fmaGoal) {
        if (obj && obj.hitTower) {
          state.fmaGoal = true;
          showResult('law2-result', 'success', '\uD83D\uDCA5 בום! כדור התותח הפיל את המגדל! +150 נקודות');
          addScore(150);
        } else if (dist < TOWER_METERS - 2) {
          showResult('law2-result', 'fail', '\uD83D\uDE22 לא הגיע — הגדל את F או הקטן את m.');
        } else {
          showResult('law2-result', 'fail', '\uD83D\uDCA8 עף מעבר! הפחת F או הוסף מסה.');
        }
      }
    }

    if (!state.law2done) {
      var msg = document.getElementById('fma-pts-msg');
      msg.style.display = 'inline';
      msg.textContent = state.fmaLaunches >= 3 ? 'מעולה! 3+ ניסויים הושלמו!' : state.fmaLaunches + '/3 ניסויים';
      if (state.fmaTotalPts < 150) {
        var pts = Math.min(50, 150 - state.fmaTotalPts);
        state.fmaTotalPts += pts;
        if (!state.fmaGoal) addScore(pts);
      }
      checkLaw2Done();
    }
  }
}

function resetFMA() {
  cancelAnimationFrame(fmaState.raf);
  fmaState.objects = []; fmaState.running = false; fmaState.currentObjName = 'מותאם';
  document.getElementById('fma-obj').textContent = 'מותאם';
  var el = document.getElementById('law2-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  drawFMACanvas();
}

// ================================================================
//  LAW 3A — BALLOON ROCKET
// ================================================================
var balloonState = { x:80, running:false, raf:null, vx:0, inflation:60, particles:[] };

function updateBalloon() {
  balloonState.inflation = parseInt(document.getElementById('balloon-slider').value);
  document.getElementById('balloon-val').textContent  = balloonState.inflation + '%';
  document.getElementById('bal-inflation').textContent = balloonState.inflation + '%';
  document.getElementById('bal-force').textContent     = balloonState.inflation + ' N';
  drawBalloonCanvas();
}

function drawBalloonCanvas() {
  var cvs = document.getElementById('canvas-balloon'); if (!cvs) return;
  var ctx = cvs.getContext('2d'); var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#080828'; ctx.fillRect(0, 0, W, H);
  ctx.strokeStyle = '#445'; ctx.lineWidth = 3; ctx.setLineDash([8,4]);
  ctx.beginPath(); ctx.moveTo(20, H/2); ctx.lineTo(W-20, H/2); ctx.stroke(); ctx.setLineDash([]);
  balloonState.particles.forEach(function(p) {
    ctx.globalAlpha=p.life; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle='#99ccff'; ctx.fill(); ctx.globalAlpha=1;
  });
  var bx=balloonState.x, by=H/2, inf=balloonState.inflation;
  var bw=18+inf*0.48, bh=14+inf*0.38;
  ctx.shadowColor='rgba(123,47,190,0.7)'; ctx.shadowBlur=16; ctx.fillStyle='#7B2FBE';
  ctx.beginPath(); ctx.ellipse(bx,by,bw,bh,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='rgba(255,255,255,0.18)';
  ctx.beginPath(); ctx.ellipse(bx-bw*0.22,by-bh*0.28,bw*0.33,bh*0.28,-0.4,0,Math.PI*2); ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle='#5a1a8e'; ctx.beginPath(); ctx.arc(bx+bw,by,5,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#aaa'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(bx+bw+5,by); ctx.lineTo(bx+bw+14,by+18); ctx.stroke();
  if (balloonState.running) {
    var ax=bx+bw+4, alen=60;
    ctx.strokeStyle='#ff4444'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(ax,by-28); ctx.lineTo(ax-alen,by-28); ctx.stroke();
    ctx.fillStyle='#ff4444';
    ctx.beginPath(); ctx.moveTo(ax-alen-8,by-28); ctx.lineTo(ax-alen,by-34); ctx.lineTo(ax-alen,by-22); ctx.fill();
    ctx.font='bold 12px sans-serif'; ctx.textAlign='center';
    ctx.fillText('פעולה: אוויר יוצא שמאלה',ax-alen/2,by-36);
    ctx.strokeStyle='#44ff88'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(bx,by+28); ctx.lineTo(bx+alen,by+28); ctx.stroke();
    ctx.fillStyle='#44ff88';
    ctx.beginPath(); ctx.moveTo(bx+alen+8,by+28); ctx.lineTo(bx+alen,by+22); ctx.lineTo(bx+alen,by+34); ctx.fill();
    ctx.fillText('תגובה: בלון עף ימינה',bx+alen/2,by+44); ctx.textAlign='left';
  }
}

function releaseBalloon() {
  if (balloonState.running) return;
  balloonState.x=80; balloonState.vx=balloonState.inflation*0.09+0.8; balloonState.running=true; balloonState.particles=[];
  animateBalloon();
}

function animateBalloon() {
  var cvs = document.getElementById('canvas-balloon'); if (!cvs || !balloonState.running) { balloonState.running=false; return; }
  var W=cvs.width, bw=18+balloonState.inflation*0.48;
  balloonState.vx=Math.max(0,balloonState.vx-0.018); balloonState.x+=balloonState.vx;
  if (balloonState.vx>0.3) {
    for (var i=0;i<3;i++) { balloonState.particles.push({x:balloonState.x+bw,y:cvs.height/2+(Math.random()-0.5)*18,vx:-(balloonState.vx*1.4+Math.random()*2),vy:(Math.random()-0.5)*0.5,r:Math.random()*3+1,life:1}); }
  }
  balloonState.particles=balloonState.particles.filter(function(p){return p.life>0;}).map(function(p){return{x:p.x+p.vx,y:p.y+p.vy,vx:p.vx,vy:p.vy,r:p.r,life:p.life-0.024};});
  var pixPerM=(W-80)/5, dist=(balloonState.x-80)/pixPerM;
  document.getElementById('bal-distance').textContent=dist.toFixed(1)+' m';
  drawBalloonCanvas();
  if (balloonState.running && balloonState.x<W-bw-20 && balloonState.vx>0.04) {
    balloonState.raf=requestAnimationFrame(animateBalloon);
  } else {
    balloonState.running=false;
    if (!state.bal3aDone) { state.bal3aDone=true; addScore(100); document.getElementById('bal-pts-msg').style.display='inline'; checkLaw3Done(); }
  }
}

function resetBalloon() {
  cancelAnimationFrame(balloonState.raf); balloonState.x=80; balloonState.vx=0; balloonState.running=false; balloonState.particles=[];
  document.getElementById('bal-distance').textContent='-- m'; drawBalloonCanvas();
}

// ================================================================
//  LAW 3B — ROCKET LAUNCH (with burnRate + exhaustSpeed)
// ================================================================
var law3BurnRate = 8, law3ExhaustSpeed = 400;
var rocketState = { y:262, vy:0, running:false, raf:null, exhaustParticles:[], fuelMass:0, dryMass:50, maxAlt:0 };
var ORBIT_ALT = 500; // meters

function syncLaw3(param, val) {
  val = parseFloat(val);
  if (param === 'br') {
    law3BurnRate = Math.max(1, Math.min(20, val || 8));
    document.getElementById('burn-rate-slider').value = law3BurnRate;
    document.getElementById('burn-rate-num').value = law3BurnRate;
  } else {
    law3ExhaustSpeed = Math.max(100, Math.min(1000, val || 400));
    document.getElementById('exhaust-speed-slider').value = law3ExhaustSpeed;
    document.getElementById('exhaust-speed-num').value = law3ExhaustSpeed;
  }
  updateLaw3Formula();
  drawRocketCanvas();
}

function updateLaw3Formula() {
  var thrust = law3BurnRate * law3ExhaustSpeed;
  var fuelMass = law3BurnRate * 20;
  var totalMass = rocketState.dryMass + fuelMass;
  var weight = totalMass * 9.8;
  var netUp = thrust - weight;
  document.getElementById('law3-br-disp').textContent = law3BurnRate;
  document.getElementById('law3-ex-disp').textContent = law3ExhaustSpeed;
  document.getElementById('law3-thrust-disp').textContent = thrust.toFixed(0);
  document.getElementById('law3-weight-disp').textContent = '~' + weight.toFixed(0);
  document.getElementById('law3-net-disp').textContent = (netUp > 0 ? '~+' : '~') + netUp.toFixed(0);
  document.getElementById('rocket-thrust').textContent = thrust.toFixed(0) + ' N';
}

function drawRocketCanvas() {
  var cvs = document.getElementById('canvas-rocket'); if (!cvs) return;
  var ctx = cvs.getContext('2d'); var W = cvs.width, H = cvs.height;
  ctx.clearRect(0, 0, W, H);
  var grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'#000010'); grad.addColorStop(0.65,'#0a0a30'); grad.addColorStop(1,'#1a2a10');
  ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);
  var RSTARS=[17,41,79,113,151,197,239,281,317,359,401];
  ctx.fillStyle='rgba(255,255,255,0.85)';
  RSTARS.forEach(function(s,i){var sx=(s*29+i*53)%W,sy=(s*37+i*71)%(H*0.75);ctx.beginPath();ctx.arc(sx,sy,1.1,0,Math.PI*2);ctx.fill();});
  ctx.fillStyle='#1a3010'; ctx.fillRect(0,H-18,W,18);
  ctx.fillStyle='#253515'; ctx.fillRect(0,H-20,W,4);

  // Orbit line at ORBIT_ALT
  var groundY = H - 38;
  var totalCanvasH = groundY;
  var metersPerPx = 600 / totalCanvasH; // 600m total shown
  var orbitY = groundY - ORBIT_ALT / metersPerPx;
  ctx.strokeStyle='rgba(0,201,255,0.4)'; ctx.lineWidth=1.5; ctx.setLineDash([5,7]);
  ctx.beginPath(); ctx.moveTo(0,orbitY); ctx.lineTo(W,orbitY); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle='rgba(0,201,255,0.7)'; ctx.font='bold 11px sans-serif'; ctx.textAlign='right';
  ctx.fillText('מסלול 500m', W-6, orbitY-3); ctx.textAlign='left';

  // Altitude rulers
  ctx.strokeStyle='rgba(123,47,190,0.25)'; ctx.lineWidth=1; ctx.setLineDash([4,6]);
  for (var alt=100; alt<=600; alt+=100) {
    var ay = groundY - alt/metersPerPx;
    if (ay < 0) break;
    ctx.beginPath(); ctx.moveTo(0,ay); ctx.lineTo(W,ay); ctx.stroke();
    ctx.fillStyle='rgba(255,255,255,0.25)'; ctx.font='10px sans-serif';
    ctx.fillText(alt+'m', 4, ay-2);
  }
  ctx.setLineDash([]);

  rocketState.exhaustParticles.forEach(function(p){
    ctx.globalAlpha=p.life*0.8; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.color; ctx.fill();
  }); ctx.globalAlpha=1;

  var rx=W/2, ry=rocketState.y;
  var altPx = Math.max(0, groundY - ry);
  var altM = altPx * metersPerPx;
  var altPct = Math.min(100, (altM / ORBIT_ALT) * 100);

  if (rocketState.running && ry < groundY && rocketState.fuelMass > 0) {
    var fLen=18+20;
    ctx.fillStyle='#FF6B35'; ctx.beginPath(); ctx.moveTo(rx-10,ry+22); ctx.lineTo(rx,ry+22+fLen+Math.random()*14); ctx.lineTo(rx+10,ry+22); ctx.closePath(); ctx.fill();
    ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.moveTo(rx-5,ry+22); ctx.lineTo(rx,ry+22+fLen*0.6+Math.random()*8); ctx.lineTo(rx+5,ry+22); ctx.closePath(); ctx.fill();
    ctx.fillStyle='rgba(255,100,70,0.85)'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
    ctx.fillText('פעולה: גזים למטה',rx,ry+22+fLen+18);
  }
  ctx.fillStyle='#ccccdd'; ctx.fillRect(rx-13,ry-20,26,42);
  ctx.fillStyle='#ddddef'; ctx.beginPath(); ctx.moveTo(rx,ry-40); ctx.lineTo(rx-13,ry-20); ctx.lineTo(rx+13,ry-20); ctx.closePath(); ctx.fill();
  ctx.fillStyle='#FF6B35'; ctx.beginPath(); ctx.arc(rx,ry-40,5,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='#7B2FBE'; ctx.beginPath(); ctx.arc(rx,ry-6,7,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#fff'; ctx.lineWidth=1.5; ctx.stroke();
  ctx.fillStyle='#FF6B35'; ctx.fillRect(rx-13,ry+4,26,5);
  ctx.beginPath(); ctx.moveTo(rx-13,ry+8); ctx.lineTo(rx-23,ry+28); ctx.lineTo(rx-13,ry+22); ctx.fill();
  ctx.beginPath(); ctx.moveTo(rx+13,ry+8); ctx.lineTo(rx+23,ry+28); ctx.lineTo(rx+13,ry+22); ctx.fill();

  if (rocketState.running && ry < groundY && rocketState.fuelMass > 0) {
    ctx.strokeStyle='#44ff88'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(rx+36,ry); ctx.lineTo(rx+36,ry-46); ctx.stroke();
    ctx.fillStyle='#44ff88';
    ctx.beginPath(); ctx.moveTo(rx+36,ry-54); ctx.lineTo(rx+30,ry-46); ctx.lineTo(rx+42,ry-46); ctx.fill();
    ctx.font='bold 10px sans-serif'; ctx.textAlign='left';
    ctx.fillText('תגובה',rx+42,ry-36); ctx.fillText('רקטה למעלה',rx+42,ry-23);
  }
  ctx.textAlign='left';

  document.getElementById('altitude-bar').style.height = altPct + '%';
  document.getElementById('altitude-text').textContent = Math.round(altM) + ' m';
  document.getElementById('rocket-altitude').textContent = Math.round(altM) + ' m';
}

function launchRocket() {
  if (rocketState.running) return;
  var cvs = document.getElementById('canvas-rocket');
  var groundY = cvs ? cvs.height - 38 : 262;
  rocketState.y = groundY; rocketState.vy = 0; rocketState.running = true;
  rocketState.exhaustParticles = []; rocketState.maxAlt = 0;
  rocketState.fuelMass = law3BurnRate * 20; // seconds of fuel * kg/s
  rocketState.dryMass = 50;
  var el = document.getElementById('law3-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  animateRocket();
}

function animateRocket() {
  var cvs = document.getElementById('canvas-rocket'); if (!cvs || !rocketState.running) { rocketState.running=false; return; }
  var H = cvs.height, groundY = H - 38;
  var dt = 1/60;
  var thrust = law3BurnRate * law3ExhaustSpeed;
  var totalMass = rocketState.dryMass + rocketState.fuelMass;
  var hasFuel = rocketState.fuelMass > 0;
  if (hasFuel) rocketState.fuelMass = Math.max(0, rocketState.fuelMass - law3BurnRate * dt);
  var thrustAcc = hasFuel ? thrust / totalMass : 0;
  var gravAcc = 9.8;
  var netAcc = thrustAcc - gravAcc; // m/s^2
  var metersPerPx = 600 / (groundY);
  var pixNetAcc = netAcc / metersPerPx; // px/s^2
  rocketState.vy -= pixNetAcc * dt * 60; // scale for animation
  rocketState.vy = Math.max(rocketState.vy, -12);
  rocketState.y += rocketState.vy;
  if (rocketState.y < 18) { rocketState.y = 18; rocketState.vy = 0; }

  var altPx = Math.max(0, groundY - rocketState.y);
  var altM = altPx * metersPerPx;
  if (altM > rocketState.maxAlt) rocketState.maxAlt = altM;

  if (hasFuel && rocketState.vy < 0) {
    for (var i=0;i<4;i++) {
      rocketState.exhaustParticles.push({x:cvs.width/2+(Math.random()-0.5)*14,y:rocketState.y+24+Math.random()*8,vx:(Math.random()-0.5)*1.4,vy:Math.random()*3+0.8,r:Math.random()*4+2,life:1,color:['#FF6B35','#FFD700','#ff3300'][Math.floor(Math.random()*3)]});
    }
  }
  rocketState.exhaustParticles=rocketState.exhaustParticles.filter(function(p){return p.life>0;}).map(function(p){return{x:p.x+p.vx,y:p.y+p.vy,vx:p.vx,vy:p.vy,r:p.r,life:p.life-0.03,color:p.color};});
  document.getElementById('rocket-speed').textContent = Math.abs(rocketState.vy*metersPerPx*60*dt).toFixed(1)+' m/s';
  drawRocketCanvas();

  if (rocketState.y >= groundY) {
    rocketState.running=false; rocketState.y=groundY; rocketState.vy=0;
    drawRocketCanvas();
    if (!state.rocket3bDone) {
      state.rocket3bDone = true;
      if (!state.rocket3bGoal && rocketState.maxAlt >= ORBIT_ALT) {
        state.rocket3bGoal = true;
        showResult('law3-result','success','\uD83D\uDE80 המראה! הרקטה הגיעה למסלול! +150 נקודות');
        addScore(150);
        document.getElementById('rocket-pts-msg').textContent='+150 נקודות!';
        document.getElementById('rocket-pts-msg').style.display='inline';
      } else {
        showResult('law3-result','fail','\uD83D\uDCA5 הכבידה ניצחה — הגדל קצב שריפה או מהירות פליטה כך ש-Thrust > משקל! גובה מרבי: '+Math.round(rocketState.maxAlt)+' m (צריך 500m)');
        addScore(50);
        document.getElementById('rocket-pts-msg').textContent='+50 נקודות!';
        document.getElementById('rocket-pts-msg').style.display='inline';
      }
      checkLaw3Done();
    }
    return;
  }
  if (rocketState.running) rocketState.raf=requestAnimationFrame(animateRocket);
}

function resetRocket() {
  cancelAnimationFrame(rocketState.raf);
  var cvs = document.getElementById('canvas-rocket');
  rocketState.y = cvs ? cvs.height-38 : 262;
  rocketState.vy=0; rocketState.running=false; rocketState.exhaustParticles=[]; rocketState.fuelMass=0; rocketState.maxAlt=0;
  document.getElementById('altitude-bar').style.height='0%';
  document.getElementById('altitude-text').textContent='0 m';
  document.getElementById('rocket-altitude').textContent='0 m';
  document.getElementById('rocket-speed').textContent='0 m/s';
  var el = document.getElementById('law3-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  drawRocketCanvas();
}

// ================================================================
//  ENERGY — params
// ================================================================
var energyH = 20, energyM = 3;

function syncEnergy(param, val) {
  val = parseFloat(val);
  if (param === 'h') {
    energyH = Math.max(5, Math.min(30, val || 20));
    document.getElementById('rc-height-slider').value = energyH;
    document.getElementById('rc-height-num').value = energyH;
  } else {
    energyM = Math.max(1, Math.min(10, val || 3));
    document.getElementById('rc-mass-slider').value = energyM;
    document.getElementById('rc-mass-num').value = energyM;
  }
  updateEnergyFormula();
  initRCCanvas();
}

function updateEnergyFormula() {
  var pe = energyM * 9.8 * energyH;
  var vBot = Math.sqrt(2 * 9.8 * energyH);
  document.getElementById('en-m-disp').textContent = energyM;
  document.getElementById('en-h-disp').textContent = energyH;
  document.getElementById('en-pe-disp').textContent = pe.toFixed(0);
  document.getElementById('en-v-disp').textContent = vBot.toFixed(1);
  var okEl = document.getElementById('en-loop-ok');
  var failEl = document.getElementById('en-loop-fail');
  if (vBot >= 14) { okEl.style.display='inline'; failEl.style.display='none'; }
  else { okEl.style.display='none'; failEl.style.display='inline'; }
}

// ================================================================
//  ENERGY — Roller Coaster (with loop)
// ================================================================
var rcRaf = null;
var rcState = { running:false, cartX:0, cartY:0, t:0 };
var RC_TARGET_V = 14; // m/s

function getRCTrack(cvs) {
  var pts = [];
  var w = cvs.width, h = cvs.height;
  var groundY = h - 20;
  var hillH = Math.min(energyH * 5.5, h - 80); // scale height
  var loopR = 40; // px
  var loopCX = w * 0.62, loopCY = groundY - loopR;

  // Build path: hill down, flat, loop
  for (var i = 0; i <= 80; i++) {
    var nx = i / 80;
    var x = nx * w * 0.55;
    var y = groundY - hillH * Math.pow(1 - nx, 1.7);
    pts.push({ x:x, y:y, section:'hill' });
  }
  // Flat run
  for (var j = 1; j <= 10; j++) {
    var nx2 = j/10;
    pts.push({ x: w*0.55 + nx2*(loopCX - loopR - w*0.55), y:groundY, section:'flat' });
  }
  // Loop (circle)
  for (var a = -Math.PI/2; a <= 3*Math.PI/2; a += 0.08) {
    pts.push({ x: loopCX + loopR*Math.cos(a), y: loopCY - loopR*Math.sin(a), section:'loop' });
  }
  // After loop
  for (var k = 1; k <= 15; k++) {
    pts.push({ x: loopCX + loopR + k*(w - loopCX - loopR - 10)/15, y:groundY, section:'after' });
  }
  return { pts:pts, loopCX:loopCX, loopCY:loopCY, loopR:loopR, groundY:groundY, hillH:hillH };
}

function drawRCCanvas() {
  var cvs = document.getElementById('canvas-rc'); if (!cvs) return;
  var ctx = cvs.getContext('2d'); var w=cvs.width, h=cvs.height;
  ctx.clearRect(0,0,w,h);
  var track = getRCTrack(cvs);
  var pts = track.pts, loopCX=track.loopCX, loopCY=track.loopCY, loopR=track.loopR, groundY=track.groundY;

  // Ground
  ctx.fillStyle='#0a1628'; ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#1e2a1a'; ctx.fillRect(0,groundY,w,h-groundY);

  // Track
  ctx.beginPath(); ctx.moveTo(pts[0].x, pts[0].y);
  pts.forEach(function(p){ ctx.lineTo(p.x, p.y); });
  ctx.strokeStyle='#22c55e'; ctx.lineWidth=3; ctx.stroke();

  // Loop circle outline
  ctx.beginPath(); ctx.arc(loopCX, loopCY, loopR, 0, Math.PI*2);
  ctx.strokeStyle='rgba(34,197,94,0.3)'; ctx.lineWidth=1; ctx.setLineDash([3,4]); ctx.stroke(); ctx.setLineDash([]);

  // Energy bars
  var pe = energyM * 9.8 * energyH;
  var vBot = Math.sqrt(2 * 9.8 * energyH);
  var t = rcState.t;
  var curPE = pe * Math.pow(Math.max(0, 1-t), 1.2);
  var curKE = pe - curPE;
  var maxBarH = 50;
  var bx = 8;
  var peH = (curPE/pe)*maxBarH, keH = (curKE/pe)*maxBarH;
  ctx.fillStyle='#1e40af'; ctx.fillRect(bx, groundY-peH, 22, peH);
  ctx.fillStyle='#ea580c'; ctx.fillRect(bx+26, groundY-keH, 22, keH);
  ctx.fillStyle='#aaa'; ctx.font='9px Arial'; ctx.textAlign='center';
  ctx.fillText('PE', bx+11, groundY+12); ctx.fillText('KE', bx+37, groundY+12);
  ctx.textAlign='left';

  // Speed label
  var curV = Math.sqrt(2 * curKE / energyM);
  ctx.fillStyle = curV >= RC_TARGET_V ? '#22c55e' : '#fff';
  ctx.font = 'bold 12px sans-serif';
  ctx.fillText('v=' + curV.toFixed(1) + ' m/s', w - 100, 20);

  // Cart
  var idx = Math.min(Math.floor(t * (pts.length-1)), pts.length-1);
  var cx = pts[idx].x, cy = pts[idx].y;
  rcState.cartX = cx; rcState.cartY = cy;

  ctx.fillStyle='#FFD700'; ctx.fillRect(cx-10, cy-9, 20, 12);
  ctx.beginPath(); ctx.arc(cx-5, cy+3, 4, 0, Math.PI*2); ctx.fillStyle='#aaa'; ctx.fill();
  ctx.beginPath(); ctx.arc(cx+5, cy+3, 4, 0, Math.PI*2); ctx.fill();
}

function launchRollerCoaster() {
  if (rcState.running) return;
  rcState.running=true; rcState.t=0;
  if (rcRaf) cancelAnimationFrame(rcRaf);
  var el = document.getElementById('law-energy-result'); if (el) { el.className='result-banner'; el.textContent=''; }
  document.getElementById('rc-status').textContent='';
  animateRC();
}

function animateRC() {
  if (!rcState.running) return;
  rcState.t = Math.min(1, rcState.t+0.009);
  var cvs = document.getElementById('canvas-rc'); if (!cvs) { rcState.running=false; return; }
  drawRCCanvas();
  if (rcState.t < 1) {
    rcRaf = requestAnimationFrame(animateRC);
  } else {
    rcState.running=false;
    var vBot = Math.sqrt(2 * 9.8 * energyH);
    if (!state.energyGoal && vBot >= RC_TARGET_V) {
      state.energyGoal = true;
      showResult('law-energy-result','success','\uD83C\uDF89 הלולאה הושלמה! האנרגיה הפוטנציאלית הפכה לקינטית בצורה מושלמת. האנרגיה נשמרה! +150 נקודות');
      addScore(150);
      document.getElementById('energy-pts-msg').textContent='+150 נקודות!';
      document.getElementById('energy-pts-msg').style.display='inline';
      document.getElementById('rc-status').textContent='\uD83C\uDF89 הקרון השלים את הלולאה! כל האנרגיה הפוטנציאלית הפכה לקינטית!';
    } else if (!state.energyGoal) {
      if (vBot < RC_TARGET_V) {
        showResult('law-energy-result','fail','\uD83D\uDE22 מהירות לא מספיקה (' + vBot.toFixed(1) + ' m/s) — הגבה את h! צריך \u2265 14 m/s.');
        document.getElementById('rc-status').textContent = 'v\u2080=' + vBot.toFixed(1) + ' m/s — צריך 14 m/s. הגבה את h!';
      }
    }
    if (!state.rcDone) { state.rcDone=true; if (!state.energyGoal) addScore(50); checkEnergyCompletion(); }
  }
}

function resetRollerCoaster() {
  rcState.running=false; rcState.t=0;
  if (rcRaf) cancelAnimationFrame(rcRaf);
  var el=document.getElementById('law-energy-result'); if(el){el.className='result-banner';el.textContent='';}
  document.getElementById('rc-status').textContent='';
  var cvs=document.getElementById('canvas-rc'); if(!cvs) return;
  var track=getRCTrack(cvs); rcState.cartX=track.pts[0].x; rcState.cartY=track.pts[0].y;
  drawRCCanvas();
}

function initRCCanvas() {
  var cvs=document.getElementById('canvas-rc'); if(!cvs) return;
  updateEnergyFormula();
  var track=getRCTrack(cvs); rcState.cartX=track.pts[0].x; rcState.cartY=track.pts[0].y; rcState.t=0;
  drawRCCanvas();
}

// ================================================================
//  ENERGY — Bouncing Ball
// ================================================================
var bbRaf = null;
var bbState = { running:false, y:0, vy:0, bounces:0, maxY:0 };

function launchBounceBall() {
  if (bbState.running) return;
  var cvs=document.getElementById('canvas-bb'); if(!cvs) return;
  var h=cvs.height, heightPct=parseFloat(document.getElementById('bb-height').value)/100;
  bbState.running=true; bbState.y=(h-40)*(1-heightPct)+10; bbState.vy=0; bbState.maxY=h-25; bbState.bounces=0;
  if (bbRaf) cancelAnimationFrame(bbRaf);
  animateBB();
}

function animateBB() {
  if (!bbState.running) return;
  var cvs=document.getElementById('canvas-bb'); if(!cvs){bbState.running=false;return;}
  var ctx=cvs.getContext('2d'); var w=cvs.width,h=cvs.height;
  bbState.vy+=0.5; bbState.y+=bbState.vy;
  if (bbState.y>=bbState.maxY) {
    bbState.y=bbState.maxY; bbState.vy*=-0.72; bbState.bounces++;
    if (!state.bbDone){state.bbDone=true;addScore(50);checkEnergyCompletion();}
    if (Math.abs(bbState.vy)<1.5){bbState.running=false;}
  }
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#374151'; ctx.fillRect(0,bbState.maxY+2,w,4);
  var grad=ctx.createRadialGradient(w/2,bbState.y-4,2,w/2,bbState.y,14);
  grad.addColorStop(0,'#f97316'); grad.addColorStop(1,'#7c2d12');
  ctx.beginPath(); ctx.arc(w/2,bbState.y,14,0,Math.PI*2); ctx.fillStyle=grad; ctx.fill();
  var startY=(h-40)*(1-parseFloat(document.getElementById('bb-height').value)/100)+10;
  var totalH=bbState.maxY-startY;
  var peRatio=Math.max(0,(bbState.maxY-bbState.y)/(totalH||1));
  var keRatio=1-peRatio;
  ctx.font='bold 11px Arial'; ctx.textAlign='left';
  ctx.fillStyle='#60a5fa'; ctx.fillText('PE: '+Math.round(peRatio*100)+'%',8,bbState.y+5);
  ctx.fillStyle='#f97316'; ctx.fillText('KE: '+Math.round(keRatio*100)+'%',8,bbState.y+18);
  ctx.textAlign='start';
  if (bbState.running) bbRaf=requestAnimationFrame(animateBB);
}

function resetBounceBall() {
  bbState.running=false; if(bbRaf)cancelAnimationFrame(bbRaf);
  var cvs=document.getElementById('canvas-bb'); if(!cvs) return;
  var ctx=cvs.getContext('2d'); ctx.clearRect(0,0,cvs.width,cvs.height);
}

function checkEnergyCompletion() {
  if ((state.rcDone || state.bbDone) && !state.energyDone) {
    state.energyDone=true; markDot('energy',true);
  }
}

// ================================================================
//  GRAVITY PARAMS
// ================================================================
var gravV0 = 40, gravAngle = 45, gravG = 9.8;

function syncGravity(param, val) {
  val = parseFloat(val);
  if (param==='v0') { gravV0=Math.max(10,Math.min(80,val||40)); document.getElementById('proj-v0-slider').value=gravV0; document.getElementById('proj-v0-num').value=gravV0; }
  else if (param==='ang') { gravAngle=Math.max(10,Math.min(80,val||45)); document.getElementById('proj-angle-slider').value=gravAngle; document.getElementById('proj-angle-num').value=gravAngle; }
  else { gravG=Math.max(1.6,Math.min(24.8,val||9.8)); document.getElementById('proj-g-slider').value=gravG; document.getElementById('proj-g-num').value=gravG; }
  updateGravityFormula();
  drawProjectileIdle();
}

function updateGravityFormula() {
  var rad = gravAngle * Math.PI / 180;
  var range = (gravV0*gravV0*Math.sin(2*rad)) / gravG;
  document.getElementById('grav-v0-disp').textContent = gravV0;
  document.getElementById('grav-ang-disp').textContent = gravAngle*2;
  document.getElementById('grav-g-disp').textContent = gravG.toFixed(1);
  document.getElementById('grav-range-disp').textContent = range.toFixed(1);
}

function setPlanetG(g, name, btn) {
  document.querySelectorAll('.planet-btn').forEach(function(b){b.classList.remove('selected');});
  if (btn) btn.classList.add('selected');
  syncGravity('g', g);
}

// ================================================================
//  GRAVITY — Projectile Launcher
// ================================================================
var projRaf = null;
var projState = { running:false, x:0, y:0, vx:0, vy:0, trail:[], landed:false, landX:0 };
var TARGET_X_M = 150; // 150 m target
var PAD_TOL_M = 8;

function getProjectileScale(cvs) {
  // Map real meters to canvas pixels
  var maxRange = 400; // show up to 400 m
  var w = cvs.width, h = cvs.height;
  var ppm = (w - 80) / maxRange;
  var groundY = h - 24;
  return { ppm:ppm, groundY:groundY, originX:40 };
}

function drawProjectileIdle() {
  var cvs=document.getElementById('canvas-proj'); if(!cvs) return;
  var ctx=cvs.getContext('2d'); var w=cvs.width, h=cvs.height;
  var sc = getProjectileScale(cvs);
  var ppm=sc.ppm, groundY=sc.groundY, originX=sc.originX;
  ctx.clearRect(0,0,w,h);

  // Background
  ctx.fillStyle='#0a1628'; ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#374151'; ctx.fillRect(0,groundY,w,h-groundY);

  // Ground markers
  ctx.fillStyle='rgba(255,255,255,0.3)'; ctx.font='10px sans-serif'; ctx.textAlign='center';
  for (var mi=0; mi<=400; mi+=50) {
    var mx=originX+mi*ppm;
    if (mx>w-5) break;
    ctx.fillRect(mx,groundY,1,5); ctx.fillText(mi+'m',mx,groundY+14);
  }
  ctx.textAlign='left';

  // Landing pad at 150 m
  var padX = originX + TARGET_X_M * ppm;
  ctx.fillStyle='rgba(255,215,0,0.15)'; ctx.fillRect(padX-PAD_TOL_M*ppm,groundY-4,PAD_TOL_M*2*ppm,4);
  ctx.fillStyle='#FFD700'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
  ctx.fillText('\uD83C\uDFC1 150m', padX, groundY-8); ctx.textAlign='left';

  // Dotted predicted trajectory
  var rad = gravAngle*Math.PI/180;
  var range = (gravV0*gravV0*Math.sin(2*rad))/gravG;
  var tFlight = 2*gravV0*Math.sin(rad)/gravG;
  ctx.strokeStyle='rgba(225,29,72,0.4)'; ctx.lineWidth=1.5; ctx.setLineDash([4,4]);
  ctx.beginPath();
  var launched=false;
  for (var ti=0; ti<=60; ti++) {
    var t2=ti/60*tFlight;
    var px=originX+gravV0*Math.cos(rad)*t2*ppm;
    var py=groundY - gravV0*Math.sin(rad)*t2*ppm + 0.5*gravG*t2*t2*ppm;
    if (py>groundY) break;
    if (!launched){ctx.moveTo(px,py);launched=true;} else {ctx.lineTo(px,py);}
  }
  ctx.stroke(); ctx.setLineDash([]);

  // Launch angle indicator
  var len=40;
  ctx.strokeStyle='#FFD700'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(originX,groundY); ctx.lineTo(originX+Math.cos(rad)*len,groundY-Math.sin(rad)*len); ctx.stroke();
  ctx.fillStyle='#FFD700'; ctx.font='12px Arial'; ctx.textAlign='left';
  ctx.fillText(gravAngle+'\u00B0',originX+Math.cos(rad)*len+4,groundY-Math.sin(rad)*len+4);

  // Ball
  ctx.beginPath(); ctx.arc(originX,groundY-8,8,0,Math.PI*2); ctx.fillStyle='#e11d48'; ctx.fill();

  updateGravityFormula();
}

function launchProjectile() {
  if (projState.running) return;
  var cvs=document.getElementById('canvas-proj'); if(!cvs) return;
  var sc=getProjectileScale(cvs);
  var rad=gravAngle*Math.PI/180;
  projState.running=true; projState.landed=false;
  projState.x=sc.originX; projState.y=sc.groundY-8;
  // Real physics velocities in m/s, scale to px/frame
  var fps=60;
  projState.vx = gravV0*Math.cos(rad)/fps*sc.ppm;
  projState.vy = -gravV0*Math.sin(rad)/fps*sc.ppm;
  projState.trail=[];
  var el=document.getElementById('law-gravity-result'); if(el){el.className='result-banner';el.textContent='';}
  document.getElementById('proj-status').textContent='';
  if(projRaf)cancelAnimationFrame(projRaf);
  animateProjectile();
}

function animateProjectile() {
  if (!projState.running) return;
  var cvs=document.getElementById('canvas-proj'); if(!cvs){projState.running=false;return;}
  var ctx=cvs.getContext('2d'); var w=cvs.width,h=cvs.height;
  var sc=getProjectileScale(cvs);
  var gPx=gravG/60/60*sc.ppm*60; // gravity in px/frame^2

  projState.vy+=gPx;
  projState.x+=projState.vx; projState.y+=projState.vy;
  projState.trail.push({x:projState.x,y:projState.y});

  // Redraw
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#0a1628'; ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#374151'; ctx.fillRect(0,sc.groundY,w,h-sc.groundY);

  // Markers
  ctx.fillStyle='rgba(255,255,255,0.3)'; ctx.font='10px sans-serif'; ctx.textAlign='center';
  for (var mi=0; mi<=400; mi+=50) {
    var mx=sc.originX+mi*sc.ppm; if(mx>w-5)break;
    ctx.fillRect(mx,sc.groundY,1,5); ctx.fillText(mi+'m',mx,sc.groundY+14);
  }
  ctx.textAlign='left';

  // Pad
  var padX=sc.originX+TARGET_X_M*sc.ppm;
  ctx.fillStyle='rgba(255,215,0,0.2)'; ctx.fillRect(padX-PAD_TOL_M*sc.ppm,sc.groundY-4,PAD_TOL_M*2*sc.ppm,4);
  ctx.fillStyle='#FFD700'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
  ctx.fillText('\uD83C\uDFC1 150m',padX,sc.groundY-8); ctx.textAlign='left';

  // Trail
  projState.trail.forEach(function(p,i){
    ctx.beginPath(); ctx.arc(p.x,p.y,2,0,Math.PI*2);
    ctx.fillStyle='rgba(225,29,72,'+(i/projState.trail.length)+')'; ctx.fill();
  });

  // Ball
  ctx.beginPath(); ctx.arc(projState.x,projState.y,8,0,Math.PI*2); ctx.fillStyle='#e11d48'; ctx.fill();

  if (projState.y>=sc.groundY-8 && projState.trail.length>5) {
    projState.running=false;
    var landXm=(projState.x-sc.originX)/sc.ppm;
    projState.landX=landXm;
    var diff=Math.abs(landXm-TARGET_X_M);
    document.getElementById('proj-status').textContent='\uD83D\uDCCF נחיתה: '+landXm.toFixed(1)+' m';
    if (!state.gravityGoal && diff<=PAD_TOL_M) {
      state.gravityGoal=true;
      showResult('law-gravity-result','success','\uD83C\uDFC6 נחיתה מושלמת! כל חוקי ניוטון עובדים יחד! +150 נקודות');
      addScore(150);
      document.getElementById('gravity-pts-msg').textContent='+150 נקודות!';
      document.getElementById('gravity-pts-msg').style.display='inline';
    } else if (!state.gravityGoal) {
      if (landXm < TARGET_X_M - PAD_TOL_M) {
        showResult('law-gravity-result','fail','\uD83D\uDCA8 לא הגיע ('+landXm.toFixed(0)+' m) — הגדל v\u2080 או נסה זווית קרובה יותר ל-45\u00B0!');
      } else {
        showResult('law-gravity-result','fail','\uD83D\uDE80 חרג ('+landXm.toFixed(0)+' m) — הקטן v\u2080 או הגדל את הזווית.');
      }
    }
    if (!state.projDone) { state.projDone=true; if(!state.gravityGoal)addScore(50); checkGravityCompletion(); }
    return;
  }
  if (projState.x>w+20) {
    projState.running=false;
    showResult('law-gravity-result','fail','\uD83D\uDE80 חרג מהמסך — הקטן v\u2080 או הגדל את הזווית.');
    if (!state.projDone) { state.projDone=true; addScore(50); checkGravityCompletion(); }
    return;
  }
  projRaf=requestAnimationFrame(animateProjectile);
}

function resetProjectile() {
  projState.running=false; if(projRaf)cancelAnimationFrame(projRaf);
  document.getElementById('proj-status').textContent='';
  var el=document.getElementById('law-gravity-result'); if(el){el.className='result-banner';el.textContent='';}
  drawProjectileIdle();
}

// ================================================================
//  GRAVITY — Worlds
// ================================================================
var worldsRaf=null, worldsState={running:false,balls:[]};
var WORLDS=[
  {name:'ירח',g:1.6,color:'#C0C0C0'},
  {name:'מאדים',g:3.7,color:'#FF6B35'},
  {name:'כדור הארץ',g:9.8,color:'#00C9FF'},
  {name:'צדק',g:24.8,color:'#FFB347'}
];

function launchWorlds() {
  if (worldsState.running) return;
  var cvs=document.getElementById('canvas-worlds'); if(!cvs) return;
  var h=cvs.height,groundY=h-20,angle=45*Math.PI/180,speed=0.065;
  worldsState.running=true;
  worldsState.balls=WORLDS.map(function(wld){
    return{x:30,y:groundY-6,vx:Math.cos(angle)*speed,vy:-Math.sin(angle)*speed,g:wld.g*0.00165,color:wld.color,name:wld.name,landed:false,trail:[]};
  });
  if(worldsRaf)cancelAnimationFrame(worldsRaf);
  animateWorlds();
}

function animateWorlds() {
  if (!worldsState.running) return;
  var cvs=document.getElementById('canvas-worlds'); if(!cvs){worldsState.running=false;return;}
  var ctx=cvs.getContext('2d'); var w=cvs.width,h=cvs.height,groundY=h-20;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#0a1628'; ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#374151'; ctx.fillRect(0,groundY,w,4);
  var allDone=true;
  worldsState.balls.forEach(function(ball){
    if(!ball.landed){
      ball.vy+=ball.g; ball.x+=ball.vx; ball.y+=ball.vy;
      ball.trail.push({x:ball.x,y:ball.y});
      if(ball.y>=groundY-6&&ball.trail.length>3){ball.landed=true;ball.y=groundY-6;}
    }
    if(!ball.landed)allDone=false;
    ball.trail.forEach(function(p,i){
      ctx.beginPath();ctx.arc(p.x,p.y,1.5,0,Math.PI*2);
      ctx.globalAlpha=i/ball.trail.length*0.5;ctx.fillStyle=ball.color;ctx.fill();ctx.globalAlpha=1;
    });
    ctx.beginPath();ctx.arc(ball.x,ball.y,7,0,Math.PI*2);ctx.fillStyle=ball.color;ctx.fill();
    if(ball.landed){
      ctx.fillStyle=ball.color;ctx.font='bold 10px Arial';ctx.textAlign='center';
      ctx.fillText(ball.name,ball.x,groundY+14);
    }
  });
  ctx.textAlign='start';
  if(allDone){
    worldsState.running=false;
    if(!state.worldsDone){state.worldsDone=true;addScore(50);checkGravityCompletion();}
    return;
  }
  worldsRaf=requestAnimationFrame(animateWorlds);
}

function resetWorlds() {
  worldsState.running=false; if(worldsRaf)cancelAnimationFrame(worldsRaf);
  var cvs=document.getElementById('canvas-worlds'); if(!cvs)return;
  var ctx=cvs.getContext('2d'); ctx.clearRect(0,0,cvs.width,cvs.height);
}

function checkGravityCompletion() {
  if ((state.projDone||state.worldsDone) && !state.gravityDone) {
    state.gravityDone=true; markDot('gravity',true);
  }
}

// ================================================================
//  QUIZ
// ================================================================
var QUIZ_DATA=[
  {q:"דיסק הוקי מחליק הרבה יותר רחוק על קרח מאשר על דשא. זה בגלל חוק ניוטון ה...?",opts:["הראשון (אינרציה)","השני (כוח=מסה×תאוצה)","השלישי (פעולה/תגובה)","חוק הכבידה"],correct:0,exp:"החוק הראשון אומר שגופים ממשיכים לנוע אלא אם כן כוח עוצר אותם. לקרח יש חיכוך נמוך מאוד, ולכן הדיסק מחליק הרבה יותר רחוק!"},
  {q:"בעטת בכדור כדורגל ובכדורת עם אותו כוח. מי יגיע רחוק יותר?",opts:["כדור הכדורגל","הכדורת","שניהם אותו דבר","אף אחד לא זז"],correct:0,exp:"חוק שני: תאוצה = כוח ÷ מסה. עם אותו כוח, כדור הכדורגל הקל מקבל תאוצה גדולה בהרבה מאשר הכדורת הכבדה!"},
  {q:"מנוע הרקטה דוחף גזים חמים כלפי מטה. מה קורה לרקטה?",opts:["היא עולה למעלה","היא יורדת למטה","היא נשארת במקום","היא מסתובבת"],correct:0,exp:"חוק שלישי! הרקטה דוחפת גזים למטה (פעולה), אז הגזים דוחפים את הרקטה למעלה (תגובה) — כוח שווה, כיוון הפוך!"},
  {q:"למה צריך חגורת בטיחות כשהרכב עוצר פתאום?",opts:["הגוף ממשיך לנוע קדימה בגלל אינרציה","הרכב מושך אתכם קדימה","הבלמים דוחפים אתכם קדימה","הכבידה מושכת אתכם קדימה"],correct:0,exp:"חוק ראשון — אינרציה! הגוף שלך נע עם הרכב. כשהרכב עוצר, הגוף רוצה להמשיך לנוע. חגורת הבטיחות מפעילה את כוח העצירה!"},
  {q:"אם מכפילים את מסת העצם ושומרים על אותו כוח, התאוצה תהיה...?",opts:["מחצית","כפולה","אותו הדבר","פי שלוש"],correct:0,exp:"תאוצה = כוח ÷ מסה. אם המסה מוכפלת והכוח נשאר זהה: תאוצה = כוח ÷ (2×מסה) = מחצית התאוצה המקורית!"},
  {q:"כדור בראש גבעה מחזיק באיזה סוג אנרגיה?",opts:["אנרגיה פוטנציאלית (גובה צבור)","אנרגיה קינטית (תנועה)","אנרגיה חשמלית","אין לו אנרגיה כלל"],correct:0,exp:"בראש הגבעה לכדור יש אנרגיה פוטנציאלית — אנרגיה צבורה בגלל גובהו. כשהוא מתגלגל למטה, האנרגיה הפוטנציאלית הופכת לקינטית!"},
  {q:"באיזו זווית כדאי לזרוק כדור כדי שיגיע לכי רחוק?",opts:["45 מעלות","90 מעלות (ישר למעלה)","10 מעלות (כמעט שטוח)","0 מעלות (אופקי לגמרי)"],correct:0,exp:"45° נותן את האיזון המושלם בין גובה ומרחק אופקי, ומייצר את הטווח המרבי לכל קליע שנזרק באותה מהירות!"}
];

var quizAnswered={};
function buildQuiz(){
  quizAnswered={}; state.quizSubmitted=false;
  var container=document.getElementById('quiz-questions'); container.innerHTML='';
  document.getElementById('quiz-result').style.display='none';
  document.getElementById('quiz-submit-area').style.display='block';
  var btn=document.getElementById('quiz-submit-btn'); btn.disabled=false; btn.style.opacity='1';
  QUIZ_DATA.forEach(function(q,qi){
    var div=document.createElement('div'); div.className='quiz-question'; div.id='q-'+qi;
    var optsHtml=q.opts.map(function(opt,oi){
      return '<button class="q-opt" id="opt-'+qi+'-'+oi+'" onclick="selectAnswer('+qi+','+oi+')">'
           + String.fromCharCode(65+oi)+') '+opt+'</button>';
    }).join('');
    div.innerHTML='<div class="q-text">'+(qi+1)+'. '+q.q+'</div><div class="q-options">'+optsHtml+'</div><div class="q-explanation" id="exp-'+qi+'"></div>';
    container.appendChild(div);
  });
}

function selectAnswer(qi,oi){
  if(state.quizSubmitted)return;
  quizAnswered[qi]=oi;
  for(var i=0;i<QUIZ_DATA[qi].opts.length;i++){
    var b=document.getElementById('opt-'+qi+'-'+i);
    b.style.borderColor=(i===oi)?'var(--gold)':'#444';
    b.style.background=(i===oi)?'rgba(255,215,0,0.15)':'';
    b.style.color=(i===oi)?'#fff':'';
  }
}

function submitQuiz(){
  if(Object.keys(quizAnswered).length<QUIZ_DATA.length){showNotif('ענה על כל 7 השאלות תחילה!');return;}
  state.quizSubmitted=true; var correct=0;
  QUIZ_DATA.forEach(function(q,qi){
    var chosen=quizAnswered[qi], isCorrect=(chosen===q.correct);
    if(isCorrect)correct++;
    for(var oi=0;oi<q.opts.length;oi++){
      var btn=document.getElementById('opt-'+qi+'-'+oi);
      btn.classList.add('disabled'); btn.style.borderColor=''; btn.style.background=''; btn.style.color='';
      if(oi===q.correct)btn.classList.add('correct');
      else if(oi===chosen&&!isCorrect)btn.classList.add('wrong');
    }
    var expDiv=document.getElementById('exp-'+qi);
    expDiv.textContent=isCorrect?'\u2705 ' + q.exp:'\u274C התשובה הנכונה: '+q.opts[q.correct]+'. '+q.exp;
    expDiv.className='q-explanation show '+(isCorrect?'correct-exp':'wrong-exp');
  });
  var pts=correct*40;
  document.getElementById('quiz-result-heading').textContent='תוצאות החידון: '+correct+'/'+QUIZ_DATA.length+' נכון!';
  document.getElementById('quiz-result-msg').textContent='קיבלת '+pts+' נקודות מתוך '+(QUIZ_DATA.length*40)+'!';
  document.getElementById('quiz-result').style.display='block';
  document.getElementById('quiz-submit-area').style.display='none';
  if(!state.quizDone){
    state.quizDone=true; updateDot('quiz',true);
    document.getElementById('home-done-quiz').style.display='block';
    addScore(pts); checkCompletion();
  }
}

function retakeQuiz(){ state.quizSubmitted=false; quizAnswered={}; buildQuiz(); }

// ================================================================
//  INIT
// ================================================================
buildQuiz();
updateFMA();
updateBalloon();
updateLaw1Formula();
updateLaw3Formula();
updateEnergyFormula();
updateGravityFormula();

window.addEventListener('load',function(){
  drawSlideCanvas(); drawSpaceCanvas(); drawFMACanvas(); drawBalloonCanvas(); drawRocketCanvas();
  initRCCanvas(); drawProjectileIdle();
});

// ================================================================
//  INLINE LESSON QUIZ ENGINE
// ================================================================
var lqScores={};
function initLessonQuiz(quizId,questions){
  var container=document.getElementById(quizId); if(!container)return;
  container.innerHTML='';
  questions.forEach(function(q,qi){
    var optsHtml=q.opts.map(function(o,oi){
      return '<button class="lq-opt" onclick="answerLQ(\''+quizId+'\','+qi+','+oi+','+q.correct+',\''+encodeURIComponent(q.exp)+'\')">'+o+'</button>';
    }).join('');
    container.innerHTML+='<div class="lq-question"><div class="lq-text">'+(qi+1)+'. '+q.q+'</div><div class="lq-opts" id="'+quizId+'-opts-'+qi+'">'+optsHtml+'</div><div class="lq-feedback" id="'+quizId+'-fb-'+qi+'"></div></div>';
  });
  container.innerHTML+='<div class="lesson-quiz-score" id="'+quizId+'-score"></div>';
}

function answerLQ(quizId,qi,oi,correct,expEnc){
  var exp=decodeURIComponent(expEnc);
  var opts=document.querySelectorAll('#'+quizId+'-opts-'+qi+' .lq-opt');
  opts.forEach(function(b,i){b.disabled=true;if(i===correct)b.classList.add('correct');else if(i===oi&&oi!==correct)b.classList.add('wrong');});
  var fb=document.getElementById(quizId+'-fb-'+qi);
  var isOk=(oi===correct);
  fb.textContent=(isOk?'\u2705 נכון! ':'\u274C לא מדויק. ')+exp;
  fb.className='lq-feedback show '+(isOk?'ok':'bad');
  if(!lqScores[quizId])lqScores[quizId]={correct:0,total:0};
  lqScores[quizId].total++; if(isOk)lqScores[quizId].correct++;
  var allQ=document.querySelectorAll('#'+quizId+' .lq-question');
  var answered=document.querySelectorAll('#'+quizId+' .lq-feedback.show').length;
  if(answered===allQ.length){
    var sc=document.getElementById(quizId+'-score');
    var pct=lqScores[quizId].correct;
    sc.textContent='ענית נכון על '+pct+' מתוך '+allQ.length+(pct===allQ.length?' \uD83C\uDF1F מושלם!':pct>=allQ.length-1?' \uD83D\uDC4D כל הכבוד!':' \uD83D\uDCAA כדאי לתרגל עוד!');
    sc.style.display='block';
  }
}

initLessonQuiz('lq-law1',[
  {q:'כדור מתגלגל על משטח שטוח. מה יקרה אם לא יפעל עליו שום כוח?',opts:['הוא יאט ויעצור','הוא ימשיך להתגלגל לנצח באותה מהירות','הוא יאיץ','הוא יקפוץ'],correct:1,exp:'חוק ניוטון הראשון! ללא שום כוח (כמו חיכוך או קיר), עצם נע ממשיך לנוע לנצח באותה מהירות ואותו כיוון.'},
  {q:'למה אתה נזרק קדימה כשהאוטובוס בולם בפתאומיות?',opts:['האוטובוס דוחף אותך קדימה','לגופך יש אינרציה — הוא רוצה להמשיך לנוע קדימה','הכבידה מושכת אותך קדימה','הרצפה דוחפת אותך'],correct:1,exp:'גופך נע באותה מהירות כמו האוטובוס. כשהאוטובוס עוצר, גופך ממשיך לנוע קדימה — זאת אינרציה בפעולה!'},
  {q:'למה דיסק הוקי מחליק הרבה יותר רחוק על קרח מאשר על דשא?',opts:['הדיסק קל יותר על קרח','לקרח יש פחות חיכוך, אז פחות כוח מאט את הדיסק','הדיסק מהיר יותר על דשא','הכבידה קטנה יותר על קרח'],correct:1,exp:'לקרח יש חיכוך נמוך מאוד — כמעט אין כוח שפועל נגד תנועת הדיסק — ולכן האינרציה שומרת עליו בתנועה הרבה יותר זמן!'}
]);

initLessonQuiz('lq-law2',[
  {q:'דחפת כדור של 2 kg עם כוח של 10 N. מה התאוצה? (a = F ÷ m)',opts:['20 m/s²','5 m/s²','0.2 m/s²','12 m/s²'],correct:1,exp:'a = F ÷ m = 10 ÷ 2 = 5 m/s². פשוט מאוד — מחלקים כוח במסה!'},
  {q:'בעטת בכדור כדורגל קל ובכדורת כבדה עם אותו כוח. מי מאיץ יותר?',opts:['הכדורת','כדור הכדורגל','שניהם מאיצים אותו הדבר','אף אחד לא זז'],correct:1,exp:'כדור הכדורגל! יש לו פחות מסה, אז אותו כוח נותן לו תאוצה הרבה יותר גדולה. a = F ÷ m — מסה קטנה יותר = תאוצה גדולה יותר!'},
  {q:'אתה רוצה לתת לסלע כבד אותה תאוצה כמו לאבן קטנה. מה אתה צריך?',opts:['פחות כוח','אותו כוח','הרבה יותר כוח','אין צורך בכוח'],correct:2,exp:'הרבה יותר כוח! F = m × a. אם המסה גדולה הרבה יותר ואתה רוצה אותה תאוצה, אתה חייב להפעיל כוח הרבה יותר גדול.'}
]);

initLessonQuiz('lq-law3',[
  {q:'כשרקטה פולטת גזים למטה, מה קורה לרקטה?',opts:['היא יורדת גם כן','היא עולה למעלה — תגובה שווה ומנוגדת','היא מסתובבת','היא נשארת במקום'],correct:1,exp:'חוק שלישי! הרקטה דוחפת גזים למטה (פעולה). הגזים דוחפים את הרקטה למעלה (תגובה) עם אותו כוח בכיוון ההפוך. כך עובדת כל רקטה שהושקה אי פעם!'},
  {q:'אתה דוחף קיר. הקיר דוחף אותך חזרה ב...',opts:['פחות כוח (קירות חזקים)','אותו כוח בכיוון ההפוך','יותר כוח (קירות כבדים יותר)','אין כוח — קירות לא יכולים לדחוף'],correct:1,exp:'שווה ומנוגד! הקיר דוחף אותך חזרה בדיוק עם אותו כוח שהפעלת. לכן אתה לא עובר דרכו — הכוחות מאוזנים.'},
  {q:'שחיין דוחף מים אחורה עם הידיים. מה המים עושים?',opts:['דוחפים את השחיין אחורה גם כן','דוחפים את השחיין קדימה','לא עושים כלום','מאטים את השחיין מיד'],correct:1,exp:'פעולה-תגובה! השחיין דוחף מים אחורה (פעולה). המים דוחפים את השחיין קדימה (תגובה). כך כל תנועות השחייה מניעות אותך דרך המים!'}
]);

initLessonQuiz('lq-energy',[
  {q:'כדור עומד בשקט בראש מדרון. איזה סוג אנרגיה יש לו?',opts:['אנרגיה קינטית (הוא נע)','אנרגיה פוטנציאלית (הוא גבוה, אנרגיה צבורה)','אין לו אנרגיה כלל','אנרגיה חשמלית'],correct:1,exp:'אנרגיה פוטנציאלית! הכדור גבוה ולא נע, ולכן כל האנרגיה שלו צבורה כאנרגיה פוטנציאלית כבידתית. ברגע שמשחררים אותו, היא מתחילה להפוך לקינטית.'},
  {q:'כשהכדור מתגלגל במורד המדרון, מה קורה לאנרגיה שלו?',opts:['שתיהן גדלות','שתיהן קטנות','הפוטנציאלית קטנה, הקינטית גדלה','הפוטנציאלית גדלה, הקינטית קטנה'],correct:2,exp:'בזמן הגלגול למטה הגובה יורד (פחות פוטנציאלית) והמהירות עולה (יותר קינטית). האנרגיה מומרת מסוג לסוג — אבל הסכום נשאר זהה!'},
  {q:'למה כדור קופץ קצת נמוך יותר בכל קפיצה?',opts:['הכבידה מתחזקת','כמות קטנה של אנרגיה הופכת לחום וקול בכל קפיצה','הכדור נעשה כבד יותר','האוויר דוחף אותו למטה'],correct:1,exp:'בכל קפיצה, קצת מהאנרגיה הקינטית הופכת לחום (הכדור מתחמם מעט) ולקול (ה“בום”). נשארת פחות אנרגיה לקפיצה הבאה — ולכן היא קצת נמוכה יותר.'}
]);

initLessonQuiz('lq-gravity',[
  {q:'זרקת כדור הצידה. למה הוא עוקב אחר נתיב מעוקל ולא ישר?',opts:['הרוח דוחפת אותו','הכבידה מושכת אותו כלפי מטה בזמן שהוא נע הצידה','הכדור מסתובב','האוויר סמיך מדי'],correct:1,exp:'לכדור יש שתי תנועות בו-זמנית: הצידה (מהזריקה) ולמטה (מהכבידה). השילוב של שתיהן יוצר את צורת הפרבולה המעוקלת!'},
  {q:'באיזו זווית שיגור כדור נוסע הכי רחוק?',opts:['90° (ישר למעלה)','10° (כמעט שטוח)','45° (באמצע)','0° (אופקי לגמרי)'],correct:2,exp:'45° היא הנקודה המושלמת! היא מאזנת בין נסיעה רחוקה לצד לבין עלייה גבוהה. כל זווית אחרת (שטוחה מדי או תלולה מדי) תיתן טווח קצר יותר עם אותו כוח זריקה.'},
  {q:'כבידת הירח חלשה פי 6 מכדור הארץ. אם תזרוק כדור על הירח, הוא...',opts:['יפול הרבה יותר מהר ויגיע לאדמה מהר יותר','יטוס הרבה יותר רחוק לפני שיגיע לאדמה','יטוס אותו מרחק','יעלה למעלה לנצח'],correct:1,exp:'כבידה חלשה יותר = משיכה כלפי מטה איטית יותר = הכדור נשאר באוויר הרבה יותר זמן = נוסע הרבה יותר רחוק! על הירח תוכל לזרוק כדור כ-6 פעמים יותר רחוק מאשר על כדור הארץ.'}
]);


</script>
</body>
</html>
